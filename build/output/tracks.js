/**
* EaselJS
* Visit http://easeljs.com/ for documentation, updates and examples.
*
* Copyright (c) 2011 Grant Skinner
* 
* Permission is hereby granted, free of charge, to any person
* obtaining a copy of this software and associated documentation
* files (the "Software"), to deal in the Software without
* restriction, including without limitation the rights to use,
* copy, modify, merge, publish, distribute, sublicense, and/or sell
* copies of the Software, and to permit persons to whom the
* Software is furnished to do so, subject to the following
* conditions:
* 
* The above copyright notice and this permission notice shall be
* included in all copies or substantial portions of the Software.
* 
* THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND,
* EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES
* OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND
* NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT
* HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY,
* WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING
* FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR
* OTHER DEALINGS IN THE SOFTWARE.
**/
(function(d){var b=function(){throw"UID cannot be instantiated";};b._nextID=0;b.get=function(){return b._nextID++};d.UID=b})(window);(function(d){var b=function(){throw"Ticker cannot be instantiated.";};b.useRAF=null;b._listeners=null;b._pauseable=null;b._paused=false;b._inited=false;b._startTime=0;b._pausedTime=0;b._ticks=0;b._pausedTickers=0;b._interval=50;b._lastTime=0;b._times=null;b._tickTimes=null;b._rafActive=false;b._timeoutID=null;b.addListener=function(a,c){b._inited||b.init();b.removeListener(a);b._pauseable[b._listeners.length]=c==null?true:c;b._listeners.push(a)};b.init=function(){b._inited=true;b._times=[];b._tickTimes=
[];b._pauseable=[];b._listeners=[];b._times.push(b._startTime=b._getTime());b.setInterval(b._interval)};b.removeListener=function(a){b._listeners!=null&&(a=b._listeners.indexOf(a),a!=-1&&(b._listeners.splice(a,1),b._pauseable.splice(a,1)))};b.removeAllListeners=function(){b._listeners=[];b._pauseable=[]};b.setInterval=function(a){b._lastTime=b._getTime();b._interval=a;b.timeoutID!=null&&clearTimeout(b.timeoutID);if(b.useRAF){if(b._rafActive)return;b._rafActive=true;var c=d.requestAnimationFrame||
d.webkitRequestAnimationFrame||d.mozRequestAnimationFrame||d.oRequestAnimationFrame||d.msRequestAnimationFrame;if(c){c(b._handleAF);return}}if(b._inited)b.timeoutID=setTimeout(b._handleTimeout,a)};b.getInterval=function(){return b._interval};b.setFPS=function(a){b.setInterval(1E3/a)};b.getFPS=function(){return 1E3/b._interval};b.getMeasuredFPS=function(a){if(b._times.length<2)return-1;a==null&&(a=b.getFPS()>>1);a=Math.min(b._times.length-1,a);return 1E3/((b._times[0]-b._times[a])/a)};b.setPaused=
function(a){b._paused=a};b.getPaused=function(){return b._paused};b.getTime=function(a){return b._getTime()-b._startTime-(a?b._pausedTime:0)};b.getTicks=function(a){return b._ticks-(a?b._pausedTickers:0)};b._handleAF=function(a){a-b._lastTime>=b._interval-1&&b._tick();b.useRAF?(d.requestAnimationFrame||d.webkitRequestAnimationFrame||d.mozRequestAnimationFrame||d.oRequestAnimationFrame||d.msRequestAnimationFrame)(b._handleAF,b.animationTarget):b._rafActive=false};b._handleTimeout=function(){b._tick();
if(!b.useRAF)b.timeoutID=setTimeout(b._handleTimeout,b._interval)};b._tick=function(){b._ticks++;var a=b._getTime(),c=a-b._lastTime,g=b._paused;g&&(b._pausedTickers++,b._pausedTime+=c);b._lastTime=a;for(var d=b._pauseable,e=b._listeners.slice(),h=e?e.length:0,j=0;j<h;j++){var k=d[j],l=e[j];l==null||g&&k||l.tick==null||l.tick(c,g)}for(b._tickTimes.unshift(b._getTime()-a);b._tickTimes.length>100;)b._tickTimes.pop();for(b._times.unshift(a);b._times.length>100;)b._times.pop()};b._getTime=function(){return(new Date).getTime()};
d.Ticker=b})(window);(function(d){var b=function(c,a,b,d,h){this.initialize(c,a,b,d,h)},a=b.prototype;a.stageX=0;a.stageY=0;a.type=null;a.nativeEvent=null;a.onMouseMove=null;a.onMouseUp=null;a.target=null;a.initialize=function(c,a,b,d,h){this.type=c;this.stageX=a;this.stageY=b;this.target=d;this.nativeEvent=h};a.clone=function(){return new b(this.type,this.stageX,this.stageY,this.target,this.nativeEvent)};a.toString=function(){return"[MouseEvent (type="+this.type+" stageX="+this.stageX+" stageY="+this.stageY+")]"};d.MouseEvent=
b})(window);(function(d){var b=function(c,a,b,d,h,j){this.initialize(c,a,b,d,h,j)},a=b.prototype;b.identity=null;b.DEG_TO_RAD=Math.PI/180;a.a=1;a.b=0;a.c=0;a.d=1;a.tx=0;a.ty=0;a.alpha=1;a.shadow=null;a.compositeOperation=null;a.initialize=function(c,a,b,d,h,j){if(c!=null)this.a=c;this.b=a||0;this.c=b||0;if(d!=null)this.d=d;this.tx=h||0;this.ty=j||0};a.prepend=function(c,a,b,d,h,j){var k=this.tx;if(c!=1||a!=0||b!=0||d!=1){var l=this.a,m=this.c;this.a=l*c+this.b*b;this.b=l*a+this.b*d;this.c=m*c+this.d*b;this.d=
m*a+this.d*d}this.tx=k*c+this.ty*b+h;this.ty=k*a+this.ty*d+j};a.append=function(c,a,b,d,h,j){var k=this.a,l=this.b,m=this.c,q=this.d;this.a=c*k+a*m;this.b=c*l+a*q;this.c=b*k+d*m;this.d=b*l+d*q;this.tx=h*k+j*m+this.tx;this.ty=h*l+j*q+this.ty};a.prependMatrix=function(c){this.prepend(c.a,c.b,c.c,c.d,c.tx,c.ty);this.prependProperties(c.alpha,c.shadow,c.compositeOperation)};a.appendMatrix=function(c){this.append(c.a,c.b,c.c,c.d,c.tx,c.ty);this.appendProperties(c.alpha,c.shadow,c.compositeOperation)};
a.prependTransform=function(c,a,d,e,h,j,k,l,m){if(h%360)var q=h*b.DEG_TO_RAD,h=Math.cos(q),q=Math.sin(q);else h=1,q=0;if(l||m)this.tx-=l,this.ty-=m;j||k?(j*=b.DEG_TO_RAD,k*=b.DEG_TO_RAD,this.prepend(h*d,q*d,-q*e,h*e,0,0),this.prepend(Math.cos(k),Math.sin(k),-Math.sin(j),Math.cos(j),c,a)):this.prepend(h*d,q*d,-q*e,h*e,c,a)};a.appendTransform=function(c,a,d,e,h,j,k,l,m){if(h%360)var q=h*b.DEG_TO_RAD,h=Math.cos(q),q=Math.sin(q);else h=1,q=0;j||k?(j*=b.DEG_TO_RAD,k*=b.DEG_TO_RAD,this.append(Math.cos(k),
Math.sin(k),-Math.sin(j),Math.cos(j),c,a),this.append(h*d,q*d,-q*e,h*e,0,0)):this.append(h*d,q*d,-q*e,h*e,c,a);if(l||m)this.tx-=l*this.a+m*this.c,this.ty-=l*this.b+m*this.d};a.rotate=function(c){var a=Math.cos(c),c=Math.sin(c),b=this.a,d=this.c,h=this.tx;this.a=b*a-this.b*c;this.b=b*c+this.b*a;this.c=d*a-this.d*c;this.d=d*c+this.d*a;this.tx=h*a-this.ty*c;this.ty=h*c+this.ty*a};a.skew=function(c,a){c*=b.DEG_TO_RAD;a*=b.DEG_TO_RAD;this.append(Math.cos(a),Math.sin(a),-Math.sin(c),Math.cos(c),0,0)};a.scale=
function(c,a){this.a*=c;this.d*=a;this.tx*=c;this.ty*=a};a.translate=function(c,a){this.tx+=c;this.ty+=a};a.identity=function(){this.alpha=this.a=this.d=1;this.b=this.c=this.tx=this.ty=0;this.shadow=this.compositeOperation=null};a.invert=function(){var c=this.a,a=this.b,b=this.c,d=this.d,h=this.tx,j=c*d-a*b;this.a=d/j;this.b=-a/j;this.c=-b/j;this.d=c/j;this.tx=(b*this.ty-d*h)/j;this.ty=-(c*this.ty-a*h)/j};a.isIdentity=function(){return this.tx==0&&this.ty==0&&this.a==1&&this.b==0&&this.c==0&&this.d==
1};a.decompose=function(c){c==null&&(c={});c.x=this.tx;c.y=this.ty;c.scaleX=Math.sqrt(this.a*this.a+this.b*this.b);c.scaleY=Math.sqrt(this.c*this.c+this.d*this.d);var a=Math.atan2(-this.c,this.d),d=Math.atan2(this.b,this.a);a==d?(c.rotation=d/b.DEG_TO_RAD,this.a<0&&this.d>=0&&(c.rotation+=c.rotation<=0?180:-180),c.skewX=c.skewY=0):(c.skewX=a/b.DEG_TO_RAD,c.skewY=d/b.DEG_TO_RAD);return c};a.reinitialize=function(c,a,b,d,h,j,k,l,m){this.initialize(c,a,b,d,h,j);this.alpha=k||1;this.shadow=l;this.compositeOperation=
m;return this};a.appendProperties=function(c,a,b){this.alpha*=c;this.shadow=a||this.shadow;this.compositeOperation=b||this.compositeOperation};a.prependProperties=function(c,a,b){this.alpha*=c;this.shadow=this.shadow||a;this.compositeOperation=this.compositeOperation||b};a.clone=function(){var c=new b(this.a,this.b,this.c,this.d,this.tx,this.ty);c.shadow=this.shadow;c.alpha=this.alpha;c.compositeOperation=this.compositeOperation;return c};a.toString=function(){return"[Matrix2D (a="+this.a+" b="+this.b+
" c="+this.c+" d="+this.d+" tx="+this.tx+" ty="+this.ty+")]"};b.identity=new b(1,0,0,1,0,0);d.Matrix2D=b})(window);(function(d){var b=function(c,a){this.initialize(c,a)},a=b.prototype;a.x=0;a.y=0;a.initialize=function(c,a){this.x=c==null?0:c;this.y=a==null?0:a};a.clone=function(){return new b(this.x,this.y)};a.toString=function(){return"[Point (x="+this.x+" y="+this.y+")]"};d.Point=b})(window);(function(d){var b=function(c,a,b,d){this.initialize(c,a,b,d)},a=b.prototype;a.x=0;a.y=0;a.width=0;a.height=0;a.initialize=function(c,a,b,d){this.x=c==null?0:c;this.y=a==null?0:a;this.width=b==null?0:b;this.height=d==null?0:d};a.clone=function(){return new b(this.x,this.y,this.width,this.height)};a.toString=function(){return"[Rectangle (x="+this.x+" y="+this.y+" width="+this.width+" height="+this.height+")]"};d.Rectangle=b})(window);(function(d){var b=function(c,a,b,d){this.initialize(c,a,b,d)},a=b.prototype;b.identity=null;a.color=null;a.offsetX=0;a.offsetY=0;a.blur=0;a.initialize=function(c,a,b,d){this.color=c;this.offsetX=a;this.offsetY=b;this.blur=d};a.toString=function(){return"[Shadow]"};a.clone=function(){return new b(this.color,this.offsetX,this.offsetY,this.blur)};b.identity=new b("transparent",0,0,0);d.Shadow=b})(window);(function(d){var b=function(c){this.initialize(c)},a=b.prototype;a.complete=true;a._animations=null;a._frames=null;a._images=null;a._data=null;a._loadCount=0;a._frameHeight=0;a._frameWidth=0;a._numFrames=0;a._regX=0;a._regY=0;a.initialize=function(c){var a,b,d;if(c!=null){if(c.images&&(b=c.images.length)>0){d=this._images=[];for(a=0;a<b;a++){var h=c.images[a];if(!(h instanceof Image)){var j=h,h=new Image;h.src=j}d.push(h);if(!h.getContext&&!h.complete)this._loadCount++,this.complete=false,function(c){h.onload=
function(){c._handleImageLoad()}}(this)}}if(c.frames!=null)if(c.frames instanceof Array){this._frames=[];d=c.frames;for(a=0,b=d.length;a<b;a++)j=d[a],this._frames.push({image:this._images[j[4]?j[4]:0],rect:new Rectangle(j[0],j[1],j[2],j[3]),regX:j[5]||0,regY:j[6]||0})}else b=c.frames,this._frameWidth=b.width,this._frameHeight=b.height,this._regX=b.regX||0,this._regY=b.regY||0,this._numFrames=b.count,this._loadCount==0&&this._calculateFrames();if((b=c.animations)!=null){this._animations=[];this._data=
{};for(var k in b){c={name:k};j=b[k];if(isNaN(j))if(j instanceof Array){c.frequency=j[3];c.next=j[2];d=c.frames=[];for(a=j[0];a<=j[1];a++)d.push(a)}else c.frequency=j.frequency,c.next=j.next,d=c.frames=j.frames.slice(0);else d=c.frames=[j];c.next=d.length<2||c.next==false?null:c.next==true?k:c.next;if(!c.frequency)c.frequency=1;this._animations.push(k);this._data[k]=c}}}};a.getNumFrames=function(c){return c==null?this._frames?this._frames.length:this._numFrames:(c=this._data[c],c==null?0:c.frames.length)};
a.getAnimations=function(){return this._animations.slice(0)};a.getAnimation=function(c){return this._data[c]};a.getFrame=function(c){return this.complete&&this._frames&&(frame=this._frames[c])?frame:null};a.toString=function(){return"[SpriteSheet]"};a.clone=function(){var c=new b;c.complete=this.complete;c._animations=this._animations;c._frames=this._frames;c._images=this._images;c._data=this._data;c._frameHeight=this._frameHeight;c._frameWidth=this._frameWidth;c._numFrames=this._numFrames;c._loadCount=
this._loadCount;return c};a._handleImageLoad=function(){if(--this._loadCount==0)this._calculateFrames(),this.complete=true};a._calculateFrames=function(){if(!(this._frames||this._frameWidth==0)){this._frames=[];for(var c=0,a=this._frameWidth,b=this._frameHeight,d=0,h=this._images;d<h.length;d++){for(var j=h[d],k=(j.width+1)/a|0,l=(j.height+1)/b|0,l=this._numFrames>0?Math.min(this._numFrames-c,k*l):k*l,m=0;m<l;m++)this._frames.push({image:j,rect:new Rectangle(m%k*a,(m/k|0)*b,a,b),regX:this._regX,regY:this._regY});
c+=l}this._numFrames=c}};d.SpriteSheet=b})(window);(function(d){function b(c,a){this.f=c;this.params=a}b.prototype.exec=function(c){this.f.apply(c,this.params)};var a=function(){this.initialize()},c=a.prototype;a.getRGB=function(c,a,b,d){c!=null&&b==null&&(d=a,b=c&255,a=c>>8&255,c=c>>16&255);return d==null?"rgb("+c+","+a+","+b+")":"rgba("+c+","+a+","+b+","+d+")"};a.getHSL=function(c,a,b,d){return d==null?"hsl("+c%360+","+a+"%,"+b+"%)":"hsla("+c%360+","+a+"%,"+b+"%,"+d+")"};a.STROKE_CAPS_MAP=["butt","round","square"];a.STROKE_JOINTS_MAP=["miter","round",
"bevel"];a._ctx=document.createElement("canvas").getContext("2d");a.beginCmd=new b(a._ctx.beginPath,[]);a.fillCmd=new b(a._ctx.fill,[]);a.strokeCmd=new b(a._ctx.stroke,[]);c._strokeInstructions=null;c._strokeStyleInstructions=null;c._fillInstructions=null;c._instructions=null;c._oldInstructions=null;c._activeInstructions=null;c._active=false;c._dirty=false;c.initialize=function(){this.clear();this._ctx=a._ctx};c.draw=function(c){this._dirty&&this._updateInstructions();for(var a=this._instructions,
b=0,d=a.length;b<d;b++)a[b].exec(c)};c.moveTo=function(c,a){this._activeInstructions.push(new b(this._ctx.moveTo,[c,a]));return this};c.lineTo=function(c,a){this._dirty=this._active=true;this._activeInstructions.push(new b(this._ctx.lineTo,[c,a]));return this};c.arcTo=function(c,a,d,h,j){this._dirty=this._active=true;this._activeInstructions.push(new b(this._ctx.arcTo,[c,a,d,h,j]));return this};c.arc=function(c,a,d,h,j,k){this._dirty=this._active=true;k==null&&(k=false);this._activeInstructions.push(new b(this._ctx.arc,
[c,a,d,h,j,k]));return this};c.quadraticCurveTo=function(c,a,d,h){this._dirty=this._active=true;this._activeInstructions.push(new b(this._ctx.quadraticCurveTo,[c,a,d,h]));return this};c.bezierCurveTo=function(c,a,d,h,j,k){this._dirty=this._active=true;this._activeInstructions.push(new b(this._ctx.bezierCurveTo,[c,a,d,h,j,k]));return this};c.rect=function(c,a,d,h){this._dirty=this._active=true;this._activeInstructions.push(new b(this._ctx.rect,[c,a,d,h]));return this};c.closePath=function(){if(this._active)this._dirty=
true,this._activeInstructions.push(new b(this._ctx.closePath,[]));return this};c.clear=function(){this._instructions=[];this._oldInstructions=[];this._activeInstructions=[];this._strokeStyleInstructions=this._strokeInstructions=this._fillInstructions=null;this._active=this._dirty=false;return this};c.beginFill=function(c){this._active&&this._newPath();this._fillInstructions=c?[new b(this._setProp,["fillStyle",c])]:null;return this};c.beginLinearGradientFill=function(c,a,d,h,j,k){this._active&&this._newPath();
d=this._ctx.createLinearGradient(d,h,j,k);h=0;for(j=c.length;h<j;h++)d.addColorStop(a[h],c[h]);this._fillInstructions=[new b(this._setProp,["fillStyle",d])];return this};c.beginRadialGradientFill=function(c,a,d,h,j,k,l,m){this._active&&this._newPath();d=this._ctx.createRadialGradient(d,h,j,k,l,m);h=0;for(j=c.length;h<j;h++)d.addColorStop(a[h],c[h]);this._fillInstructions=[new b(this._setProp,["fillStyle",d])];return this};c.beginBitmapFill=function(c,a){this._active&&this._newPath();var d=this._ctx.createPattern(c,
a||"");this._fillInstructions=[new b(this._setProp,["fillStyle",d])];return this};c.endFill=function(){this.beginFill(null);return this};c.setStrokeStyle=function(c,d,e,h){this._active&&this._newPath();this._strokeStyleInstructions=[new b(this._setProp,["lineWidth",c==null?"1":c]),new b(this._setProp,["lineCap",d==null?"butt":isNaN(d)?d:a.STROKE_CAPS_MAP[d]]),new b(this._setProp,["lineJoin",e==null?"miter":isNaN(e)?e:a.STROKE_JOINTS_MAP[e]]),new b(this._setProp,["miterLimit",h==null?"10":h])];return this};
c.beginStroke=function(c){this._active&&this._newPath();this._strokeInstructions=c?[new b(this._setProp,["strokeStyle",c])]:null;return this};c.beginLinearGradientStroke=function(c,a,d,h,j,k){this._active&&this._newPath();d=this._ctx.createLinearGradient(d,h,j,k);h=0;for(j=c.length;h<j;h++)d.addColorStop(a[h],c[h]);this._strokeInstructions=[new b(this._setProp,["strokeStyle",d])];return this};c.beginRadialGradientStroke=function(c,a,d,h,j,k,l,m){this._active&&this._newPath();d=this._ctx.createRadialGradient(d,
h,j,k,l,m);h=0;for(j=c.length;h<j;h++)d.addColorStop(a[h],c[h]);this._strokeInstructions=[new b(this._setProp,["strokeStyle",d])];return this};c.beginBitmapStroke=function(c,a){this._active&&this._newPath();var d=this._ctx.createPattern(c,a||"");this._strokeInstructions=[new b(this._setProp,["strokeStyle",d])];return this};c.endStroke=function(){this.beginStroke(null);return this};c.curveTo=c.quadraticCurveTo;c.drawRect=c.rect;c.drawRoundRect=function(c,a,b,d,j){this.drawRoundRectComplex(c,a,b,d,
j,j,j,j);return this};c.drawRoundRectComplex=function(c,a,d,h,j,k,l,m){this._dirty=this._active=true;this._activeInstructions.push(new b(this._ctx.moveTo,[c+j,a]),new b(this._ctx.lineTo,[c+d-k,a]),new b(this._ctx.arc,[c+d-k,a+k,k,-Math.PI/2,0,false]),new b(this._ctx.lineTo,[c+d,a+h-l]),new b(this._ctx.arc,[c+d-l,a+h-l,l,0,Math.PI/2,false]),new b(this._ctx.lineTo,[c+m,a+h]),new b(this._ctx.arc,[c+m,a+h-m,m,Math.PI/2,Math.PI,false]),new b(this._ctx.lineTo,[c,a+j]),new b(this._ctx.arc,[c+j,a+j,j,Math.PI,
Math.PI*3/2,false]));return this};c.drawCircle=function(c,a,b){this.arc(c,a,b,0,Math.PI*2);return this};c.drawEllipse=function(c,a,d,h){this._dirty=this._active=true;var j=d/2*0.5522848,k=h/2*0.5522848,l=c+d,m=a+h,d=c+d/2,h=a+h/2;this._activeInstructions.push(new b(this._ctx.moveTo,[c,h]),new b(this._ctx.bezierCurveTo,[c,h-k,d-j,a,d,a]),new b(this._ctx.bezierCurveTo,[d+j,a,l,h-k,l,h]),new b(this._ctx.bezierCurveTo,[l,h+k,d+j,m,d,m]),new b(this._ctx.bezierCurveTo,[d-j,m,c,h+k,c,h]));return this};c.drawPolyStar=
function(c,a,d,h,j,k){this._dirty=this._active=true;j==null&&(j=0);j=1-j;k==null?k=0:k/=180/Math.PI;var l=Math.PI/h;this._activeInstructions.push(new b(this._ctx.moveTo,[c+Math.cos(k)*d,a+Math.sin(k)*d]));for(var m=0;m<h;m++)k+=l,j!=1&&this._activeInstructions.push(new b(this._ctx.lineTo,[c+Math.cos(k)*d*j,a+Math.sin(k)*d*j])),k+=l,this._activeInstructions.push(new b(this._ctx.lineTo,[c+Math.cos(k)*d,a+Math.sin(k)*d]));return this};c.clone=function(){var c=new a;c._instructions=this._instructions.slice();
c._activeInstructions=this._activeInstructions.slice();c._oldInstructions=this._oldInstructions.slice();if(this._fillInstructions)c._fillInstructions=this._fillInstructions.slice();if(this._strokeInstructions)c._strokeInstructions=this._strokeInstructions.slice();if(this._strokeStyleInstructions)c._strokeStyleInstructions=this._strokeStyleInstructions.slice();c._active=this._active;c._dirty=this._dirty;return c};c.toString=function(){return"[Graphics]"};c.mt=c.moveTo;c.lt=c.lineTo;c.at=c.arcTo;c.bt=
c.bezierCurveTo;c.qt=c.quadraticCurveTo;c.a=c.arc;c.r=c.rect;c.cp=c.closePath;c.c=c.clear;c.f=c.beginFill;c.lf=c.beginLinearGradientFill;c.rf=c.beginRadialGradientFill;c.bf=c.beginBitmapFill;c.ef=c.endFill;c.ss=c.setStrokeStyle;c.s=c.beginStroke;c.ls=c.beginLinearGradientStroke;c.rs=c.beginRadialGradientStroke;c.bs=c.beginBitmapStroke;c.es=c.endStroke;c.dr=c.drawRect;c.rr=c.drawRoundRect;c.rc=c.drawRoundRectComplex;c.dc=c.drawCircle;c.de=c.drawEllipse;c.dp=c.drawPolyStar;c._updateInstructions=function(){this._instructions=
this._oldInstructions.slice();this._instructions.push(a.beginCmd);this._fillInstructions&&this._instructions.push.apply(this._instructions,this._fillInstructions);this._strokeInstructions&&(this._instructions.push.apply(this._instructions,this._strokeInstructions),this._strokeStyleInstructions&&this._instructions.push.apply(this._instructions,this._strokeStyleInstructions));this._instructions.push.apply(this._instructions,this._activeInstructions);this._fillInstructions&&this._instructions.push(a.fillCmd);
this._strokeInstructions&&this._instructions.push(a.strokeCmd)};c._newPath=function(){this._dirty&&this._updateInstructions();this._oldInstructions=this._instructions;this._activeInstructions=[];this._active=this._dirty=false};c._setProp=function(c,a){this[c]=a};d.Graphics=a})(window);(function(d){var b=function(){this.initialize()},a=b.prototype;b.suppressCrossDomainErrors=false;b._hitTestCanvas=document.createElement("canvas");b._hitTestCanvas.width=b._hitTestCanvas.height=1;b._hitTestContext=b._hitTestCanvas.getContext("2d");a.alpha=1;a.cacheCanvas=null;a.id=-1;a.mouseEnabled=true;a.name=null;a.parent=null;a.regX=0;a.regY=0;a.rotation=0;a.scaleX=1;a.scaleY=1;a.skewX=0;a.skewY=0;a.shadow=null;a.visible=true;a.x=0;a.y=0;a.compositeOperation=null;a.snapToPixel=false;a.onPress=
null;a.onClick=null;a.onDoubleClick=null;a.onMouseOver=null;a.onMouseOut=null;a.tick=null;a.filters=null;a.cacheID=0;a._cacheOffsetX=0;a._cacheOffsetY=0;a._cacheDataURLID=0;a._cacheDataURL=null;a._matrix=null;a.initialize=function(){this.id=UID.get();this._matrix=new Matrix2D};a.isVisible=function(){return this.visible&&this.alpha>0&&this.scaleX!=0&&this.scaleY!=0};a.draw=function(c,a){if(a||!this.cacheCanvas)return false;c.drawImage(this.cacheCanvas,this._cacheOffsetX,this._cacheOffsetY);return true};
a.cache=function(c,a,b,d){if(this.cacheCanvas==null)this.cacheCanvas=document.createElement("canvas");var h=this.cacheCanvas.getContext("2d");this.cacheCanvas.width=b;this.cacheCanvas.height=d;h.clearRect(0,0,b+1,d+1);h.setTransform(1,0,0,1,-c,-a);this.draw(h,true,this._matrix.reinitialize(1,0,0,1,-c,-a));this._cacheOffsetX=c;this._cacheOffsetY=a;this._applyFilters();this.cacheID++};a.updateCache=function(c){if(this.cacheCanvas==null)throw"cache() must be called before updateCache()";var a=this.cacheCanvas.getContext("2d");
a.setTransform(1,0,0,1,-this._cacheOffsetX,-this._cacheOffsetY);c?a.globalCompositeOperation=c:a.clearRect(0,0,this.cacheCanvas.width+1,this.cacheCanvas.height+1);this.draw(a,true);if(c)a.globalCompositeOperation="source-over";this._applyFilters();this.cacheID++};a.uncache=function(){this._cacheDataURL=this.cacheCanvas=null;this._cacheOffsetX=this._cacheOffsetY=0};a.getCacheDataURL=function(){if(!this.cacheCanvas)return null;if(this.cacheID!=this._cacheDataURLID)this._cacheDataURL=this.cacheCanvas.toDataURL();
return this._cacheDataURL};a.getStage=function(){for(var c=this;c.parent;)c=c.parent;return c instanceof Stage?c:null};a.localToGlobal=function(c,a){var b=this.getConcatenatedMatrix(this._matrix);if(b==null)return null;b.append(1,0,0,1,c,a);return new Point(b.tx,b.ty)};a.globalToLocal=function(c,a){var b=this.getConcatenatedMatrix(this._matrix);if(b==null)return null;b.invert();b.append(1,0,0,1,c,a);return new Point(b.tx,b.ty)};a.localToLocal=function(c,a,b){c=this.localToGlobal(c,a);return b.globalToLocal(c.x,
c.y)};a.setTransform=function(c,a,b,d,h,j,k,l,m){this.x=c||0;this.y=a||0;this.scaleX=b==null?1:b;this.scaleY=d==null?1:d;this.rotation=h||0;this.skewX=j||0;this.skewY=k||0;this.regX=l||0;this.regY=m||0};a.getConcatenatedMatrix=function(c){c?c.identity():c=new Matrix2D;for(var a=this;a!=null;)c.prependTransform(a.x,a.y,a.scaleX,a.scaleY,a.rotation,a.skewX,a.skewY,a.regX,a.regY),c.prependProperties(a.alpha,a.shadow,a.compositeOperation),a=a.parent;return c};a.hitTest=function(c,a){var d=b._hitTestContext,
e=b._hitTestCanvas;d.setTransform(1,0,0,1,-c,-a);this.draw(d);d=this._testHit(d);e.width=0;e.width=1;return d};a.clone=function(){var c=new b;this.cloneProps(c);return c};a.toString=function(){return"[DisplayObject (name="+this.name+")]"};a.cloneProps=function(c){c.alpha=this.alpha;c.name=this.name;c.regX=this.regX;c.regY=this.regY;c.rotation=this.rotation;c.scaleX=this.scaleX;c.scaleY=this.scaleY;c.shadow=this.shadow;c.skewX=this.skewX;c.skewY=this.skewY;c.visible=this.visible;c.x=this.x;c.y=this.y;
c.mouseEnabled=this.mouseEnabled;c.compositeOperation=this.compositeOperation;if(this.cacheCanvas)c.cacheCanvas=this.cacheCanvas.cloneNode(true),c.cacheCanvas.getContext("2d").putImageData(this.cacheCanvas.getContext("2d").getImageData(0,0,this.cacheCanvas.width,this.cacheCanvas.height),0,0)};a.applyShadow=function(c,a){a=a||Shadow.identity;c.shadowColor=a.color;c.shadowOffsetX=a.offsetX;c.shadowOffsetY=a.offsetY;c.shadowBlur=a.blur};a._testHit=function(c){try{var a=c.getImageData(0,0,1,1).data[3]>
1}catch(d){if(!b.suppressCrossDomainErrors)throw"An error has occured. This is most likely due to security restrictions on reading canvas pixel data with local or cross-domain images.";}return a};a._applyFilters=function(){if(this.filters&&this.filters.length!=0&&this.cacheCanvas)for(var c=this.filters.length,a=this.cacheCanvas.getContext("2d"),b=this.cacheCanvas.width,d=this.cacheCanvas.height,h=0;h<c;h++)this.filters[h].applyFilter(a,0,0,b,d)};d.DisplayObject=b})(window);(function(d){var b=function(){this.initialize()},a=b.prototype=new DisplayObject;a.children=null;a.DisplayObject_initialize=a.initialize;a.initialize=function(){this.DisplayObject_initialize();this.children=[]};a.isVisible=function(){return this.visible&&this.alpha>0&&this.children.length&&this.scaleX!=0&&this.scaleY!=0};a.DisplayObject_draw=a.draw;a.draw=function(c,a,d){var e=Stage._snapToPixelEnabled;if(this.DisplayObject_draw(c,a))return true;for(var d=d||this._matrix.reinitialize(1,0,0,1,0,0,
this.alpha,this.shadow,this.compositeOperation),a=this.children.length,h=this.children.slice(0),j=0;j<a;j++){var k=h[j];if(k.isVisible()){var l=false,m=k._matrix.reinitialize(d.a,d.b,d.c,d.d,d.tx,d.ty,d.alpha,d.shadow,d.compositeOperation);m.appendTransform(k.x,k.y,k.scaleX,k.scaleY,k.rotation,k.skewX,k.skewY,k.regX,k.regY);m.appendProperties(k.alpha,k.shadow,k.compositeOperation);if(!(k instanceof b&&k.cacheCanvas==null))e&&k.snapToPixel&&m.a==1&&m.b==0&&m.c==0&&m.d==1?c.setTransform(m.a,m.b,m.c,
m.d,m.tx+0.5|0,m.ty+0.5|0):c.setTransform(m.a,m.b,m.c,m.d,m.tx,m.ty),c.globalAlpha=m.alpha,c.globalCompositeOperation=m.compositeOperation||"source-over",(l=m.shadow)&&this.applyShadow(c,l);k.draw(c,false,m);l&&this.applyShadow(c)}}return true};a.addChild=function(c){var a=arguments.length;if(a>1){for(var b=0;b<a;b++)this.addChild(arguments[b]);return arguments[a-1]}c.parent&&c.parent.removeChild(c);c.parent=this;this.children.push(c);return c};a.addChildAt=function(c,a){var b=arguments.length;if(b>
2){for(var a=arguments[d-1],d=0;d<b-1;d++)this.addChildAt(arguments[d],a+d);return arguments[b-2]}c.parent&&c.parent.removeChild(c);c.parent=this;this.children.splice(a,0,c);return c};a.removeChild=function(c){var a=arguments.length;if(a>1){for(var b=true,d=0;d<a;d++)b=b&&this.removeChild(arguments[d]);return b}return this.removeChildAt(this.children.indexOf(c))};a.removeChildAt=function(c){var a=arguments.length;if(a>1){for(var b=[],d=0;d<a;d++)b[d]=arguments[d];b.sort(function(c,a){return a-c});
for(var h=true,d=0;d<a;d++)h=h&&this.removeChildAt(b[d]);return h}if(c<0||c>this.children.length-1)return false;a=this.children[c];if(a!=null)a.parent=null;this.children.splice(c,1);return true};a.removeAllChildren=function(){for(;this.children.length;)this.removeChildAt(0)};a.getChildAt=function(c){return this.children[c]};a.sortChildren=function(c){this.children.sort(c)};a.getChildIndex=function(c){return this.children.indexOf(c)};a.getNumChildren=function(){return this.children.length};a.contains=
function(c){for(;c;){if(c==this)return true;c=c.parent}return false};a.hitTest=function(c,a){return this.getObjectUnderPoint(c,a)!=null};a.getObjectsUnderPoint=function(c,a){var b=[],d=this.localToGlobal(c,a);this._getObjectsUnderPoint(d.x,d.y,b);return b};a.getObjectUnderPoint=function(c,a){var b=this.localToGlobal(c,a);return this._getObjectsUnderPoint(b.x,b.y)};a.clone=function(c){var a=new b;this.cloneProps(a);if(c)for(var d=a.children=[],e=0,h=this.children.length;e<h;e++){var j=this.children[e].clone(c);
j.parent=a;d.push(j)}return a};a.toString=function(){return"[Container (name="+this.name+")]"};a._tick=function(){for(var c=this.children.length-1;c>=0;c--){var a=this.children[c];a._tick&&a._tick();a.tick&&a.tick()}};a._getObjectsUnderPoint=function(c,a,d,e){var h=DisplayObject._hitTestContext,j=DisplayObject._hitTestCanvas,k=this._matrix,l=e&1&&(this.onPress||this.onClick||this.onDoubleClick)||e&2&&(this.onMouseOver||this.onMouseOut);if(this.cacheCanvas)if(this.getConcatenatedMatrix(k),h.setTransform(k.a,
k.b,k.c,k.d,k.tx-c,k.ty-a),h.globalAlpha=k.alpha,this.draw(h),this._testHit(h)){if(j.width=0,j.width=1,l)return this}else return null;for(var m=this.children.length-1;m>=0;m--){var q=this.children[m];if(q.isVisible()&&q.mouseEnabled)if(q instanceof b)if(l){if(q=q._getObjectsUnderPoint(c,a))return this}else{if(q=q._getObjectsUnderPoint(c,a,d,e),!d&&q)return q}else if(!e||l||e&1&&(q.onPress||q.onClick||q.onDoubleClick)||e&2&&(q.onMouseOver||q.onMouseOut))if(q.getConcatenatedMatrix(k),h.setTransform(k.a,
k.b,k.c,k.d,k.tx-c,k.ty-a),h.globalAlpha=k.alpha,q.draw(h),this._testHit(h))if(j.width=0,j.width=1,l)return this;else if(d)d.push(q);else return q}return null};d.Container=b})(window);(function(d){var b=function(c){this.initialize(c)},a=b.prototype=new Container;b._snapToPixelEnabled=false;a.autoClear=true;a.canvas=null;a.mouseX=null;a.mouseY=null;a.onMouseMove=null;a.onMouseUp=null;a.onMouseDown=null;a.snapToPixelEnabled=false;a.mouseInBounds=false;a.tickOnUpdate=true;a._activeMouseEvent=null;a._activeMouseTarget=null;a._mouseOverIntervalID=null;a._mouseOverX=0;a._mouseOverY=0;a._mouseOverTarget=null;a.Container_initialize=a.initialize;a.initialize=function(c){this.Container_initialize();
this.canvas=c instanceof HTMLCanvasElement?c:document.getElementById(c);this._enableMouseEvents(true)};a.update=function(){if(this.canvas)this.autoClear&&this.clear(),b._snapToPixelEnabled=this.snapToPixelEnabled,this.tickOnUpdate&&this._tick(),this.draw(this.canvas.getContext("2d"),false,this.getConcatenatedMatrix(this._matrix))};a.tick=a.update;a.clear=function(){if(this.canvas){var c=this.canvas.getContext("2d");c.setTransform(1,0,0,1,0,0);c.clearRect(0,0,this.canvas.width,this.canvas.height)}};
a.toDataURL=function(c,a){a||(a="image/png");var b=this.canvas.getContext("2d"),d=this.canvas.width,h=this.canvas.height,j;if(c){j=b.getImageData(0,0,d,h);var k=b.globalCompositeOperation;b.globalCompositeOperation="destination-over";b.fillStyle=c;b.fillRect(0,0,d,h)}var l=this.canvas.toDataURL(a);if(c)b.clearRect(0,0,d,h),b.putImageData(j,0,0),b.globalCompositeOperation=k;return l};a.enableMouseOver=function(c){if(this._mouseOverIntervalID)clearInterval(this._mouseOverIntervalID),this._mouseOverIntervalID=
null;if(!(c<=0)){var a=this;this._mouseOverIntervalID=setInterval(function(){a._testMouseOver()},1E3/Math.min(50,c));this._mouseOverX=NaN;this._mouseOverTarget=null}};a.clone=function(){var c=new b(null);this.cloneProps(c);return c};a.toString=function(){return"[Stage (name="+this.name+")]"};a._enableMouseEvents=function(){var c=this,a=d.addEventListener?d:document;a.addEventListener("mouseup",function(a){c._handleMouseUp(a)},false);a.addEventListener("mousemove",function(a){c._handleMouseMove(a)},
false);a.addEventListener("dblclick",function(a){c._handleDoubleClick(a)},false);this.canvas&&this.canvas.addEventListener("mousedown",function(a){c._handleMouseDown(a)},false)};a._handleMouseMove=function(a){if(this.canvas){if(!a)a=d.event;var b=this.mouseInBounds;this._updateMousePosition(a.pageX,a.pageY);if(b||this.mouseInBounds){a=new MouseEvent("onMouseMove",this.mouseX,this.mouseY,this,a);if(this.onMouseMove)this.onMouseMove(a);if(this._activeMouseEvent&&this._activeMouseEvent.onMouseMove)this._activeMouseEvent.onMouseMove(a)}}else this.mouseX=
this.mouseY=null};a._updateMousePosition=function(a,b){var d=this.canvas;do a-=d.offsetLeft,b-=d.offsetTop;while(d=d.offsetParent);if(this.mouseInBounds=a>=0&&b>=0&&a<this.canvas.width&&b<this.canvas.height)this.mouseX=a,this.mouseY=b};a._handleMouseUp=function(a){var b=new MouseEvent("onMouseUp",this.mouseX,this.mouseY,this,a);if(this.onMouseUp)this.onMouseUp(b);if(this._activeMouseEvent&&this._activeMouseEvent.onMouseUp)this._activeMouseEvent.onMouseUp(b);if(this._activeMouseTarget&&this._activeMouseTarget.onClick&&
this._getObjectsUnderPoint(this.mouseX,this.mouseY,null,true,this._mouseOverIntervalID?3:1)==this._activeMouseTarget)this._activeMouseTarget.onClick(new MouseEvent("onClick",this.mouseX,this.mouseY,this._activeMouseTarget,a));this._activeMouseEvent=this._activeMouseTarget=null};a._handleMouseDown=function(a){if(this.onMouseDown)this.onMouseDown(new MouseEvent("onMouseDown",this.mouseX,this.mouseY,this,a));var b=this._getObjectsUnderPoint(this.mouseX,this.mouseY,null,this._mouseOverIntervalID?3:1);
if(b){if(b.onPress instanceof Function&&(a=new MouseEvent("onPress",this.mouseX,this.mouseY,b,a),b.onPress(a),a.onMouseMove||a.onMouseUp))this._activeMouseEvent=a;this._activeMouseTarget=b}};a._testMouseOver=function(){if(!(this.mouseX==this._mouseOverX&&this.mouseY==this._mouseOverY&&this.mouseInBounds)){var a=null;if(this.mouseInBounds)a=this._getObjectsUnderPoint(this.mouseX,this.mouseY,null,3),this._mouseOverX=this.mouseX,this._mouseOverY=this.mouseY;if(this._mouseOverTarget!=a){if(this._mouseOverTarget&&
this._mouseOverTarget.onMouseOut)this._mouseOverTarget.onMouseOut(new MouseEvent("onMouseOut",this.mouseX,this.mouseY,this._mouseOverTarget));if(a&&a.onMouseOver)a.onMouseOver(new MouseEvent("onMouseOver",this.mouseX,this.mouseY,a));this._mouseOverTarget=a}}};a._handleDoubleClick=function(a){if(this.onDoubleClick)this.onDoubleClick(new MouseEvent("onDoubleClick",this.mouseX,this.mouseY,this,a));var b=this._getObjectsUnderPoint(this.mouseX,this.mouseY,null,this._mouseOverIntervalID?3:1);if(b&&b.onDoubleClick instanceof
Function)b.onDoubleClick(new MouseEvent("onPress",this.mouseX,this.mouseY,b,a))};d.Stage=b})(window);(function(d){var b=function(a){this.initialize(a)},a=b.prototype=new DisplayObject;a.image=null;a.snapToPixel=true;a.DisplayObject_initialize=a.initialize;a.initialize=function(a){this.DisplayObject_initialize();typeof a=="string"?(this.image=new Image,this.image.src=a):this.image=a};a.isVisible=function(){return this.visible&&this.alpha>0&&this.scaleX!=0&&this.scaleY!=0&&this.image&&(this.image.complete||this.image.getContext||this.image.readyState==2)};a.DisplayObject_draw=a.draw;a.draw=function(a,
b){if(this.DisplayObject_draw(a,b))return true;a.drawImage(this.image,0,0);return true};a.clone=function(){var a=new b(this.image);this.cloneProps(a);return a};a.toString=function(){return"[Bitmap (name="+this.name+")]"};d.Bitmap=b})(window);(function(d){var b=function(a){this.initialize(a)},a=b.prototype=new DisplayObject;a.onAnimationEnd=null;a.currentFrame=-1;a.currentAnimation=null;a.paused=true;a.spriteSheet=null;a.snapToPixel=true;a.offset=0;a.currentAnimationFrame=0;a._advanceCount=0;a._animation=null;a.DisplayObject_initialize=a.initialize;a.initialize=function(a){this.DisplayObject_initialize();this.spriteSheet=a};a.isVisible=function(){return this.visible&&this.alpha>0&&this.scaleX!=0&&this.scaleY!=0&&this.spriteSheet.complete&&
this.currentFrame>=0};a.DisplayObject_draw=a.draw;a.draw=function(a,b){if(this.DisplayObject_draw(a,b))return true;this._normalizeFrame();var d=this.spriteSheet.getFrame(this.currentFrame);if(d!=null){var e=d.rect;a.drawImage(d.image,e.x,e.y,e.width,e.height,-d.regX,-d.regY,e.width,e.height);return true}};a.gotoAndPlay=function(a){this.paused=false;this._goto(a)};a.gotoAndStop=function(a){this.paused=true;this._goto(a)};a.advance=function(){this._animation?this.currentAnimationFrame++:this.currentFrame++;
this._normalizeFrame()};a.clone=function(){var a=new b(this.spriteSheet);this.cloneProps(a);return a};a.toString=function(){return"[BitmapAnimation (name="+this.name+")]"};a._tick=function(){var a=this._animation?this._animation.frequency:1;!this.paused&&(++this._advanceCount+this.offset)%a==0&&this.advance()};a._normalizeFrame=function(){var a=this._animation;if(a)if(this.currentAnimationFrame>=a.frames.length){if(a.next?this._goto(a.next):(this.paused=true,this.currentAnimationFrame=a.frames.length-
1,this.currentFrame=a.frames[this.currentAnimationFrame]),this.onAnimationEnd)this.onAnimationEnd(this,a.name)}else this.currentFrame=a.frames[this.currentAnimationFrame];else if(this.currentFrame>=this.spriteSheet.getNumFrames()&&(this.currentFrame=0,this.onAnimationEnd))this.onAnimationEnd(this,null)};a.DisplayObject_cloneProps=a.cloneProps;a.cloneProps=function(a){this.DisplayObject_cloneProps(a);a.onAnimationEnd=this.onAnimationEnd;a.currentFrame=this.currentFrame;a.currentAnimation=this.currentAnimation;
a.paused=this.paused;a.offset=this.offset;a._animation=this._animation;a.currentAnimationFrame=this.currentAnimationFrame};a._goto=function(a){if(isNaN(a)){var b=this.spriteSheet.getAnimation(a);if(b)this.currentAnimationFrame=0,this._animation=b,this.currentAnimation=a,this._normalizeFrame()}else this.currentAnimation=this._animation=null,this.currentFrame=a};d.BitmapAnimation=b})(window);(function(d){var b=function(a){this.initialize(a)},a=b.prototype=new DisplayObject;a.graphics=null;a.DisplayObject_initialize=a.initialize;a.initialize=function(a){this.DisplayObject_initialize();this.graphics=a?a:new Graphics};a.isVisible=function(){return this.visible&&this.alpha>0&&this.scaleX!=0&&this.scaleY!=0&&this.graphics};a.DisplayObject_draw=a.draw;a.draw=function(a,b){if(this.DisplayObject_draw(a,b))return true;this.graphics.draw(a);return true};a.clone=function(a){a=new b(a&&this.graphics?
this.graphics.clone():this.graphics);this.cloneProps(a);return a};a.toString=function(){return"[Shape (name="+this.name+")]"};d.Shape=b})(window);(function(d){var b=function(a,b,d){this.initialize(a,b,d)},a=b.prototype=new DisplayObject;b._workingContext=document.createElement("canvas").getContext("2d");a.text="";a.font=null;a.color=null;a.textAlign=null;a.textBaseline=null;a.maxWidth=null;a.outline=false;a.lineHeight=null;a.lineWidth=null;a.DisplayObject_initialize=a.initialize;a.initialize=function(a,b,d){this.DisplayObject_initialize();this.text=a;this.font=b;this.color=d?d:"#000"};a.isVisible=function(){return Boolean(this.visible&&this.alpha>
0&&this.scaleX!=0&&this.scaleY!=0&&this.text!=null&&this.text!="")};a.DisplayObject_draw=a.draw;a.draw=function(a,b){if(this.DisplayObject_draw(a,b))return true;this.outline?a.strokeStyle=this.color:a.fillStyle=this.color;a.font=this.font;a.textAlign=this.textAlign?this.textAlign:"start";a.textBaseline=this.textBaseline?this.textBaseline:"alphabetic";for(var d=String(this.text).split(/(?:\r\n|\r|\n)/),e=this.lineHeight==null?this.getMeasuredLineHeight():this.lineHeight,h=0,j=0,k=d.length;j<k;j++){var l=
a.measureText(d[j]).width;if(this.lineWidth==null||l<this.lineWidth)this._drawTextLine(a,d[j],h);else{for(var l=d[j].split(/(\s)/),m=l[0],q=1,r=l.length;q<r;q+=2)a.measureText(m+l[q]+l[q+1]).width>this.lineWidth?(this._drawTextLine(a,m,h),h+=e,m=l[q+1]):m+=l[q]+l[q+1];this._drawTextLine(a,m,h)}h+=e}return true};a.getMeasuredWidth=function(){return this._getWorkingContext().measureText(this.text).width};a.getMeasuredLineHeight=function(){return this._getWorkingContext().measureText("M").width*1.2};
a.clone=function(){var a=new b(this.text,this.font,this.color);this.cloneProps(a);return a};a.toString=function(){return"[Text (text="+(this.text.length>20?this.text.substr(0,17)+"...":this.text)+")]"};a.DisplayObject_cloneProps=a.cloneProps;a.cloneProps=function(a){this.DisplayObject_cloneProps(a);a.textAlign=this.textAlign;a.textBaseline=this.textBaseline;a.maxWidth=this.maxWidth;a.outline=this.outline;a.lineHeight=this.lineHeight;a.lineWidth=this.lineWidth};a._getWorkingContext=function(){var a=
b._workingContext;a.font=this.font;a.textAlign=this.textAlign?this.textAlign:"start";a.textBaseline=this.textBaseline?this.textBaseline:"alphabetic";return a};a._drawTextLine=function(a,b,d){this.outline?a.strokeText(b,0,d,this.maxWidth):a.fillText(b,0,d,this.maxWidth)};d.Text=b})(window);(function(d){var b=function(){throw"SpriteSheetUtils cannot be instantiated";};b._workingCanvas=document.createElement("canvas");b._workingContext=b._workingCanvas.getContext("2d");b.addFlippedFrames=function(a,c,d,f){if(c||d||f){var e=0;c&&b._flip(a,++e,true,false);d&&b._flip(a,++e,false,true);f&&b._flip(a,++e,true,true)}};b.extractFrame=function(a,c){isNaN(c)&&(c=a.getAnimation(c).frames[0]);var d=a.getFrame(c);if(!d)return null;var f=d.rect,e=b._workingCanvas;e.width=f.width;e.height=f.height;
b._workingContext.drawImage(d.image,f.x,f.y,f.width,f.height,0,0,f.width,f.height);d=new Image;d.src=e.toDataURL("image/png");return d};b._flip=function(a,c,d,f){for(var e=a._images,h=b._workingCanvas,j=b._workingContext,k=e.length/c,l=0;l<k;l++){var m=e[l];m.__tmp=l;h.width=m.width;h.height=m.height;j.setTransform(d?-1:1,0,0,f?-1:1,d?m.width:0,f?m.height:0);j.drawImage(m,0,0);var q=new Image;q.src=h.toDataURL("image/png");q.width=m.width;q.height=m.height;e.push(q)}j=a._frames;h=j.length/c;for(l=
0;l<h;l++){var m=j[l],r=m.rect.clone(),q=e[m.image.__tmp+k*c],u={image:q,rect:r,regX:m.regX,regY:m.regY};if(d)r.x=q.width-r.x-r.width,u.regX=r.width-m.regX;if(f)r.y=q.height-r.y-r.height,u.regY=r.height-m.regY;j.push(u)}d="_"+(d?"h":"")+(f?"v":"");f=a._animations;a=a._data;e=f.length/c;for(l=0;l<e;l++){j=f[l];m=a[j];k={name:j+d,frequency:m.frequency,next:m.next,frames:[]};m.next&&(k.next+=d);j=m.frames;m=0;for(q=j.length;m<q;m++)k.frames.push(j[m]+h*c);a[k.name]=k;f.push(k.name)}};d.SpriteSheetUtils=
b})(window);(function(d){var b=function(a){this.initialize(a)},a=b.prototype=new DisplayObject;a.htmlElement=null;a._style=null;a.DisplayObject_initialize=a.initialize;a.initialize=function(a){typeof a=="string"&&(a=document.getElementById(a));this.DisplayObject_initialize();this.mouseEnabled=false;if(this.htmlElement=a)this._style=a.style,this._style.position="absolute",this._style.transformOrigin=this._style.webkitTransformOrigin=this._style.MozTransformOrigin="0% 0%"};a.isVisible=function(){return this.htmlElement!=
null};a.draw=function(){if(this.htmlElement!=null){var a=this._matrix,b=this.htmlElement;b.style.opacity=""+a.alpha;b.style.visibility=this.visible?"visible":"hidden";b.style.transform=b.style.webkitTransform=b.style.oTransform=["matrix("+a.a,a.b,a.c,a.d,a.tx,a.ty+")"].join(",");b.style.MozTransform=["matrix("+a.a,a.b,a.c,a.d,a.tx+"px",a.ty+"px)"].join(",");return true}};a.cache=function(){};a.uncache=function(){};a.updateCache=function(){};a.hitTest=function(){};a.localToGlobal=function(){};a.globalToLocal=
function(){};a.localToLocal=function(){};a.clone=function(){var a=new b;this.cloneProps(a);return a};a.toString=function(){return"[DOMElement (name="+this.name+")]"};a._tick=function(){if(this.htmlElement!=null)this.htmlElement.style.visibility="hidden"};d.DOMElement=b})(window);(function(d){var b=function(){this.initialize()},a=b.prototype;a.initialize=function(){};a.getBounds=function(){return new Rectangle(0,0,0,0)};a.applyFilter=function(){};a.toString=function(){return"[Filter]"};a.clone=function(){return new b};d.Filter=b})(window);(function(d){var b=function(a,b,d){this.initialize(a,b,d)},a=b.prototype=new Filter;a.initialize=function(a,b,d){if(isNaN(a)||a<0)a=0;this.blurX=a|0;if(isNaN(b)||b<0)b=0;this.blurY=b|0;if(isNaN(d)||d<1)d=1;this.quality=d|0};a.blurX=0;a.blurY=0;a.quality=1;a.getBounds=function(){return new Rectangle(-this.blurX,-this.blurY,2*this.blurX,2*this.blurY)};a.applyFilter=function(a,b,d,e,h,j,k,l){j=j||a;k==null&&(k=b);l==null&&(l=d);try{var m=a.getImageData(b,d,e,h)}catch(q){return false}a=this.blurX;if(isNaN(a)||
a<0)return false;a|=0;var r=this.blurY;if(isNaN(r)||r<0)return false;r|=0;if(a==0&&r==0)return false;var u=this.quality;if(isNaN(u)||u<1)u=1;u|=0;u>3&&(u=3);u<1&&(u=1);for(var s=m.data,z,t,A,p,w,o,v,B,H=e-1,I=h-1,C=a+1,D=r+1,E=1/((a+C)*(r+D)),F=[],G=[],K=[],L=[],M=[],J=[];u-- >0;){for(d=B=v=0;d<h;d++){z=s[B]*C;t=s[B+1]*C;A=s[B+2]*C;p=s[B+3]*C;for(w=1;w<=a;w++)b=B+((w>H?H:w)<<2),z+=s[b++],t+=s[b++],A+=s[b++],p+=s[b];for(b=0;b<e;b++)F[v]=z,G[v]=t,K[v]=A,L[v]=p,d==0&&(M[b]=Math.min(b+C,H)<<2,J[b]=Math.max(b-
a,0)<<2),w=B+M[b],o=B+J[b],z+=s[w++]-s[o++],t+=s[w++]-s[o++],A+=s[w++]-s[o++],p+=s[w]-s[o],v++;B+=e<<2}for(b=0;b<e;b++){d=b;z=F[d]*D;t=G[d]*D;A=K[d]*D;p=L[d]*D;for(w=1;w<=r;w++)d+=w>I?0:e,z+=F[d],t+=G[d],A+=K[d],p+=L[d];v=b<<2;for(d=0;d<h;d++)s[v]=z*E+0.5|0,s[v+1]=t*E+0.5|0,s[v+2]=A*E+0.5|0,s[v+3]=p*E+0.5|0,b==0&&(M[d]=Math.min(d+D,I)*e,J[d]=Math.max(d-r,0)*e),w=b+M[d],o=b+J[d],z+=F[w]-F[o],t+=G[w]-G[o],A+=K[w]-K[o],p+=L[w]-L[o],v+=e<<2}}j.putImageData(m,k,l);return true};a.clone=function(){return new b(this.blurX,
this.blurY,this.quality)};a.toString=function(){return"[BoxBlurFilter (name="+this.name+")]"};d.BoxBlurFilter=b})(window);(function(d){var b=function(a,b,d,e,h,j,k,l){this.initialize(a,b,d,e,h,j,k,l)},a=b.prototype=new Filter;a.redMultiplier=1;a.greenMultiplier=1;a.blueMultiplier=1;a.alphaMultiplier=1;a.redOffset=0;a.greenOffset=0;a.blueOffset=0;a.alphaOffset=0;a.initialize=function(a,b,d,e,h,j,k,l){this.redMultiplier=a!=null?a:1;this.greenMultiplier=b!=null?b:1;this.blueMultiplier=d!=null?d:1;this.alphaMultiplier=e!=null?e:1;this.redOffset=h||0;this.greenOffset=j||0;this.blueOffset=k||0;this.alphaOffset=l||0};a.applyFilter=
function(a,b,d,e,h,j,k,l){j=j||a;k==null&&(k=b);l==null&&(l=d);try{var m=a.getImageData(b,d,e,h)}catch(q){return false}a=m.data;b=a.length;for(d=0;d<b;d+=4)a[d]=a[d]*this.redMultiplier+this.redOffset,a[d+1]=a[d+1]*this.greenMultiplier+this.greenOffset,a[d+2]=a[d+2]*this.blueMultiplier+this.blueOffset,a[d+3]=a[d+3]*this.alphaMultiplier+this.alphaOffset;m.data=a;j.putImageData(m,k,l);return true};a.toString=function(){return"[ColorFilter]"};a.clone=function(){return new b(this.redMultiplier,this.greenMultiplier,
this.blueMultiplier,this.alphaMultiplier,this.redOffset,this.greenOffset,this.blueOffset,this.alphaOffset)};d.ColorFilter=b})(window);(function(d){var b=function(a){this.initialize(a)},a=b.prototype=new Filter;a.matrix=null;a.initialize=function(a){this.matrix=a};a.applyFilter=function(a,b,d,e,h,j,k,l){j=j||a;k==null&&(k=b);l==null&&(l=d);try{var m=a.getImageData(b,d,e,h)}catch(q){return false}var a=m.data,b=a.length,r,u,s,z;r=this.matrix;for(var d=r[0],e=r[1],h=r[2],t=r[3],A=r[4],p=r[5],w=r[6],o=r[7],v=r[8],B=r[9],H=r[10],I=r[11],C=r[12],D=r[13],E=r[14],F=r[15],G=r[16],K=r[17],L=r[18],M=r[19],J=0;J<b;J+=4)r=a[J],u=a[J+1],s=a[J+
2],z=a[J+3],a[J]=r*d+u*e+s*h+z*t+A,a[J+1]=r*p+u*w+s*o+z*v+B,a[J+2]=r*H+u*I+s*C+z*D+E,a[J+3]=r*F+u*G+s*K+z*L+M;m.data=a;j.putImageData(m,k,l);return true};a.toString=function(){return"[ColorMatrixFilter]"};a.clone=function(){return new b(this.matrix)};d.ColorMatrixFilter=b})(window);(function(d){var b=function(){throw"Touch cannot be instantiated";};b.isSupported=function(){return"ontouchstart"in d};b.enable=function(a){if(a!=null&&b.isSupported())a._primaryTouchId=-1,a._handleTouchMoveListener=null,a.canvas.addEventListener("touchstart",function(c){b._handleTouchStart(a,c)},false),document.addEventListener("touchend",function(c){b._handleTouchEnd(a,c)},false)};b._handleTouchStart=function(a,c){c.preventDefault();if(a._primaryTouchId==-1){a._handleTouchMoveListener=a._handleTouchMoveListener||
function(c){b._handleTouchMove(a,c)};document.addEventListener("touchmove",a._handleTouchMoveListener,false);var d=c.changedTouches[0];a._primaryTouchId=d.identifier;a._updateMousePosition(d.pageX,d.pageY);a._handleMouseDown(d)}};b._handleTouchMove=function(a,c){var d=b._findPrimaryTouch(a,c.changedTouches);d&&a._handleMouseMove(d)};b._handleTouchEnd=function(a,c){var d=b._findPrimaryTouch(a,c.changedTouches);if(d)a._primaryTouchId=-1,a._handleMouseUp(d),document.removeEventListener("touchmove",a._handleTouchMoveListener),
a._handleTouchMoveListener=null};b._findPrimaryTouch=function(a,c){for(var b=c.length,d=0;d<b;d++){var e=c[d];if(e.identifier==a._primaryTouchId)return e}return null};d.Touch=b})(window);(function(){var d=false,b=/xyz/.test(function(){})?/\b_super\b/:/.*/;this.Class=function(){};Class.extend=function(a){function c(){!d&&this.init&&this.init.apply(this,arguments)}var g=this.prototype;d=true;var f=new this;d=false;for(var e in a)f[e]=typeof a[e]=="function"&&typeof g[e]=="function"&&b.test(a[e])?function(a,c){return function(){var b=this._super;this._super=g[a];var d=c.apply(this,arguments);this._super=b;return d}}(e,a[e]):a[e];c.prototype=f;c.constructor=c;c.extend=arguments.callee;
return c}})();var Edge=function(d,b,a){this.vertexOne=d;this.vertexTwo=b;this.pair=[d,b];this.attributes=a||{};return this};var Graph=function(){this.vertices={};return this};Graph.prototype.compare=function(d,b){return JSON.stringify(d)===JSON.stringify(b)};Graph.prototype.getVertices=function(){return this.vertices};Graph.prototype.getEdges=function(){var d=0,b=[],a;for(a in this.vertices){b[d]===void 0&&(b[d]={},b[d][a]=[]);for(var c in this.vertices[a].edges)b[d][a].push(c);++d}return b};Graph.prototype.hasVertex=function(d){return d in this.vertices};
Graph.prototype.addVertex=function(d){this.vertices[d.label]===void 0&&(this.vertices[d.label]=d)};Graph.prototype.addEdge=function(d){var b=d.vertexOne,d=d.vertexTwo;!(b in this.vertices[d].edges)&&!(d in this.vertices[b].edges)&&(this.vertices[b].edges[d]={},this.vertices[d].edges[b]={})};Graph.prototype.deleteVertex=function(d){delete this.vertices[d]};Graph.prototype.deleteEdge=function(d){delete this.vertices[d.vertexOne].edges[d.vertexTwo];delete this.vertices[d.vertexTwo].edges[d.vertexOne]};
Graph.prototype.hasEdge=function(d){var b=d.vertexOne,d=d.vertexTwo,a;for(a in this.vertices)if(a.edges[b]!==void 0&&a.edges[d]!==void 0)return true;return false};Graph.prototype.vertexOrder=function(d){var b=0,a;for(a in this.vertices){if(a.label==d)return b;++b}};var Vertex=function(d,b){this.label=d;this.edges={};this.attributes=b||{};return this};Vertex.prototype.getNeighbours=function(){return this.edges};Vertex.prototype.isNeighbourOf=function(d){return this.edges!==void 0&&d in this.edges?true:false};var Adjacency=function(d){this.vertices=d;this.matrix={};var b=this;this.build=function(a){var d={},a=a.getNeighbours(),f;for(f in b.vertices)d[f]=0,f in a&&(d[f]=1);return d};for(var a in d)b.matrix[a]=b.build(d[a]);return b.matrix};var DepthFirstSearch=function(d,b){this.vertices=d;this.visited={};this.spanningTree={};this.preorder=[];this.postorder=[];var a=this;this.search=function(c){if(typeof c==="undefined")return false;a.visited[c.label]=1;a.preorder.push(c.label);if(a.vertices[c.label]!==void 0)for(neighbour in a.vertices[c.label].getNeighbours())!(neighbour in a.visited)&&a.vertices[neighbour]!==void 0&&(a.spanningTree[neighbour]=a.vertices[neighbour],a.search(a.vertices[neighbour]));a.postorder.push(c.label)};if(b===
void 0)for(var c in d)c in a.visited||(a.spanningTree[c]=null,a.search(d[c]));else a.spanningTree[b]=null,a.search(d[b.label]);return{spanningTree:a.spanningTree,preorder:a.preorder,postorder:a.postorder}};var Dijkstra=function(d,b,a,c){this.dist=this.infinity=c||Infinity;this.graph=d;this.search=function(a){this.costs[a]=0;for(vertices in d);}};(function(){SimpleMaskContainer=function(){this.initialize()};var d=SimpleMaskContainer.prototype=new Container;d.canvas=null;d.rectangleMask=null;d._hitTestMask=function(b,a){var c=this.rectangleMask;return!c||b>c.x&&a>c.y&&b<c.x+c.width&&a<c.y+c.height?true:false};d.Container_getObjectsUnderPoint=d._getObjectsUnderPoint;d._getObjectsUnderPoint=function(b,a,c,d){return this._hitTestMask(b,a)?this.Container_getObjectsUnderPoint(b,a,c,d):null};d.Container_draw=d.draw;d.draw=function(b,a,c){var d=this.rectangleMask,
f=Stage._snapToPixelEnabled;c?c=c.clone():(c=new Matrix2D,c.appendProperties(this.alpha,this.shadow,this.compositeOperation));if(d){if(!this.canvas)this.canvas=document.createElement("canvas");this.canvas.width=d.width;this.canvas.height=d.height;var e=this.canvas.getContext("2d"),h=new Matrix2D;h.translate(-d.x,-d.y);this.Container_draw(e,a,h);a=new Bitmap;a.image=this.canvas;f&&a.snapToPixel&&c.a==1&&c.b==0&&c.c==0&&c.d==1?b.setTransform(c.a,c.b,c.c,c.d,c.tx+0.5|0,c.ty+0.5|0):b.setTransform(c.a,
c.b,c.c,c.d,c.tx,c.ty);b.translate(d.x,d.y);a.draw(b,false,c.clone())}else this.Container_draw(b,a,c.clone());return true}})(window);(function(d){Tween=function(a,c){this.initialize(a,c)};var b=Tween.prototype;Tween.NONE=0;Tween.LOOP=1;Tween.REVERSE=2;Tween._tweens=[];Tween.cssSuffixMap={top:"px",left:"px",bottom:"px",right:"px",width:"px",height:"px",opacity:""};Tween.get=function(a,c){return new Tween(a,c)};Tween.tick=function(a,c){for(var b=Tween._tweens,d=b.length-1;d>=0;d--){var e=b[d];if(!c||e.ignoreGlobalPause)e.tick(e._useTicks?1:a)}};Ticker&&Ticker.addListener(Tween,false);Tween.removeTweens=function(a){if(a.tweenjs_count){for(var c=
Tween._tweens,b=c.length-1;b>=0;b--)c[b]._target==a&&c.splice(b,1);a.tweenjs_count=0}};Tween._register=function(a,c){var b=a._target;if(c){if(b)b.tweenjs_count=b.tweenjs_count?b.tweenjs_count+1:1;Tween._tweens.push(a)}else b&&b.tweenjs_count--,b=Tween._tweens.indexOf(a),b!=-1&&Tween._tweens.splice(b,1)};b.ignoreGlobalPause=false;b.loop=false;b.cssSuffixMap=null;b.duration=0;b._paused=false;b._curQueueProps=null;b._initQueueProps=null;b._steps=null;b._actions=null;b._prevPosition=0;b._prevPos=-1;b._prevIndex=
-1;b._target=null;b._css=false;b._useTicks=false;b.initialize=function(a,c){this._target=a;if(c)this._useTicks=c.useTicks,this._css=c.css,this.ignoreGlobalPause=c.ignoreGlobalPause,this.loop=c.loop,c.override&&Tween.removeTweens(a);this._curQueueProps={};this._initQueueProps={};this._steps=[];this._actions=[];this._catalog=[];Tween._register(this,true)};b.wait=function(a){if(a==null||a<=0)return this;var c=this._cloneProps(this._curQueueProps);return this._addStep({d:a,p0:c,e:this._linearEase,p1:c})};
b.to=function(a,c,b){if(isNaN(c)||c<0)c=0;return this._addStep({d:c||0,p0:this._cloneProps(this._curQueueProps),e:b,p1:this._cloneProps(this._appendQueueProps(a))})};b.call=function(a,c,b){return this._addAction({f:a,p:c?c:[this],o:b?b:this._target})};b.set=function(a,c){return this._addAction({f:this._set,o:this,p:[a,c?c:this._target]})};b.play=function(a){return this.call(a.setPaused,[false],a)};b.pause=function(a){a||(a=this);return this.call(a.setPaused,[true],a)};b.setPosition=function(a,c){c==
null&&(c=1);var b=a,d=false;if(b>=this.duration)this.loop?b%=this.duration:(b=this.duration,d=true);if(b==this._prevPos)return d;if(b!=this._prevPos)if(d)this._updateTargetProps(null,1);else if(this._steps.length>0){for(var e=0,h=this._steps.length;e<h;e++)if(this._steps[e].t>b)break;e=this._steps[e-1];this._updateTargetProps(e,(b-e.t)/e.d)}e=this._prevPos;this._prevPos=b;this._prevPosition=a;c!=0&&this._actions.length>0&&(this._useTicks?this._runActions(b,b):c==1&&b<e?(e!=this.duration&&this._runActions(e,
this.duration),this._runActions(0,b,true)):this._runActions(e,b));d&&this.setPaused(true);return d};b.tick=function(a){this._paused||this.setPosition(this._prevPosition+a)};b.setPaused=function(a){if(this._paused!=!!a)this._paused=!!a,Tween._register(this,!a)};b.w=b.wait;b.t=b.to;b.c=b.call;b.s=b.set;b.toString=function(){return"[Tween]"};b.clone=function(){throw"Tween can not be cloned.";};b._updateTargetProps=function(a,c){if(this._css)var b=this.cssSuffixMap||Tween.cssSuffixMap;var d,e,h,j;!a&&
c==1?d=e=this._curQueueProps:(a.e&&(c=a.e(c,0,1,1)),d=a.p0,e=a.p1);for(n in this._initQueueProps){if((h=d[n])==null)d[n]=h=this._initQueueProps[n];if((j=e[n])==null)e[n]=j=h;h==j||c==0||c==1||typeof h!="number"?c==1&&(h=j):h+=(j-h)*c;this._target[n]=b&&b[n]?h+b[n]:h}};b._runActions=function(a,c,b){var d=a,e=c,h=-1,j=this._actions.length,k=1;a>c&&(d=c,e=a,h=j,j=k=-1);for(;(h+=k)!=j;){var c=this._actions[h],l=c.t;(l==e||l>d&&l<e||b&&l==a)&&c.f.apply(c.o,c.p)}};b._appendQueueProps=function(a){if(this._css)var c=
this.cssSuffixMap||Tween.cssSuffixMap;var b,d,e;for(e in a){if(this._initQueueProps[e]==null)if(c&&(b=c[e])!=null){var h=this._target[e],j=h.length-b.length;if((d=h.substr(j))!=b)throw"TweenJS Error: Suffixes do not match. ("+b+":"+d+")";else this._initQueueProps[e]=parseInt(h.substr(0,j))}else this._initQueueProps[e]=this._target[e];this._curQueueProps[e]=a[e]}return this._curQueueProps};b._cloneProps=function(a){var c={},b;for(b in a)c[b]=a[b];return c};b._addStep=function(a){if(a.d>0)this._steps.push(a),
a.t=this.duration,this.duration+=a.d;return this};b._addAction=function(a){a.t=this.duration;this._actions.push(a);return this};b._set=function(a,c){for(var b in a)c[b]=a[b]};d.Tween=Tween})(window);(function(d){var b=function(){throw"Ease cannot be instantiated.";};b.linear=function(a){return a};b.none=b.linear;b.get=function(a){a<-1&&(a=-1);a>1&&(a=1);return function(c){return a==0?c:a<0?c*(c*-a+1+a):c*((2-c)*a+(1-a))}};b.getPowIn=function(a){return function(c){return Math.pow(c,a)}};b.getPowOut=function(a){return function(c){return 1-Math.pow(1-c,a)}};b.getPowInOut=function(a){return function(c){return(c*=2)<1?0.5*Math.pow(c,a):1-0.5*Math.abs(Math.pow(2-c,a))}};b.quadIn=b.getPowIn(2);b.quadOut=
b.getPowOut(2);b.quadInOut=b.getPowInOut(2);b.cubicIn=b.getPowIn(3);b.cubicOut=b.getPowOut(3);b.cubicInOut=b.getPowInOut(3);b.quartIn=b.getPowIn(4);b.quartOut=b.getPowOut(4);b.quartInOut=b.getPowInOut(4);b.quintIn=b.getPowIn(5);b.quintOut=b.getPowOut(5);b.quintInOut=b.getPowInOut(5);b.sineIn=function(a){return 1-Math.cos(a*Math.PI/2)};b.sineOut=function(a){return Math.sin(a*Math.PI/2)};b.sineInOut=function(a){return-0.5*(Math.cos(Math.PI*a)-1)};b.getBackIn=function(a){return function(c){return c*
c*((a+1)*c-a)}};b.backIn=b.getBackIn(1.7);b.getBackOut=function(a){return function(c){return--c*c*((a+1)*c+a)+1}};b.backOut=b.getBackOut(1.7);b.getBackInOut=function(a){a*=1.525;return function(c){return(c*=2)<1?0.5*c*c*((a+1)*c-a):0.5*((c-=2)*c*((a+1)*c+a)+2)}};b.backInOut=b.getBackInOut(1.7);b.circIn=function(a){return-(Math.sqrt(1-a*a)-1)};b.circOut=function(a){return Math.sqrt(1- --a*a)};b.circInOut=function(a){return(a*=2)<1?-0.5*(Math.sqrt(1-a*a)-1):0.5*(Math.sqrt(1-(a-=2)*a)+1)};b.bounceIn=
function(a){return 1-b.bounceOut(1-a)};b.bounceOut=function(a){return a<1/2.75?7.5625*a*a:a<2/2.75?7.5625*(a-=1.5/2.75)*a+0.75:a<2.5/2.75?7.5625*(a-=2.25/2.75)*a+0.9375:7.5625*(a-=2.625/2.75)*a+0.984375};b.bounceInOut=function(a){return a<0.5?b.bounceIn(a*2)*0.5:b.bounceOut(a*2-1)*0.5+0.5};b.getElasticIn=function(a,c){var b=Math.PI*2;return function(d){if(d==0||d==1)return d;var e=c/b*Math.asin(1/a);return-(a*Math.pow(2,10*(d-=1))*Math.sin((d-e)*b/c))}};b.elasticIn=b.getElasticIn(1,0.3);b.getElasticOut=
function(a,c){var b=Math.PI*2;return function(d){if(d==0||d==1)return d;var e=c/b*Math.asin(1/a);return a*Math.pow(2,-10*d)*Math.sin((d-e)*b/c)+1}};b.elasticOut=b.getElasticOut(1,0.3);b.getElasticInOut=function(a,c){var b=Math.PI*2;return function(d){var e=c/b*Math.asin(1/a);return(d*=2)<1?-0.5*a*Math.pow(2,10*(d-=1))*Math.sin((d-e)*b/c):a*Math.pow(2,-10*(d-=1))*Math.sin((d-e)*b/c)*0.5+1}};b.elasticInOut=b.getElasticInOut(1,0.3*1.5);d.Ease=b})(window);function Bezier(d){this.points=d;this.order=d.length}function distance(d,b){var a=b.x-d.x,c=b.y-d.y;return Math.sqrt(a*a+c*c)}Bezier.prototype._triangle=function(){for(var d=this.points,b=[d],a=1;a<this.order;a++){for(var c=[],g=0;g<this.order-a;g++){var f=d[g],e=d[g+1];c[g]={x:(f.x+e.x)/2,y:(f.y+e.y)/2}}b.push(c);d=c}return(this._triangle=function(){return b})()};
Bezier.prototype.split=function(){for(var d=this._triangle(),b=Array(this.order),a=Array(this.order),c=0;c<this.order;c++)b[c]=d[c][0],a[c]=d[this.order-1-c][c];return[new Bezier(b),new Bezier(a)]};Bezier.prototype.midpointT=function(){return this.atT(0.5)};
Bezier.prototype.getCoefficients=function(){function d(a){for(;a.length>1;){for(var c=Array(a.length-1),b=0;b<a.length-1;b++){var d=c,g=b,f=a[b],q=a[b+1];f.push(0);var r=Array(f.length);r[0]=f[0];for(var u=0;u<q.length;u++)r[u+1]=f[u+1]+q[u]-f[u];d[g]=r}a=c}return a[0]}for(var b=[],a=[],c=0,g;g=this.points[c++];)b.push([g.x]),a.push([g.y]);var f={xs:d(b),ys:d(a)};return(this.getCoefficients=function(){return f})()};
Bezier.prototype.atT=function(d){for(var b=this.getCoefficients(),a=b.xs,b=b.ys,c=a[a.length-1],g=b[b.length-1],f=a.length-1;--f>=0;)c=c*d+a[f],g=g*d+b[f];return{x:c,y:g}};Bezier.prototype.measureLength=function(d){arguments.length<1&&(d=1);var b=0,a=[this];do{for(var c=a.pop(),g=c.points,f=distance(g[0],g[this.order-1]),e=0,h=0;h<this.order-1;h++)e+=distance(g[h],g[h+1]);e-f<=d?b+=e:a=a.concat(c.split())}while(a.length);return(this.measureLength=function(){return b})()};
Bezier.prototype.draw=function(d){var b=this.points;d.moveTo(b[0].x,b[0].y);var a=Bezier.drawCommands[this.order];if(a){for(var c=[],g=b.length?1:0;g<b.length;g++)c.push(b[g].x),c.push(b[g].y);a.apply(d,c)}else error("don't know how to draw an order *"+this.order+" bezier")};Bezier.drawCommands=[null,function(d,b){this.lineTo(d,b)},function(d,b){this.lineTo(d,b)},function(d,b,a,c){this.quadraticCurveTo(d,b,a,c)},function(d,b,a,c,g,f){this.bezierCurveTo(d,b,a,c,g,f)}];function Path(d){this.segments=d||[]}Path.prototype.resetMetrics=function(){this.measureLength=Path.prototype.measureLength};Path.prototype.measureLength=function(){for(var d=0,b=0,a;a=this.segments[b++];)d+=a.measureLength();return(this.measureLength=function(){return d})()};Path.prototype.atT=function(d){d*=this.measureLength();for(var b=0,a=this.segments[b++];d>a.measureLength()&&b<this.segments.length;)d-=a.measureLength(),a=this.segments[b++];return a.atT(d/a.measureLength())};
Path.prototype.draw=function(d){for(var b=0,a;a=this.segments[b++];)a.draw(d)};Path.prototype.addBezier=function(d){this.segments.push(new Path.Bezier(d));this.resetMetrics()};Path.Bezier=function(d){this.bezier=d instanceof Array?new Bezier(d):d};Path.Bezier.prototype.atT=function(d){return this.bezier.atT(d)};Path.Bezier.prototype.measureLength=function(){var d=this.bezier.measureLength();return(this.measureLength=function(){return d})()};Path.Bezier.prototype.draw=function(d){this.bezier.draw(d)};
Path.prototype.addLine=function(d,b){this.segments.push(new Path.Line([d,b]));this.resetMetrics()};Path.Line=function(d){this.points=d};Path.Line.prototype.measureLength=function(){var d=distance.apply(null,this.points);return(this.measureLength=function(){return d})()};Path.Line.prototype.atT=function(d){var b=this.points[0],a=this.points[1];return{x:b.x+(a.x-b.x)*d,y:b.y+(a.y-b.y)*d}};Path.Line.prototype.draw=function(d){var b=this.points;d.moveTo(b[0].x,b[0].y);d.lineTo(b[1].x,b[1].y)};function Point2D(d,b){if(arguments.length>0)this.x=d,this.y=b}Point2D.prototype.clone=function(){return new Point2D(this.x,this.y)};Point2D.prototype.add=function(d){return new Point2D(this.x+d.x,this.y+d.y)};Point2D.prototype.addEquals=function(d){this.x+=d.x;this.y+=d.y;return this};
Point2D.prototype.offset=function(d,b){var a=0;if(!(b.x<=this.x||this.x+d.x<=0)){var c;b.x*d.y-d.x*b.y>0?this.x<0?(c=this.x*d.y,c=c/d.x-this.y):this.x>0?(c=this.x*b.y,c=c/b.x-this.y):c=-this.y:b.x<this.x+d.x?(c=(b.x-this.x)*d.y,c=b.y-(this.y+c/d.x)):b.x>this.x+d.x?(c=(d.x+this.x)*b.y,c=c/b.x-(this.y+d.y)):c=b.y-(this.y+d.y);c>0&&(a=c)}return a};Point2D.prototype.rmoveto=function(d,b){this.x+=d;this.y+=b};Point2D.prototype.scalarAdd=function(d){return new Point2D(this.x+d,this.y+d)};
Point2D.prototype.scalarAddEquals=function(d){this.x+=d;this.y+=d;return this};Point2D.prototype.subtract=function(d){return new Point2D(this.x-d.x,this.y-d.y)};Point2D.prototype.subtractEquals=function(d){this.x-=d.x;this.y-=d.y;return this};Point2D.prototype.scalarSubtract=function(d){return new Point2D(this.x-d,this.y-d)};Point2D.prototype.scalarSubtractEquals=function(d){this.x-=d;this.y-=d;return this};Point2D.prototype.multiply=function(d){return new Point2D(this.x*d,this.y*d)};
Point2D.prototype.multiplyEquals=function(d){this.x*=d;this.y*=d;return this};Point2D.prototype.divide=function(d){return new Point2D(this.x/d,this.y/d)};Point2D.prototype.divideEquals=function(d){this.x/=d;this.y/=d;return this};Point2D.prototype.compare=function(d){return this.x-d.x||this.y-d.y};Point2D.prototype.eq=function(d){return this.x==d.x&&this.y==d.y};Point2D.prototype.lt=function(d){return this.x<d.x&&this.y<d.y};Point2D.prototype.lte=function(d){return this.x<=d.x&&this.y<=d.y};
Point2D.prototype.gt=function(d){return this.x>d.x&&this.y>d.y};Point2D.prototype.gte=function(d){return this.x>=d.x&&this.y>=d.y};Point2D.prototype.lerp=function(d,b){return new Point2D(this.x+(d.x-this.x)*b,this.y+(d.y-this.y)*b)};Point2D.prototype.distanceFrom=function(d){var b=this.x-d.x,d=this.y-d.y;return Math.sqrt(b*b+d*d)};Point2D.prototype.min=function(d){return new Point2D(Math.min(this.x,d.x),Math.min(this.y,d.y))};
Point2D.prototype.max=function(d){return new Point2D(Math.max(this.x,d.x),Math.max(this.y,d.y))};Point2D.prototype.toString=function(){return this.x+","+this.y};Point2D.prototype.setXY=function(d,b){this.x=d;this.y=b};Point2D.prototype.setFromPoint=function(d){this.x=d.x;this.y=d.y};Point2D.prototype.swap=function(d){var b=this.x,a=this.y;this.x=d.x;this.y=d.y;d.x=b;d.y=a};
Point2D.prototype.rotate=function(d,b){var a=Math.PI/180*(+d||0);this.x-=b.x;this.y-=b.y;var c=this.x*Math.cos(a)-this.y*Math.sin(a),a=this.x*Math.sin(a)+this.y*Math.cos(a);this.x=c+b.x;this.y=a+b.y};Point2D.prototype.closeTo=function(d,b){return Math.abs(this.x-d.x)<b&&Math.abs(this.y-d.y)<b};
Point2D.prototype.getAngle=function(d,b){var a,c;a=new Point2D(this.x,this.y);c=new Point2D(d.x,d.y);var g,f;g=new Point2D(this.x,this.y);f=new Point2D(b.x,b.y);var e=c.x-a.x;a=c.y-a.y;c=g.x-f.x;g=g.y-f.y;f=Math.sqrt(e*e+a*a);var h=Math.sqrt(c*c+g*g);e/=f;a/=f;c/=h;g/=h;return(Math.atan2(g,c)-Math.atan2(a,e))/(Math.PI*2/360)};function Vector2D(d,b){if(arguments.length>0)this.x=d,this.y=b}Vector2D.prototype.length=function(){return Math.sqrt(this.x*this.x+this.y*this.y)};Vector2D.prototype.dot=function(d){return this.x*d.x+this.y*d.y};Vector2D.prototype.cross=function(d){return this.x*d.y-this.y*d.x};Vector2D.prototype.unit=function(){return this.divide(this.length())};Vector2D.prototype.unitEquals=function(){this.divideEquals(this.length());return this};
Vector2D.prototype.add=function(d){return new Vector2D(this.x+d.x,this.y+d.y)};Vector2D.prototype.addEquals=function(d){this.x+=d.x;this.y+=d.y;return this};Vector2D.prototype.subtract=function(d){return new Vector2D(this.x-d.x,this.y-d.y)};Vector2D.prototype.subtractEquals=function(d){this.x-=d.x;this.y-=d.y;return this};Vector2D.prototype.multiply=function(d){return new Vector2D(this.x*d,this.y*d)};Vector2D.prototype.multiplyEquals=function(d){this.x*=d;this.y*=d;return this};
Vector2D.prototype.divide=function(d){return new Vector2D(this.x/d,this.y/d)};Vector2D.prototype.divideEquals=function(d){this.x/=d;this.y/=d;return this};Vector2D.prototype.perp=function(){return new Vector2D(-this.y,this.x)};Vector2D.prototype.perpendicular=function(d){return this.subtract(this.project(d))};Vector2D.prototype.project=function(d){var b=this.dot(d)/d.dot(d);return d.multiply(b)};Vector2D.prototype.toString=function(){return this.x+","+this.y};
Vector2D.fromPoints=function(d,b){return new Vector2D(b.x-d.x,b.y-d.y)};Polynomial.TOLERANCE=1.0E-6;Polynomial.ACCURACY=6;
Polynomial.interpolate=function(d,b,a,c,g){if(d.constructor!==Array||b.constructor!==Array)throw Error("Polynomial.interpolate: xs and ys must be arrays");if(isNaN(a)||isNaN(c)||isNaN(g))throw Error("Polynomial.interpolate: n, offset, and x must be numbers");for(var f=0,e=0,h=Array(a),j=Array(a),k=0,f=Math.abs(g-d[c]),l=0;l<a;l++){var m=Math.abs(g-d[c+l]);m<f&&(k=l,f=m);h[l]=j[l]=b[c+l]}f=b[c+k];k--;for(b=1;b<a;b++){for(l=0;l<a-b;l++){var e=d[c+l]-g,m=d[c+l+b]-g,q=e-m;if(q==0)break;q=(h[l+1]-j[l])/
q;j[l]=m*q;h[l]=e*q}e=2*(k+1)<a-b?h[k+1]:j[k--];f+=e}return{y:f,dy:e}};function Polynomial(){this.init(arguments)}Polynomial.prototype.init=function(d){this.coefs=[];for(var b=d.length-1;b>=0;b--)this.coefs.push(d[b]);this._variable="t";this._s=0};Polynomial.prototype.eval=function(d){if(isNaN(d))throw Error("Polynomial.eval: parameter must be a number");for(var b=0,a=this.coefs.length-1;a>=0;a--)b=b*d+this.coefs[a];return b};
Polynomial.prototype.add=function(d){for(var b=new Polynomial,a=this.getDegree(),c=d.getDegree(),g=Math.max(a,c),f=0;f<=g;f++)b.coefs[f]=(f<=a?this.coefs[f]:0)+(f<=c?d.coefs[f]:0);return b};Polynomial.prototype.multiply=function(d){for(var b=new Polynomial,a=0;a<=this.getDegree()+d.getDegree();a++)b.coefs.push(0);for(a=0;a<=this.getDegree();a++)for(var c=0;c<=d.getDegree();c++)b.coefs[a+c]+=this.coefs[a]*d.coefs[c];return b};
Polynomial.prototype.divide_scalar=function(d){for(var b=0;b<this.coefs.length;b++)this.coefs[b]/=d};Polynomial.prototype.simplify=function(){for(var d=this.getDegree();d>=0;d--)if(Math.abs(this.coefs[d])<=Polynomial.TOLERANCE)this.coefs.pop();else break};
Polynomial.prototype.bisection=function(d,b){var a=this.eval(d),c=this.eval(b),g;if(Math.abs(a)<=Polynomial.TOLERANCE)g=d;else if(Math.abs(c)<=Polynomial.TOLERANCE)g=b;else if(a*c<=0)for(var c=Math.log(b-d),c=Math.ceil((c+Math.LN10*Polynomial.ACCURACY)/Math.LN2),f=0;f<c;f++){g=0.5*(d+b);var e=this.eval(g);if(Math.abs(e)<=Polynomial.TOLERANCE)break;e*a<0?b=g:(d=g,a=e)}return g};
Polynomial.prototype.toString=function(){for(var d=[],b=[],a=this.coefs.length-1;a>=0;a--){var c=Math.round(this.coefs[a]*1E3)/1E3;if(c!=0){var g=c<0?" - ":" + ",c=Math.abs(c);if(a>0)c==1?c=this._variable:c+=this._variable;a>1&&(c+="^"+a);b.push(g);d.push(c)}}b[0]=b[0]==" + "?"":"-";c="";for(a=0;a<d.length;a++)c+=b[a]+d[a];return c};
Polynomial.prototype.trapezoid=function(d,b,a){if(isNaN(d)||isNaN(b)||isNaN(a))throw Error("Polynomial.trapezoid: parameters must be numbers");var c=b-d;if(a==1)a=this.eval(d),b=this.eval(b),this._s=0.5*c*(a+b);else{b=1<<a-2;a=c/b;d+=0.5*a;for(var g=0,f=0;f<b;f++)g+=this.eval(d),d+=a;this._s=0.5*(this._s+c*g/b)}if(isNaN(this._s))throw Error("Polynomial.trapezoid: this._s is NaN");return this._s};
Polynomial.prototype.simpson=function(d,b){if(isNaN(d)||isNaN(b))throw Error("Polynomial.simpson: parameters must be numbers");for(var a=b-d,c=0.5*a*(this.eval(d)+this.eval(b)),g=c,f=4*c/3,e=f,h=c,j=1,k=2;k<=20;k++){for(var c=a/j,f=d+0.5*c,l=0,m=1;m<=j;m++)l+=this.eval(f),f+=c;c=g=0.5*(g+a*l/j);f=(4*c-h)/3;if(Math.abs(f-e)<1.0E-7*Math.abs(e))break;e=f;h=c;j<<=1}return f};
Polynomial.prototype.romberg=function(d,b){if(isNaN(d)||isNaN(b))throw Error("Polynomial.romberg: parameters must be numbers");for(var a=Array(21),c=Array(21),g={y:0,dy:0},f=c[0]=1;f<=20;f++){a[f-1]=this.trapezoid(d,b,f);if(f>=3&&(g=Polynomial.interpolate(c,a,3,f-3,0),Math.abs(g.dy)<=1.0E-6*g.y))break;a[f]=a[f-1];c[f]=0.25*c[f-1]}return g.y};Polynomial.prototype.getDegree=function(){return this.coefs.length-1};
Polynomial.prototype.getDerivative=function(){for(var d=new Polynomial,b=1;b<this.coefs.length;b++)d.coefs.push(b*this.coefs[b]);return d};Polynomial.prototype.getRoots=function(){var d;this.simplify();switch(this.getDegree()){case 0:d=[];break;case 1:d=this.getLinearRoot();break;case 2:d=this.getQuadraticRoots();break;case 3:d=this.getCubicRoots();break;case 4:d=this.getQuarticRoots();break;default:d=[]}return d};
Polynomial.prototype.getRootsInInterval=function(d,b){var a=[],c;if(this.getDegree()==1)c=this.bisection(d,b);else{var g=this.getDerivative().getRootsInInterval(d,b);if(g.length>0){c=this.bisection(d,g[0]);c!=null&&a.push(c);for(i=0;i<=g.length-2;i++)c=this.bisection(g[i],g[i+1]),c!=null&&a.push(c);c=this.bisection(g[g.length-1],b)}else c=this.bisection(d,b)}c!=null&&a.push(c);return a};Polynomial.prototype.getLinearRoot=function(){var d=[],b=this.coefs[1];b!=0&&d.push(-this.coefs[0]/b);return d};
Polynomial.prototype.getQuadraticRoots=function(){var d=[];if(this.getDegree()==2){var b=this.coefs[2],a=this.coefs[1]/b,b=a*a-4*(this.coefs[0]/b);b>0?(b=Math.sqrt(b),d.push(0.5*(-a+b)),d.push(0.5*(-a-b))):b==0&&d.push(0.5*-a)}return d};
Polynomial.prototype.getCubicRoots=function(){var d=[];if(this.getDegree()==3){var b=this.coefs[3],a=this.coefs[2]/b,c=this.coefs[1]/b,g=(3*c-a*a)/3,b=(2*a*a*a-9*c*a+27*(this.coefs[0]/b))/27;a/=3;c=b*b/4+g*g*g/27;b/=2;Math.abs(c)<=Polynomial.TOLERANCE&&(disrim=0);if(c>0){var g=Math.sqrt(c),f,c=-b+g;f=c>=0?Math.pow(c,1/3):-Math.pow(-c,1/3);c=-b-g;c>=0?f+=Math.pow(c,1/3):f-=Math.pow(-c,1/3);d.push(f-a)}else c<0?(g=Math.sqrt(-g/3),c=Math.atan2(Math.sqrt(-c),-b)/3,b=Math.cos(c),c=Math.sin(c),f=Math.sqrt(3),
d.push(2*g*b-a),d.push(-g*(b+f*c)-a),d.push(-g*(b-f*c)-a)):(c=b>=0?-Math.pow(b,1/3):Math.pow(-b,1/3),d.push(2*c-a),d.push(-c-a))}return d};
Polynomial.prototype.getQuarticRoots=function(){var d=[];if(this.getDegree()==4){var b=this.coefs[4],a=this.coefs[3]/b,c=this.coefs[2]/b,g=this.coefs[1]/b,b=this.coefs[0]/b,f=(new Polynomial(1,-c,a*g-4*b,-a*a*b+4*c*b-g*g)).getCubicRoots()[0],e=a*a/4-c+f;Math.abs(e)<=Polynomial.TOLERANCE&&(e=0);e>0?(b=Math.sqrt(e),f=3*a*a/4-b*b-2*c,g=(4*a*c-8*g-a*a*a)/(4*b),c=f+g,g=f-g,Math.abs(c)<=Polynomial.TOLERANCE&&(c=0),Math.abs(g)<=Polynomial.TOLERANCE&&(g=0),c>=0&&(c=Math.sqrt(c),d.push(-a/4+(b+c)/2),d.push(-a/
4+(b-c)/2)),g>=0&&(c=Math.sqrt(g),d.push(-a/4+(c-b)/2),d.push(-a/4-(c+b)/2))):e<0||(g=f*f-4*b,g>=-Polynomial.TOLERANCE&&(g<0&&(g=0),g=2*Math.sqrt(g),f=3*a*a/4-2*c,f+g>=Polynomial.TOLERANCE&&(c=Math.sqrt(f+g),d.push(-a/4+c/2),d.push(-a/4-c/2)),f-g>=Polynomial.TOLERANCE&&(c=Math.sqrt(f-g),d.push(-a/4+c/2),d.push(-a/4-c/2))))}return d};function Intersection(d){arguments.length>0&&this.init(d)}Intersection.prototype.init=function(d){this.status=d;this.points=[]};Intersection.prototype.appendPoint=function(d){this.points.push(d)};Intersection.prototype.appendPoints=function(d){this.points=this.points.concat(d)};
Intersection.intersectShapes=function(d,b){var a=d.getIntersectionParams(),c=b.getIntersectionParams(),g;if(a!=null&&c!=null)if(a.name=="Path")g=Intersection.intersectPathShape(d,b);else if(c.name=="Path")g=Intersection.intersectPathShape(b,d);else{a.name<c.name?(g="intersect"+a.name+c.name,a=a.params.concat(c.params)):(g="intersect"+c.name+a.name,a=c.params.concat(a.params));if(!(g in Intersection))throw Error("Intersection not available: "+g);g=Intersection[g].apply(null,a)}else g=new Intersection("No Intersection");
return g};Intersection.intersectPathShape=function(d,b){return d.intersectShape(b)};
Intersection.intersectBezier2Bezier2=function(d,b,a,c,g,f){var e,h,j=new Intersection("No Intersection");e=b.multiply(-2);a=d.add(e.add(a));e=d.multiply(-2);h=b.multiply(2);b=e.add(h);d=new Point2D(d.x,d.y);e=g.multiply(-2);f=c.add(e.add(f));e=c.multiply(-2);h=g.multiply(2);g=e.add(h);c=new Point2D(c.x,c.y);e=a.x*b.y-b.x*a.y;h=f.x*b.y-b.x*f.y;var k=f.x*a.y-a.x*f.y,l=g.x*a.y-a.x*g.y,m=a.x*(d.y-c.y)+a.y*(-d.x+c.x);e=(new Polynomial(-k*k,-2*k*l,e*h-l*l-2*k*m,e*(g.x*b.y-b.x*g.y)-2*l*m,e*(b.x*(d.y-c.y)+
b.y*(-d.x+c.x))-m*m)).getRoots();for(h=0;h<e.length;h++)if(k=e[h],0<=k&&k<=1&&(l=(new Polynomial(-a.x,-b.x,-d.x+c.x+k*g.x+k*k*f.x)).getRoots(),m=(new Polynomial(-a.y,-b.y,-d.y+c.y+k*g.y+k*k*f.y)).getRoots(),l.length>0&&m.length>0)){var q=0;a:for(;q<l.length;q++){var r=l[q];if(0<=r&&r<=1)for(var u=0;u<m.length;u++)if(Math.abs(r-m[u])<1.0E-4){j.points.push(f.multiply(k*k).add(g.multiply(k).add(c)));break a}}}return j};
Intersection.intersectBezier2Bezier3=function(d,b,a,c,g,f,e){var h,j,k,l=new Intersection("No Intersection");h=b.multiply(-2);a=d.add(h.add(a));h=d.multiply(-2);j=b.multiply(2);b=h.add(j);d=new Point2D(d.x,d.y);h=c.multiply(-1);j=g.multiply(3);k=f.multiply(-3);h=h.add(j.add(k.add(e)));e=new Vector2D(h.x,h.y);h=c.multiply(3);j=g.multiply(-6);k=f.multiply(3);h=h.add(j.add(k));f=new Vector2D(h.x,h.y);h=c.multiply(-3);j=g.multiply(3);k=h.add(j);g=new Vector2D(k.x,k.y);c=new Vector2D(c.x,c.y);h=b.x*b.x;
j=b.y*b.y;k=a.x*a.x;var m=a.y*a.y;h=(new Polynomial(-2*a.x*a.y*e.x*e.y+k*e.y*e.y+m*e.x*e.x,-2*a.x*a.y*f.x*e.y-2*a.x*a.y*f.y*e.x+2*m*f.x*e.x+2*k*f.y*e.y,-2*a.x*g.x*a.y*e.y-2*a.x*a.y*g.y*e.x-2*a.x*a.y*f.x*f.y+2*g.x*m*e.x+m*f.x*f.x+k*(2*g.y*e.y+f.y*f.y),2*d.x*a.x*a.y*e.y+2*d.y*a.x*a.y*e.x+b.x*b.y*a.x*e.y+b.x*b.y*a.y*e.x-2*c.x*a.x*a.y*e.y-2*a.x*c.y*a.y*e.x-2*a.x*g.x*a.y*f.y-2*a.x*a.y*g.y*f.x-2*d.x*m*e.x-2*d.y*k*e.y+2*c.x*m*e.x+2*g.x*m*f.x-j*a.x*e.x-h*a.y*e.y+k*(2*c.y*e.y+2*g.y*f.y),2*d.x*a.x*a.y*f.y+
2*d.y*a.x*a.y*f.x+b.x*b.y*a.x*f.y+b.x*b.y*a.y*f.x-2*c.x*a.x*a.y*f.y-2*a.x*c.y*a.y*f.x-2*a.x*g.x*a.y*g.y-2*d.x*m*f.x-2*d.y*k*f.y+2*c.x*m*f.x-j*a.x*f.x-h*a.y*f.y+g.x*g.x*m+k*(2*c.y*f.y+g.y*g.y),2*d.x*a.x*a.y*g.y+2*d.y*a.x*g.x*a.y+b.x*b.y*a.x*g.y+b.x*b.y*g.x*a.y-2*c.x*a.x*a.y*g.y-2*a.x*c.y*g.x*a.y-2*d.x*g.x*m-2*d.y*k*g.y+2*c.x*g.x*m-j*a.x*g.x-h*a.y*g.y+2*k*c.y*g.y,-2*d.x*d.y*a.x*a.y-d.x*b.x*b.y*a.y-d.y*b.x*b.y*a.x+2*d.x*a.x*c.y*a.y+2*d.y*c.x*a.x*a.y+b.x*c.x*b.y*a.y+b.x*b.y*a.x*c.y-2*c.x*a.x*c.y*a.y-
2*d.x*c.x*m+d.x*j*a.x+d.y*h*a.y-2*d.y*k*c.y-c.x*j*a.x-h*c.y*a.y+d.x*d.x*m+d.y*d.y*k+c.x*c.x*m+k*c.y*c.y)).getRootsInInterval(0,1);for(j=0;j<h.length;j++){k=h[j];var m=(new Polynomial(a.x,b.x,d.x-c.x-k*g.x-k*k*f.x-k*k*k*e.x)).getRoots(),q=(new Polynomial(a.y,b.y,d.y-c.y-k*g.y-k*k*f.y-k*k*k*e.y)).getRoots();if(m.length>0&&q.length>0){var r=0;a:for(;r<m.length;r++){var u=m[r];if(0<=u&&u<=1)for(var s=0;s<q.length;s++)if(Math.abs(u-q[s])<1.0E-4){l.points.push(e.multiply(k*k*k).add(f.multiply(k*k).add(g.multiply(k).add(c))));
break a}}}}if(l.points.length>0)l.status="Intersection";return l};Intersection.intersectBezier2Circle=function(d,b,a,c,g){return Intersection.intersectBezier2Ellipse(d,b,a,c,g,g)};
Intersection.intersectBezier2Ellipse=function(d,b,a,c,g,f){var e,h=new Intersection("No Intersection");e=b.multiply(-2);a=d.add(e.add(a));e=d.multiply(-2);b=b.multiply(2);e=e.add(b);d=new Point2D(d.x,d.y);g*=g;f*=f;c=(new Polynomial(f*a.x*a.x+g*a.y*a.y,2*(f*a.x*e.x+g*a.y*e.y),f*(2*a.x*d.x+e.x*e.x)+g*(2*a.y*d.y+e.y*e.y)-2*(f*c.x*a.x+g*c.y*a.y),2*(f*e.x*(d.x-c.x)+g*e.y*(d.y-c.y)),f*(d.x*d.x+c.x*c.x)+g*(d.y*d.y+c.y*c.y)-2*(f*c.x*d.x+g*c.y*d.y)-g*f)).getRoots();for(f=0;f<c.length;f++)g=c[f],0<=g&&g<=
1&&h.points.push(a.multiply(g*g).add(e.multiply(g).add(d)));if(h.points.length>0)h.status="Intersection";return h};
Intersection.intersectBezier2Line=function(d,b,a,c,g){var f,e,h,j,k,l=c.min(g),m=c.max(g),q=new Intersection("No Intersection");f=b.multiply(-2);h=d.add(f.add(a));f=d.multiply(-2);e=b.multiply(2);f=f.add(e);e=new Point2D(d.x,d.y);k=new Vector2D(c.y-g.y,g.x-c.x);j=c.x*g.y-g.x*c.y;roots=(new Polynomial(k.dot(h),k.dot(f),k.dot(e)+j)).getRoots();for(h=0;h<roots.length;h++)if(f=roots[h],0<=f&&f<=1)if(e=d.lerp(b,f),j=b.lerp(a,f),f=e.lerp(j,f),c.x==g.x){if(l.y<=f.y&&f.y<=m.y)q.status="Intersection",q.appendPoint(f)}else if(c.y==
g.y){if(l.x<=f.x&&f.x<=m.x)q.status="Intersection",q.appendPoint(f)}else if(f.gte(l)&&f.lte(m))q.status="Intersection",q.appendPoint(f);return q};Intersection.intersectBezier2Polygon=function(d,b,a,c){for(var g=new Intersection("No Intersection"),f=c.length,e=0;e<f;e++){var h=Intersection.intersectBezier2Line(d,b,a,c[e],c[(e+1)%f]);g.appendPoints(h.points)}if(g.points.length>0)g.status="Intersection";return g};
Intersection.intersectBezier2Rectangle=function(d,b,a,c,g){var f=c.min(g),e=c.max(g),g=new Point2D(e.x,f.y),h=new Point2D(f.x,e.y),c=Intersection.intersectBezier2Line(d,b,a,f,g),g=Intersection.intersectBezier2Line(d,b,a,g,e),e=Intersection.intersectBezier2Line(d,b,a,e,h),d=Intersection.intersectBezier2Line(d,b,a,h,f),b=new Intersection("No Intersection");b.appendPoints(c.points);b.appendPoints(g.points);b.appendPoints(e.points);b.appendPoints(d.points);if(b.points.length>0)b.status="Intersection";
return b};
Intersection.intersectBezier3Bezier3=function(d,b,a,c,g,f,e,h){var j,k,l,m=new Intersection("No Intersection");j=d.multiply(-1);k=b.multiply(3);l=a.multiply(-3);j=j.add(k.add(l.add(c)));c=new Vector2D(j.x,j.y);j=d.multiply(3);k=b.multiply(-6);l=a.multiply(3);j=j.add(k.add(l));a=new Vector2D(j.x,j.y);j=d.multiply(-3);k=b.multiply(3);l=j.add(k);b=new Vector2D(l.x,l.y);d=new Vector2D(d.x,d.y);j=g.multiply(-1);k=f.multiply(3);l=e.multiply(-3);j=j.add(k.add(l.add(h)));h=new Vector2D(j.x,j.y);j=g.multiply(3);
k=f.multiply(-6);l=e.multiply(3);j=j.add(k.add(l));e=new Vector2D(j.x,j.y);j=g.multiply(-3);k=f.multiply(3);l=j.add(k);f=new Vector2D(l.x,l.y);g=new Vector2D(g.x,g.y);j=d.x*d.x;k=d.y*d.y;l=b.x*b.x;var q=b.x*b.x*b.x,r=b.y*b.y,u=b.y*b.y*b.y,s=a.x*a.x,z=a.x*a.x*a.x,t=a.y*a.y,A=a.y*a.y*a.y,p=c.x*c.x,w=c.x*c.x*c.x,o=c.y*c.y,v=c.y*c.y*c.y,B=g.x*g.x,H=g.y*g.y,I=f.x*f.x,C=f.y*f.y,D=e.x*e.x,E=e.y*e.y,F=h.x*h.x,G=h.y*h.y;j=(new Polynomial(-w*h.y*h.y*h.y+v*h.x*h.x*h.x-3*c.x*o*F*h.y+3*p*c.y*h.x*G,-6*c.x*e.x*
o*h.x*h.y+6*p*c.y*e.y*h.x*h.y+3*e.x*v*F-3*w*e.y*G-3*c.x*o*e.y*F+3*p*e.x*c.y*G,-6*f.x*c.x*o*h.x*h.y-6*c.x*e.x*o*e.y*h.x+6*p*e.x*c.y*e.y*h.y+3*f.x*v*F+3*D*v*h.x+3*f.x*p*c.y*G-3*c.x*f.y*o*F-3*c.x*D*o*h.y+p*c.y*h.x*(6*f.y*h.y+3*E)+w*(-f.y*G-2*E*h.y-h.y*(2*f.y*h.y+E)),b.x*a.y*c.x*c.y*h.x*h.y-b.y*a.x*c.x*c.y*h.x*h.y+6*f.x*e.x*v*h.x+3*b.x*a.x*c.x*c.y*G+6*d.x*c.x*o*h.x*h.y-3*b.x*a.x*o*h.x*h.y-3*b.y*a.y*c.x*c.y*F-6*d.y*p*c.y*h.x*h.y-6*g.x*c.x*o*h.x*h.y+3*b.y*a.y*p*h.x*h.y-2*a.x*t*c.x*h.x*h.y-6*f.x*c.x*e.x*
o*h.y-6*f.x*c.x*o*e.y*h.x-6*c.x*f.y*e.x*o*h.x+6*f.x*p*c.y*e.y*h.y+2*s*a.y*c.y*h.x*h.y+e.x*e.x*e.x*v-3*d.x*v*F+3*d.y*w*G+3*g.x*v*F+A*c.x*F-z*c.y*G-3*d.x*p*c.y*G+3*d.y*c.x*o*F-2*b.x*a.y*p*G+b.x*a.y*o*F-b.y*a.x*p*G+2*b.y*a.x*o*F+3*g.x*p*c.y*G-a.x*t*c.y*F-3*g.y*c.x*o*F+s*a.y*c.x*G-3*c.x*D*o*e.y+p*c.y*h.x*(6*g.y*h.y+6*f.y*e.y)+p*e.x*c.y*(6*f.y*h.y+3*E)+w*(-2*f.y*e.y*h.y-g.y*G-e.y*(2*f.y*h.y+E)-h.y*(2*g.y*h.y+2*f.y*e.y)),6*b.x*a.x*c.x*c.y*e.y*h.y+b.x*a.y*c.x*e.x*c.y*h.y+b.x*a.y*c.x*c.y*e.y*h.x-b.y*a.x*
c.x*e.x*c.y*h.y-b.y*a.x*c.x*c.y*e.y*h.x-6*b.y*a.y*c.x*e.x*c.y*h.x-6*d.x*e.x*v*h.x+6*g.x*e.x*v*h.x+6*d.y*w*e.y*h.y+2*A*c.x*e.x*h.x-2*z*c.y*e.y*h.y+6*d.x*c.x*e.x*o*h.y+6*d.x*c.x*o*e.y*h.x+6*d.y*c.x*e.x*o*h.x-3*b.x*a.x*e.x*o*h.y-3*b.x*a.x*o*e.y*h.x+2*b.x*a.y*e.x*o*h.x+4*b.y*a.x*e.x*o*h.x-6*d.x*p*c.y*e.y*h.y-6*d.y*p*e.x*c.y*h.y-6*d.y*p*c.y*e.y*h.x-4*b.x*a.y*p*e.y*h.y-6*g.x*c.x*e.x*o*h.y-6*g.x*c.x*o*e.y*h.x-2*b.y*a.x*p*e.y*h.y+3*b.y*a.y*p*e.x*h.y+3*b.y*a.y*p*e.y*h.x-2*a.x*t*c.x*e.x*h.y-2*a.x*t*c.x*e.y*
h.x-2*a.x*t*e.x*c.y*h.x-6*g.y*c.x*e.x*o*h.x-6*f.x*c.x*f.y*o*h.x-6*f.x*c.x*e.x*o*e.y+6*g.x*p*c.y*e.y*h.y+2*s*a.y*c.x*e.y*h.y+2*s*a.y*e.x*c.y*h.y+2*s*a.y*c.y*e.y*h.x+3*f.x*D*v+3*I*v*h.x-3*c.x*f.y*D*o-3*I*c.x*o*h.y+p*e.x*c.y*(6*g.y*h.y+6*f.y*e.y)+p*c.y*h.x*(6*g.y*e.y+3*C)+f.x*p*c.y*(6*f.y*h.y+3*E)+w*(-2*g.y*e.y*h.y-h.y*(2*g.y*e.y+C)-f.y*(2*f.y*h.y+E)-e.y*(2*g.y*h.y+2*f.y*e.y)),b.x*f.x*a.y*c.x*c.y*h.y+b.x*a.y*c.x*f.y*c.y*h.x+b.x*a.y*c.x*e.x*c.y*e.y-b.y*a.x*f.x*c.x*c.y*h.y-b.y*a.x*c.x*f.y*c.y*h.x-b.y*
a.x*c.x*e.x*c.y*e.y-6*b.y*f.x*a.y*c.x*c.y*h.x-6*d.x*f.x*v*h.x+6*g.x*f.x*v*h.x+2*f.x*A*c.x*h.x+6*d.x*f.x*c.x*o*h.y+6*d.x*c.x*f.y*o*h.x+6*d.x*c.x*e.x*o*e.y+6*d.y*f.x*c.x*o*h.x-3*b.x*a.x*f.x*o*h.y-3*b.x*a.x*f.y*o*h.x-3*b.x*a.x*e.x*o*e.y+2*b.x*f.x*a.y*o*h.x+4*b.y*a.x*f.x*o*h.x-6*d.y*f.x*p*c.y*h.y-6*d.y*p*f.y*c.y*h.x-6*d.y*p*e.x*c.y*e.y-6*g.x*f.x*c.x*o*h.y-6*g.x*c.x*f.y*o*h.x-6*g.x*c.x*e.x*o*e.y+3*b.y*f.x*a.y*p*h.y-3*b.y*a.y*c.x*D*c.y+3*b.y*a.y*p*f.y*h.x+3*b.y*a.y*p*e.x*e.y-2*a.x*f.x*t*c.x*h.y-2*a.x*f.x*
t*c.y*h.x-2*a.x*t*c.x*f.y*h.x-2*a.x*t*c.x*e.x*e.y-6*g.y*f.x*c.x*o*h.x-6*f.x*c.x*f.y*e.x*o+6*g.y*p*f.y*c.y*h.x+2*s*f.x*a.y*c.y*h.y+2*s*a.y*f.y*c.y*h.x+2*s*a.y*e.x*c.y*e.y-3*d.x*D*v+3*g.x*D*v+3*I*e.x*v+A*c.x*D+3*d.y*c.x*D*o+b.x*a.y*D*o+2*b.y*a.x*D*o-a.x*t*D*c.y-3*g.y*c.x*D*o-3*I*c.x*o*e.y+s*a.y*c.x*(2*f.y*h.y+E)+b.x*a.x*c.x*c.y*(6*f.y*h.y+3*E)+f.x*p*c.y*(6*g.y*h.y+6*f.y*e.y)+z*c.y*(-2*f.y*h.y-E)+d.y*w*(6*f.y*h.y+3*E)+b.y*a.x*p*(-2*f.y*h.y-E)+b.x*a.y*p*(-4*f.y*h.y-2*E)+d.x*p*c.y*(-6*f.y*h.y-3*E)+p*e.x*
c.y*(6*g.y*e.y+3*C)+g.x*p*c.y*(6*f.y*h.y+3*E)+w*(-2*g.y*f.y*h.y-e.y*(2*g.y*e.y+C)-g.y*(2*f.y*h.y+E)-f.y*(2*g.y*h.y+2*f.y*e.y)),-d.x*b.x*a.y*c.x*c.y*h.y+d.x*b.y*a.x*c.x*c.y*h.y+6*d.x*b.y*a.y*c.x*c.y*h.x-6*d.y*b.x*a.x*c.x*c.y*h.y-d.y*b.x*a.y*c.x*c.y*h.x+d.y*b.y*a.x*c.x*c.y*h.x+b.x*b.y*a.x*a.y*c.x*h.y-b.x*b.y*a.x*a.y*c.y*h.x+b.x*g.x*a.y*c.x*c.y*h.y+b.x*g.y*a.y*c.x*c.y*h.x+b.x*f.x*a.y*c.x*c.y*e.y+b.x*a.y*c.x*f.y*e.x*c.y-g.x*b.y*a.x*c.x*c.y*h.y-6*g.x*b.y*a.y*c.x*c.y*h.x-b.y*a.x*g.y*c.x*c.y*h.x-b.y*a.x*
f.x*c.x*c.y*e.y-b.y*a.x*c.x*f.y*e.x*c.y-6*b.y*f.x*a.y*c.x*e.x*c.y-6*d.x*g.x*v*h.x-6*d.x*f.x*e.x*v-2*d.x*A*c.x*h.x+6*g.x*f.x*e.x*v+2*g.x*A*c.x*h.x+2*f.x*A*c.x*e.x+2*d.y*z*c.y*h.y-6*d.x*d.y*c.x*o*h.x+3*d.x*b.x*a.x*o*h.y-2*d.x*b.x*a.y*o*h.x-4*d.x*b.y*a.x*o*h.x+3*d.y*b.x*a.x*o*h.x+6*d.x*d.y*p*c.y*h.y+6*d.x*g.x*c.x*o*h.y-3*d.x*b.y*a.y*p*h.y+2*d.x*a.x*t*c.x*h.y+2*d.x*a.x*t*c.y*h.x+6*d.x*g.y*c.x*o*h.x+6*d.x*f.x*c.x*o*e.y+6*d.x*c.x*f.y*e.x*o+4*d.y*b.x*a.y*p*h.y+6*d.y*g.x*c.x*o*h.x+2*d.y*b.y*a.x*p*h.y-3*d.y*
b.y*a.y*p*h.x+2*d.y*a.x*t*c.x*h.x+6*d.y*f.x*c.x*e.x*o-3*b.x*g.x*a.x*o*h.y+2*b.x*g.x*a.y*o*h.x+b.x*b.y*t*c.x*h.x-3*b.x*a.x*g.y*o*h.x-3*b.x*a.x*f.x*o*e.y-3*b.x*a.x*f.y*e.x*o+2*b.x*f.x*a.y*e.x*o+4*g.x*b.y*a.x*o*h.x+4*b.y*a.x*f.x*e.x*o-2*d.x*s*a.y*c.y*h.y-6*d.y*g.x*p*c.y*h.y-6*d.y*g.y*p*c.y*h.x-6*d.y*f.x*p*c.y*e.y-2*d.y*s*a.y*c.x*h.y-2*d.y*s*a.y*c.y*h.x-6*d.y*p*f.y*e.x*c.y-b.x*b.y*s*c.y*h.y-2*b.x*r*c.x*c.y*h.x+3*g.x*b.y*a.y*p*h.y-2*g.x*a.x*t*c.x*h.y-2*g.x*a.x*t*c.y*h.x-6*g.x*g.y*c.x*o*h.x-6*g.x*f.x*c.x*
o*e.y-6*g.x*c.x*f.y*e.x*o+3*b.y*g.y*a.y*p*h.x+3*b.y*f.x*a.y*p*e.y+3*b.y*a.y*p*f.y*e.x-2*a.x*g.y*t*c.x*h.x-2*a.x*f.x*t*c.x*e.y-2*a.x*f.x*t*e.x*c.y-2*a.x*t*c.x*f.y*e.x-6*g.y*f.x*c.x*e.x*o-r*a.x*a.y*c.x*h.x+2*g.x*s*a.y*c.y*h.y+6*g.y*p*f.y*e.x*c.y+2*l*b.y*c.x*c.y*h.y+l*a.x*a.y*c.y*h.y+2*s*g.y*a.y*c.y*h.x+2*s*f.x*a.y*c.y*e.y+2*s*a.y*f.y*e.x*c.y+f.x*f.x*f.x*v+3*j*v*h.x-3*k*w*h.y+3*B*v*h.x+u*p*h.x-q*o*h.y-b.x*r*p*h.y+l*b.y*o*h.x-3*j*c.x*o*h.y+3*k*p*c.y*h.x-l*t*c.x*h.y+r*s*c.y*h.x-3*I*c.x*f.y*o-3*B*c.x*o*
h.y+3*H*p*c.y*h.x+b.x*a.x*c.x*c.y*(6*g.y*h.y+6*f.y*e.y)+z*c.y*(-2*g.y*h.y-2*f.y*e.y)+d.y*w*(6*g.y*h.y+6*f.y*e.y)+b.y*a.x*p*(-2*g.y*h.y-2*f.y*e.y)+s*a.y*c.x*(2*g.y*h.y+2*f.y*e.y)+b.x*a.y*p*(-4*g.y*h.y-4*f.y*e.y)+d.x*p*c.y*(-6*g.y*h.y-6*f.y*e.y)+g.x*p*c.y*(6*g.y*h.y+6*f.y*e.y)+f.x*p*c.y*(6*g.y*e.y+3*C)+w*(-2*g.y*f.y*e.y-H*h.y-f.y*(2*g.y*e.y+C)-g.y*(2*g.y*h.y+2*f.y*e.y)),-d.x*b.x*a.y*c.x*c.y*e.y+d.x*b.y*a.x*c.x*c.y*e.y+6*d.x*b.y*a.y*c.x*e.x*c.y-6*d.y*b.x*a.x*c.x*c.y*e.y-d.y*b.x*a.y*c.x*e.x*c.y+d.y*b.y*
a.x*c.x*e.x*c.y+b.x*b.y*a.x*a.y*c.x*e.y-b.x*b.y*a.x*a.y*e.x*c.y+b.x*g.x*a.y*c.x*c.y*e.y+b.x*g.y*a.y*c.x*e.x*c.y+b.x*f.x*a.y*c.x*f.y*c.y-g.x*b.y*a.x*c.x*c.y*e.y-6*g.x*b.y*a.y*c.x*e.x*c.y-b.y*a.x*g.y*c.x*e.x*c.y-b.y*a.x*f.x*c.x*f.y*c.y-6*d.x*g.x*e.x*v-2*d.x*A*c.x*e.x+2*g.x*A*c.x*e.x+2*d.y*z*c.y*e.y-6*d.x*d.y*c.x*e.x*o+3*d.x*b.x*a.x*o*e.y-2*d.x*b.x*a.y*e.x*o-4*d.x*b.y*a.x*e.x*o+3*d.y*b.x*a.x*e.x*o+6*d.x*d.y*p*c.y*e.y+6*d.x*g.x*c.x*o*e.y-3*d.x*b.y*a.y*p*e.y+2*d.x*a.x*t*c.x*e.y+2*d.x*a.x*t*e.x*c.y+6*d.x*
g.y*c.x*e.x*o+6*d.x*f.x*c.x*f.y*o+4*d.y*b.x*a.y*p*e.y+6*d.y*g.x*c.x*e.x*o+2*d.y*b.y*a.x*p*e.y-3*d.y*b.y*a.y*p*e.x+2*d.y*a.x*t*c.x*e.x-3*b.x*g.x*a.x*o*e.y+2*b.x*g.x*a.y*e.x*o+b.x*b.y*t*c.x*e.x-3*b.x*a.x*g.y*e.x*o-3*b.x*a.x*f.x*f.y*o+4*g.x*b.y*a.x*e.x*o-2*d.x*s*a.y*c.y*e.y-6*d.y*g.x*p*c.y*e.y-6*d.y*g.y*p*e.x*c.y-6*d.y*f.x*p*f.y*c.y-2*d.y*s*a.y*c.x*e.y-2*d.y*s*a.y*e.x*c.y-b.x*b.y*s*c.y*e.y-2*b.x*r*c.x*e.x*c.y+3*g.x*b.y*a.y*p*e.y-2*g.x*a.x*t*c.x*e.y-2*g.x*a.x*t*e.x*c.y-6*g.x*g.y*c.x*e.x*o-6*g.x*f.x*c.x*
f.y*o+3*b.y*g.y*a.y*p*e.x+3*b.y*f.x*a.y*p*f.y-2*a.x*g.y*t*c.x*e.x-2*a.x*f.x*t*c.x*f.y-r*a.x*a.y*c.x*e.x+2*g.x*s*a.y*c.y*e.y-3*b.y*I*a.y*c.x*c.y+6*g.y*f.x*p*f.y*c.y+2*l*b.y*c.x*c.y*e.y+l*a.x*a.y*c.y*e.y+2*s*g.y*a.y*e.x*c.y+2*s*f.x*a.y*f.y*c.y-3*d.x*I*v+3*g.x*I*v+3*j*e.x*v-3*k*w*e.y+3*B*e.x*v+I*A*c.x+u*p*e.x-q*o*e.y+3*d.y*I*c.x*o-b.x*r*p*e.y+b.x*I*a.y*o+2*b.y*a.x*I*o+l*b.y*e.x*o-a.x*I*t*c.y-3*g.y*I*c.x*o-3*j*c.x*o*e.y+3*k*p*e.x*c.y-l*t*c.x*e.y+r*s*e.x*c.y-3*B*c.x*o*e.y+3*H*p*e.x*c.y+s*a.y*c.x*(2*g.y*
e.y+C)+b.x*a.x*c.x*c.y*(6*g.y*e.y+3*C)+z*c.y*(-2*g.y*e.y-C)+d.y*w*(6*g.y*e.y+3*C)+b.y*a.x*p*(-2*g.y*e.y-C)+b.x*a.y*p*(-4*g.y*e.y-2*C)+d.x*p*c.y*(-6*g.y*e.y-3*C)+g.x*p*c.y*(6*g.y*e.y+3*C)+w*(-2*g.y*C-H*e.y-g.y*(2*g.y*e.y+C)),-d.x*b.x*a.y*c.x*f.y*c.y+d.x*b.y*a.x*c.x*f.y*c.y+6*d.x*b.y*f.x*a.y*c.x*c.y-6*d.y*b.x*a.x*c.x*f.y*c.y-d.y*b.x*f.x*a.y*c.x*c.y+d.y*b.y*a.x*f.x*c.x*c.y-b.x*b.y*a.x*f.x*a.y*c.y+b.x*b.y*a.x*a.y*c.x*f.y+b.x*g.x*a.y*c.x*f.y*c.y+6*b.x*a.x*g.y*c.x*f.y*c.y+b.x*g.y*f.x*a.y*c.x*c.y-g.x*b.y*
a.x*c.x*f.y*c.y-6*g.x*b.y*f.x*a.y*c.x*c.y-b.y*a.x*g.y*f.x*c.x*c.y-6*d.x*g.x*f.x*v-2*d.x*f.x*A*c.x+6*d.y*g.y*w*f.y+2*g.x*f.x*A*c.x+2*d.y*z*f.y*c.y-2*z*g.y*f.y*c.y-6*d.x*d.y*f.x*c.x*o+3*d.x*b.x*a.x*f.y*o-2*d.x*b.x*f.x*a.y*o-4*d.x*b.y*a.x*f.x*o+3*d.y*b.x*a.x*f.x*o+6*d.x*d.y*p*f.y*c.y+6*d.x*g.x*c.x*f.y*o-3*d.x*b.y*a.y*p*f.y+2*d.x*a.x*f.x*t*c.y+2*d.x*a.x*t*c.x*f.y+6*d.x*g.y*f.x*c.x*o+4*d.y*b.x*a.y*p*f.y+6*d.y*g.x*f.x*c.x*o+2*d.y*b.y*a.x*p*f.y-3*d.y*b.y*f.x*a.y*p+2*d.y*a.x*f.x*t*c.x-3*b.x*g.x*a.x*f.y*o+
2*b.x*g.x*f.x*a.y*o+b.x*b.y*f.x*t*c.x-3*b.x*a.x*g.y*f.x*o+4*g.x*b.y*a.x*f.x*o-6*d.x*g.y*p*f.y*c.y-2*d.x*s*a.y*f.y*c.y-6*d.y*g.x*p*f.y*c.y-6*d.y*g.y*f.x*p*c.y-2*d.y*s*f.x*a.y*c.y-2*d.y*s*a.y*c.x*f.y-b.x*b.y*s*f.y*c.y-4*b.x*g.y*a.y*p*f.y-2*b.x*r*f.x*c.x*c.y+3*g.x*b.y*a.y*p*f.y-2*g.x*a.x*f.x*t*c.y-2*g.x*a.x*t*c.x*f.y-6*g.x*g.y*f.x*c.x*o-2*b.y*a.x*g.y*p*f.y+3*b.y*g.y*f.x*a.y*p-2*a.x*g.y*f.x*t*c.x-r*a.x*f.x*a.y*c.x+6*g.x*g.y*p*f.y*c.y+2*g.x*s*a.y*f.y*c.y+2*l*b.y*c.x*f.y*c.y+l*a.x*a.y*f.y*c.y+2*s*g.y*f.x*
a.y*c.y+2*s*g.y*a.y*c.x*f.y+3*j*f.x*v-3*k*w*f.y+3*B*f.x*v+u*f.x*p-q*f.y*o-3*H*w*f.y-b.x*r*p*f.y+l*b.y*f.x*o-3*j*c.x*f.y*o+3*k*f.x*p*c.y-l*t*c.x*f.y+r*s*f.x*c.y-3*B*c.x*f.y*o+3*H*f.x*p*c.y,d.x*d.y*b.x*a.y*c.x*c.y-d.x*d.y*b.y*a.x*c.x*c.y+d.x*b.x*b.y*a.x*a.y*c.y-d.y*b.x*b.y*a.x*a.y*c.x-d.x*b.x*g.y*a.y*c.x*c.y+6*d.x*g.x*b.y*a.y*c.x*c.y+d.x*b.y*a.x*g.y*c.x*c.y-d.y*b.x*g.x*a.y*c.x*c.y-6*d.y*b.x*a.x*g.y*c.x*c.y+d.y*g.x*b.y*a.x*c.x*c.y-b.x*g.x*b.y*a.x*a.y*c.y+b.x*b.y*a.x*g.y*a.y*c.x+b.x*g.x*g.y*a.y*c.x*c.y-
g.x*b.y*a.x*g.y*c.x*c.y-2*d.x*g.x*A*c.x+2*d.y*z*g.y*c.y-3*d.x*d.y*b.x*a.x*o-6*d.x*d.y*g.x*c.x*o+3*d.x*d.y*b.y*a.y*p-2*d.x*d.y*a.x*t*c.x-2*d.x*b.x*g.x*a.y*o-d.x*b.x*b.y*t*c.x+3*d.x*b.x*a.x*g.y*o-4*d.x*g.x*b.y*a.x*o+3*d.y*b.x*g.x*a.x*o+6*d.x*d.y*g.y*p*c.y+2*d.x*d.y*s*a.y*c.y+2*d.x*b.x*r*c.x*c.y+2*d.x*g.x*a.x*t*c.y+6*d.x*g.x*g.y*c.x*o-3*d.x*b.y*g.y*a.y*p+2*d.x*a.x*g.y*t*c.x+d.x*r*a.x*a.y*c.x+d.y*b.x*b.y*s*c.y+4*d.y*b.x*g.y*a.y*p-3*d.y*g.x*b.y*a.y*p+2*d.y*g.x*a.x*t*c.x+2*d.y*b.y*a.x*g.y*p+b.x*g.x*b.y*
t*c.x-3*b.x*g.x*a.x*g.y*o-2*d.x*s*g.y*a.y*c.y-6*d.y*g.x*g.y*p*c.y-2*d.y*g.x*s*a.y*c.y-2*d.y*l*b.y*c.x*c.y-d.y*l*a.x*a.y*c.y-2*d.y*s*g.y*a.y*c.x-2*b.x*g.x*r*c.x*c.y-b.x*b.y*s*g.y*c.y+3*g.x*b.y*g.y*a.y*p-2*g.x*a.x*g.y*t*c.x-g.x*r*a.x*a.y*c.x+3*k*b.x*a.x*c.x*c.y+3*b.x*a.x*H*c.x*c.y+2*g.x*s*g.y*a.y*c.y-3*j*b.y*a.y*c.x*c.y+2*l*b.y*g.y*c.x*c.y+l*a.x*g.y*a.y*c.y-3*B*b.y*a.y*c.x*c.y-d.x*d.x*d.x*v+d.y*d.y*d.y*w+g.x*g.x*g.x*v-g.y*g.y*g.y*w-3*d.x*B*v-d.x*u*p+3*j*g.x*v+d.y*q*o+3*d.y*H*w+g.x*u*p+j*A*c.x-3*k*g.y*
w-k*z*c.y+B*A*c.x-q*g.y*o-z*H*c.y-d.x*l*b.y*o+d.y*b.x*r*p-3*d.x*k*p*c.y-d.x*r*s*c.y+d.y*l*t*c.x-b.x*r*g.y*p+3*j*d.y*c.x*o+j*b.x*a.y*o+2*j*b.y*a.x*o-2*k*b.x*a.y*p-k*b.y*a.x*p+l*g.x*b.y*o-3*d.x*H*p*c.y+3*d.y*B*c.x*o+b.x*B*a.y*o-2*b.x*H*a.y*p+g.x*r*s*c.y-b.y*a.x*H*p-j*a.x*t*c.y-3*j*g.y*c.x*o+3*k*g.x*p*c.y+k*s*a.y*c.x-l*g.y*t*c.x+2*B*b.y*a.x*o+3*g.x*H*p*c.y-B*a.x*t*c.y-3*B*g.y*c.x*o+s*H*a.y*c.x)).getRootsInInterval(0,1);for(k=0;k<j.length;k++)if(l=j[k],q=(new Polynomial(c.x,a.x,b.x,d.x-g.x-l*f.x-l*l*
e.x-l*l*l*h.x)).getRoots(),r=(new Polynomial(c.y,a.y,b.y,d.y-g.y-l*f.y-l*l*e.y-l*l*l*h.y)).getRoots(),q.length>0&&r.length>0){u=0;a:for(;u<q.length;u++)if(s=q[u],0<=s&&s<=1)for(z=0;z<r.length;z++)if(Math.abs(s-r[z])<1.0E-4){m.points.push(h.multiply(l*l*l).add(e.multiply(l*l).add(f.multiply(l).add(g))));break a}}if(m.points.length>0)m.status="Intersection";return m};Intersection.intersectBezier3Circle=function(d,b,a,c,g,f){return Intersection.intersectBezier3Ellipse(d,b,a,c,g,f,f)};
Intersection.intersectBezier3Ellipse=function(d,b,a,c,g,f,e){var h,j,k,l=new Intersection("No Intersection");h=d.multiply(-1);j=b.multiply(3);k=a.multiply(-3);h=h.add(j.add(k.add(c)));c=new Vector2D(h.x,h.y);h=d.multiply(3);j=b.multiply(-6);k=a.multiply(3);h=h.add(j.add(k));a=new Vector2D(h.x,h.y);h=d.multiply(-3);j=b.multiply(3);k=h.add(j);b=new Vector2D(k.x,k.y);d=new Vector2D(d.x,d.y);f*=f;e*=e;g=(new Polynomial(c.x*c.x*e+c.y*c.y*f,2*(c.x*a.x*e+c.y*a.y*f),2*(c.x*b.x*e+c.y*b.y*f)+a.x*a.x*e+a.y*
a.y*f,2*c.x*e*(d.x-g.x)+2*c.y*f*(d.y-g.y)+2*(a.x*b.x*e+a.y*b.y*f),2*a.x*e*(d.x-g.x)+2*a.y*f*(d.y-g.y)+b.x*b.x*e+b.y*b.y*f,2*b.x*e*(d.x-g.x)+2*b.y*f*(d.y-g.y),d.x*d.x*e-2*d.y*g.y*f-2*d.x*g.x*e+d.y*d.y*f+g.x*g.x*e+g.y*g.y*f-f*e)).getRootsInInterval(0,1);for(e=0;e<g.length;e++)f=g[e],l.points.push(c.multiply(f*f*f).add(a.multiply(f*f).add(b.multiply(f).add(d))));if(l.points.length>0)l.status="Intersection";return l};
Intersection.intersectBezier3Line=function(d,b,a,c,g,f){var e,h,j,k,l,m,q=g.min(f),r=g.max(f),u=new Intersection("No Intersection");e=d.multiply(-1);h=b.multiply(3);j=a.multiply(-3);k=e.add(h.add(j.add(c)));l=new Vector2D(k.x,k.y);e=d.multiply(3);h=b.multiply(-6);j=a.multiply(3);k=e.add(h.add(j));k=new Vector2D(k.x,k.y);e=d.multiply(-3);h=b.multiply(3);j=e.add(h);e=new Vector2D(j.x,j.y);h=new Vector2D(d.x,d.y);m=new Vector2D(g.y-f.y,f.x-g.x);j=g.x*f.y-f.x*g.y;roots=(new Polynomial(m.dot(l),m.dot(k),
m.dot(e),m.dot(h)+j)).getRoots();for(l=0;l<roots.length;l++)if(k=roots[l],0<=k&&k<=1)if(j=d.lerp(b,k),e=b.lerp(a,k),h=a.lerp(c,k),j=j.lerp(e,k),e=e.lerp(h,k),k=j.lerp(e,k),g.x==f.x){if(q.y<=k.y&&k.y<=r.y)u.status="Intersection",u.appendPoint(k)}else if(g.y==f.y){if(q.x<=k.x&&k.x<=r.x)u.status="Intersection",u.appendPoint(k)}else if(k.gte(q)&&k.lte(r))u.status="Intersection",u.appendPoint(k);return u};
Intersection.intersectBezier3Polygon=function(d,b,a,c,g){for(var f=new Intersection("No Intersection"),e=g.length,h=0;h<e;h++){var j=Intersection.intersectBezier3Line(d,b,a,c,g[h],g[(h+1)%e]);f.appendPoints(j.points)}if(f.points.length>0)f.status="Intersection";return f};
Intersection.intersectBezier3Rectangle=function(d,b,a,c,g,f){var e=g.min(f),h=g.max(f),f=new Point2D(h.x,e.y),j=new Point2D(e.x,h.y),g=Intersection.intersectBezier3Line(d,b,a,c,e,f),f=Intersection.intersectBezier3Line(d,b,a,c,f,h),h=Intersection.intersectBezier3Line(d,b,a,c,h,j),d=Intersection.intersectBezier3Line(d,b,a,c,j,e),b=new Intersection("No Intersection");b.appendPoints(g.points);b.appendPoints(f.points);b.appendPoints(h.points);b.appendPoints(d.points);if(b.points.length>0)b.status="Intersection";
return b};Intersection.intersectCircleCircle=function(d,b,a,c){var g;g=b+c;var f=Math.abs(b-c),e=d.distanceFrom(a);e>g?g=new Intersection("Outside"):e<f?g=new Intersection("Inside"):(g=new Intersection("Intersection"),c=(b*b-c*c+e*e)/(2*e),b=Math.sqrt(b*b-c*c),c=d.lerp(a,c/e),e=b/e,g.points.push(new Point2D(c.x-e*(a.y-d.y),c.y+e*(a.x-d.x))),g.points.push(new Point2D(c.x+e*(a.y-d.y),c.y-e*(a.x-d.x))));return g};
Intersection.intersectCircleEllipse=function(d,b,a,c,g){return Intersection.intersectEllipseEllipse(d,b,b,a,c,g)};
Intersection.intersectCircleLine=function(d,b,a,c){var g;g=(c.x-a.x)*(c.x-a.x)+(c.y-a.y)*(c.y-a.y);var f=2*((c.x-a.x)*(a.x-d.x)+(c.y-a.y)*(a.y-d.y)),d=f*f-4*g*(d.x*d.x+d.y*d.y+a.x*a.x+a.y*a.y-2*(d.x*a.x+d.y*a.y)-b*b);d<0?g=new Intersection("Outside"):d==0?g=new Intersection("Tangent"):(b=Math.sqrt(d),d=(-f+b)/(2*g),f=(-f-b)/(2*g),(d<0||d>1)&&(f<0||f>1)?g=d<0&&f<0||d>1&&f>1?new Intersection("Outside"):new Intersection("Inside"):(g=new Intersection("Intersection"),0<=d&&d<=1&&g.points.push(a.lerp(c,
d)),0<=f&&f<=1&&g.points.push(a.lerp(c,f))));return g};Intersection.intersectCirclePolygon=function(d,b,a){for(var c=new Intersection("No Intersection"),g=a.length,f,e=0;e<g;e++)f=Intersection.intersectCircleLine(d,b,a[e],a[(e+1)%g]),c.appendPoints(f.points);c.status=c.points.length>0?"Intersection":f.status;return c};
Intersection.intersectCircleRectangle=function(d,b,a,c){var g=a.min(c),f=a.max(c),c=new Point2D(f.x,g.y),e=new Point2D(g.x,f.y),a=Intersection.intersectCircleLine(d,b,g,c),c=Intersection.intersectCircleLine(d,b,c,f),f=Intersection.intersectCircleLine(d,b,f,e),d=Intersection.intersectCircleLine(d,b,e,g),b=new Intersection("No Intersection");b.appendPoints(a.points);b.appendPoints(c.points);b.appendPoints(f.points);b.appendPoints(d.points);b.status=b.points.length>0?"Intersection":a.status;return b};
Intersection.intersectEllipseEllipse=function(d,b,a,c,g,f){for(var d=[a*a,0,b*b,-2*a*a*d.x,-2*b*b*d.y,a*a*d.x*d.x+b*b*d.y*d.y-b*b*a*a],c=[f*f,0,g*g,-2*f*f*c.x,-2*g*g*c.y,f*f*c.x*c.x+g*g*c.y*c.y-g*g*f*f],g=Intersection.bezout(d,c).getRoots(),f=(d[0]*d[0]+2*d[1]*d[1]+d[2]*d[2])*0.0010,b=(c[0]*c[0]+2*c[1]*c[1]+c[2]*c[2])*0.0010,a=new Intersection("No Intersection"),e=0;e<g.length;e++)for(var h=(new Polynomial(d[0],d[3]+g[e]*d[1],d[5]+g[e]*(d[4]+g[e]*d[2]))).getRoots(),j=0;j<h.length;j++){var k=(d[0]*
h[j]+d[1]*g[e]+d[3])*h[j]+(d[2]*g[e]+d[4])*g[e]+d[5];Math.abs(k)<f&&(k=(c[0]*h[j]+c[1]*g[e]+c[3])*h[j]+(c[2]*g[e]+c[4])*g[e]+c[5],Math.abs(k)<b&&a.appendPoint(new Point2D(h[j],g[e])))}if(a.points.length>0)a.status="Intersection";return a};
Intersection.intersectEllipseLine=function(d,b,a,c,g){var f,e=new Vector2D(c.x,c.y);f=Vector2D.fromPoints(c,g);d=new Vector2D(d.x,d.y);d=e.subtract(d);e=new Vector2D(f.x/(b*b),f.y/(a*a));a=new Vector2D(d.x/(b*b),d.y/(a*a));b=f.dot(e);f=f.dot(a);d=d.dot(a)-1;a=f*f-b*d;a<0?f=new Intersection("Outside"):a>0?(d=Math.sqrt(a),a=(-f-d)/b,b=(-f+d)/b,(a<0||1<a)&&(b<0||1<b)?f=a<0&&b<0||a>1&&b>1?new Intersection("Outside"):new Intersection("Inside"):(f=new Intersection("Intersection"),0<=a&&a<=1&&f.appendPoint(c.lerp(g,
a)),0<=b&&b<=1&&f.appendPoint(c.lerp(g,b)))):(b=-f/b,0<=b&&b<=1?(f=new Intersection("Intersection"),f.appendPoint(c.lerp(g,b))):f=new Intersection("Outside"));return f};Intersection.intersectEllipsePolygon=function(d,b,a,c){for(var g=new Intersection("No Intersection"),f=c.length,e=0;e<f;e++){var h=Intersection.intersectEllipseLine(d,b,a,c[e],c[(e+1)%f]);g.appendPoints(h.points)}if(g.points.length>0)g.status="Intersection";return g};
Intersection.intersectEllipseRectangle=function(d,b,a,c,g){var f=c.min(g),e=c.max(g),g=new Point2D(e.x,f.y),h=new Point2D(f.x,e.y),c=Intersection.intersectEllipseLine(d,b,a,f,g),g=Intersection.intersectEllipseLine(d,b,a,g,e),e=Intersection.intersectEllipseLine(d,b,a,e,h),d=Intersection.intersectEllipseLine(d,b,a,h,f),b=new Intersection("No Intersection");b.appendPoints(c.points);b.appendPoints(g.points);b.appendPoints(e.points);b.appendPoints(d.points);if(b.points.length>0)b.status="Intersection";
return b};Intersection.intersectLineLine=function(d,b,a,c){var g,f=(c.x-a.x)*(d.y-a.y)-(c.y-a.y)*(d.x-a.x);g=(b.x-d.x)*(d.y-a.y)-(b.y-d.y)*(d.x-a.x);a=(c.y-a.y)*(b.x-d.x)-(c.x-a.x)*(b.y-d.y);a!=0?(f/=a,g/=a,0<=f&&f<=1&&0<=g&&g<=1?(g=new Intersection("Intersection"),g.points.push(new Point2D(d.x+f*(b.x-d.x),d.y+f*(b.y-d.y)))):g=new Intersection("No Intersection")):g=f==0||g==0?new Intersection("Coincident"):new Intersection("Parallel");return g};
Intersection.intersectLinePolygon=function(d,b,a){for(var c=new Intersection("No Intersection"),g=a.length,f=0;f<g;f++){var e=Intersection.intersectLineLine(d,b,a[f],a[(f+1)%g]);c.appendPoints(e.points)}if(c.points.length>0)c.status="Intersection";return c};
Intersection.intersectLineRectangle=function(d,b,a,c){var g=a.min(c),f=a.max(c),c=new Point2D(f.x,g.y),e=new Point2D(g.x,f.y),a=Intersection.intersectLineLine(g,c,d,b),c=Intersection.intersectLineLine(c,f,d,b),f=Intersection.intersectLineLine(f,e,d,b),d=Intersection.intersectLineLine(e,g,d,b),b=new Intersection("No Intersection");b.appendPoints(a.points);b.appendPoints(c.points);b.appendPoints(f.points);b.appendPoints(d.points);if(b.points.length>0)b.status="Intersection";return b};
Intersection.intersectPolygonPolygon=function(d,b){for(var a=new Intersection("No Intersection"),c=d.length,g=0;g<c;g++){var f=Intersection.intersectLinePolygon(d[g],d[(g+1)%c],b);a.appendPoints(f.points)}if(a.points.length>0)a.status="Intersection";return a};
Intersection.intersectPolygonRectangle=function(d,b,a){var c=b.min(a),g=b.max(a),a=new Point2D(g.x,c.y),f=new Point2D(c.x,g.y),b=Intersection.intersectLinePolygon(c,a,d),a=Intersection.intersectLinePolygon(a,g,d),g=Intersection.intersectLinePolygon(g,f,d),d=Intersection.intersectLinePolygon(f,c,d),c=new Intersection("No Intersection");c.appendPoints(b.points);c.appendPoints(a.points);c.appendPoints(g.points);c.appendPoints(d.points);if(c.points.length>0)c.status="Intersection";return c};
Intersection.intersectRayRay=function(d,b,a,c){var g;g=(c.x-a.x)*(d.y-a.y)-(c.y-a.y)*(d.x-a.x);var f=(b.x-d.x)*(d.y-a.y)-(b.y-d.y)*(d.x-a.x),a=(c.y-a.y)*(b.x-d.x)-(c.x-a.x)*(b.y-d.y);a!=0?(f=g/a,g=new Intersection("Intersection"),g.points.push(new Point2D(d.x+f*(b.x-d.x),d.y+f*(b.y-d.y)))):g=g==0||f==0?new Intersection("Coincident"):new Intersection("Parallel");return g};
Intersection.intersectRectangleRectangle=function(d,b,a,c){var g=d.min(b),f=d.max(b),b=new Point2D(f.x,g.y),e=new Point2D(g.x,f.y),d=Intersection.intersectLineRectangle(g,b,a,c),b=Intersection.intersectLineRectangle(b,f,a,c),f=Intersection.intersectLineRectangle(f,e,a,c),a=Intersection.intersectLineRectangle(e,g,a,c),c=new Intersection("No Intersection");c.appendPoints(d.points);c.appendPoints(b.points);c.appendPoints(f.points);c.appendPoints(a.points);if(c.points.length>0)c.status="Intersection";
return c};Intersection.bezout=function(d,b){var a=d[0]*b[1]-b[0]*d[1],c=d[0]*b[2]-b[0]*d[2],g=d[0]*b[3]-b[0]*d[3],f=d[0]*b[4]-b[0]*d[4],e=d[0]*b[5]-b[0]*d[5],h=d[1]*b[2]-b[1]*d[2],j=d[3]*b[5]-b[3]*d[5],k=d[1]*b[5]-b[1]*d[5]+(d[3]*b[4]-b[3]*d[4]),l=d[1]*b[4]-b[1]*d[4]-(d[2]*b[3]-b[2]*d[3]);return new Polynomial(a*h-c*c,a*l+g*h-2*c*f,a*k+g*l-f*f-2*c*e,a*j+g*k-2*f*e,g*j-e*e)};Storage.prototype.setObject=function(d,b){this.setItem(d,JSON.stringify(b))};Storage.prototype.getObject=function(d){return(d=this.getItem(d))&&JSON.parse(d)};var debug={showids:false,magnetism:false,connector:false,snapTo:false},colors={defaultTrackFill:"#FFFFFF",defaultTrackStroke:"#A0998A",defaultSelectedTrackFill:"#FCF688",defaultSelectedTrackStroke:"#A0998A",smallTemplateTrackFill:"#A0998A",defaultDialTickStoke:"rgba(0,0,0,0.2)",gridBackground:"#0b9ad3",gridMainLine:"#21a2d6",gridSecondaryLine:"#33aada",mapViewBackground:"rgba(255,255,255,0.4)",mapViewViewport:"rgba(11,154,211,0.4)",bogieMagnetPoint:"rgba(132,119,123,0.7)",carriageFill:"rgba(175,71,95,0.5)",
carriageStroke:"#FFFFFF",arrow:"#204665",arrowHover:"#F1F3AE",tracksDrawerFill:"rgba(255,255,255,0.4)"},config={minimumLibraryVersion:1,pathPrecision:20,maxFPS:30,influenceRadiusMultiplier:2.3,influenceRadiusForConnectors:4,mapViewZoomLevel:0.2,gridMain:200,gridSecondary:5,defaultTemplate:"defaultTemplate",defaultTrackStroke:3,smallTemplate:"smallTemplate",useDefaultLibrary:true,minimumLibraryVersion:1},LIBRARY={data:{version:"1",tracks:[{name:"ShortStraightTrack",vendor:"BRIO",reference:"33334",
regX:"50",regY:"20",influence:"40",connectors:[{name:"cA",type:"FEMALE",p1:{x:"0",y:"0"},p2:{x:"0",y:"40"}},{name:"cB",type:"MALE",p1:{x:"90",y:"40"},p2:{x:"90",y:"0"}}],segments:[{type:"LINE",connectorA:"cA",connectorB:"cB"}],graphics:[{op:"startStroke"},{op:"startFill"},{op:"move",x:"100",y:"20"},{op:"bezier",cp1x:"100",cp1y:"14.6",cp2x:"95.4",cp2y:"10.2",x:"90.0",y:"10.1"},{op:"line",x:"90",y:"0"},{op:"line",x:"0",y:"0"},{op:"line",x:"0",y:"10"},{op:"bezier",cp1x:"5.4",cp1y:"10.2",cp2x:"9.8",cp2y:"14.6",
x:"9.8",y:"20"},{op:"bezier",cp1x:"9.8",cp1y:"25.4",cp2x:"5.4",cp2y:"29.8",x:"0.0",y:"30"},{op:"line",x:"0",y:"40"},{op:"line",x:"90",y:"40"},{op:"line",x:"90",y:"30"},{op:"bezier",cp1x:"95.4",cp1y:"29.8",cp2x:"99.8",cp2y:"25.4",x:"99.8",y:"20"}]},{name:"LargeCurvedTrack",vendor:"BRIO",reference:"33342",regX:"88",regY:"23",influence:"50",connectors:[{name:"cA",type:"MALE",p1:{x:"0",y:"36.7"},p2:{x:"28",y:"65"}},{name:"cB",type:"FEMALE",p1:{x:"148",y:"65"},p2:{x:"176",y:"37"}}],segments:[{type:"BEZIER",
connectorA:"cA",connectorB:"cB",cp1:{x:"67.6",y:"9"},cp2:{x:"112.9",y:"9"}}],graphics:[{op:"startStroke"},{op:"startFill"},{op:"move",x:"152.5",y:"50.4"},{op:"bezier",cp1x:"152.5",cp1y:"44.9",cp2x:"157.0",cp2y:"40.4",x:"162.5",y:"40.4"},{op:"bezier",cp1x:"165.3",cp1y:"40.4",cp2x:"167.9",cp2y:"41.6",x:"169.7",y:"43.4"},{op:"bezier",cp1x:"171.9",cp1y:"41.2",cp2x:"174.1",cp2y:"39.0",x:"176.3",y:"36.9"},{op:"bezier",cp1x:"176.4",cp1y:"36.8",cp2x:"176.5",cp2y:"36.7",x:"176.6",y:"36.6"},{op:"bezier",cp1x:"127.8",
cp1y:"-12.2",cp2x:"48.8",cp2y:"-12.2",x:"0.0",y:"36.6"},{op:"bezier",cp1x:"2.4",cp1y:"39.0",cp2x:"4.8",cp2y:"41.4",x:"7.2",y:"43.8"},{op:"bezier",cp1x:"5.4",cp1y:"45.6",cp2x:"4.3",cp2y:"48.1",x:"4.3",y:"50.9"},{op:"bezier",cp1x:"4.3",cp1y:"56.4",cp2x:"8.8",cp2y:"60.9",x:"14.3",y:"60.9"},{op:"bezier",cp1x:"17.1",cp1y:"60.9",cp2x:"19.6",cp2y:"59.7",x:"21.4",y:"57.9"},{op:"bezier",cp1x:"23.7",cp1y:"60.2",cp2x:"26.0",cp2y:"62.5",x:"28.3",y:"64.9"},{op:"bezier",cp1x:"61.4",cp1y:"31.7",cp2x:"115.1",cp2y:"31.7",
x:"148.3",y:"64.9"},{op:"bezier",cp1x:"150.7",cp1y:"62.4",cp2x:"153.1",cp2y:"60.0",x:"155.6",y:"57.6"},{op:"bezier",cp1x:"153.7",cp1y:"55.7",cp2x:"152.5",cp2y:"53.2",x:"152.5",y:"50.4"}]},{name:"CurvedSwitchingTrack",vendor:"BRIO",reference:"33346",regX:"80",regY:"67",influence:"50",connectors:[{name:"cA",type:"FEMALE",p1:{x:"0",y:"0"},p2:{x:"0",y:"40"}},{name:"cB",type:"MALE",p1:{x:"150",y:"40"},p2:{x:"150",y:"0"}},{name:"cC",type:"MALE",p1:{x:"25",y:"125"},p2:{x:"65",y:"125"}}],segments:[{type:"LINE",
connectorA:"cA",connectorB:"cB"},{type:"BEZIER",connectorA:"cB",connectorB:"cC",cp1:{x:"66.5",y:"20"},cp2:{x:"44",y:"88"}}],switches:[{source:"cB",connectorsArray:["cA","cC"],position:"0"}],graphics:[{op:"startStroke"},{op:"startFill"},{op:"move",x:"150",y:"10.1"},{op:"line",x:"150",y:"9.8"},{op:"bezier",cp1x:"150.0",cp1y:"6.7",cp2x:"150",cp2y:"3.6",x:"150",y:"0.5"},{op:"bezier",cp1x:"150",cp1y:"0.3",cp2x:"150",cp2y:"0.2",x:"150",y:"0.1"},{op:"line",x:"150",y:"0"},{op:"line",x:"0",y:"0"},{op:"line",
x:"0",y:"10.1"},{op:"bezier",cp1x:"5.4",cp1y:"10.2",cp2x:"9.8",cp2y:"14.6",x:"9.8",y:"20.0"},{op:"bezier",cp1x:"9.8",cp1y:"25.4",cp2x:"5.4",cp2y:"29.8",x:"0.0",y:"29.9"},{op:"line",x:"0",y:"40"},{op:"line",x:"58.7",y:"40"},{op:"bezier",cp1x:"38.1",cp1y:"62.3",cp2x:"25.5",cp2y:"92.2",x:"25.5",y:"125.0"},{op:"bezier",cp1x:"28.9",cp1y:"125.0",cp2x:"32.3",cp2y:"125.0",x:"35.7",y:"125.0"},{op:"bezier",cp1x:"35.7",cp1y:"127.0",cp2x:"36.7",cp2y:"130.1",x:"38.6",y:"132.0"},{op:"bezier",cp1x:"42.5",cp1y:"136",
cp2x:"48.9",cp2y:"136",x:"52.8",y:"132.1"},{op:"bezier",cp1x:"54.7",cp1y:"130.1",cp2x:"55.7",cp2y:"127.0",x:"55.7",y:"125.0"},{op:"bezier",cp1x:"59.0",cp1y:"125.0",cp2x:"62.2",cp2y:"125.0",x:"65.5",y:"125.0"},{op:"bezier",cp1x:"65.5",cp1y:"78.0",cp2x:"103.0",cp2y:"40.1",x:"150.0",y:"40.1"},{op:"bezier",cp1x:"150.0",cp1y:"40.1",cp2x:"150.0",cp2y:"40.0",x:"150.0",y:"40.0"},{op:"bezier",cp1x:"150.0",cp1y:"36.6",cp2x:"150.0",cp2y:"33.3",x:"150.0",y:"29.9"},{op:"bezier",cp1x:"155.4",cp1y:"29.8",cp2x:"159.8",
cp2y:"25.4",x:"159.8",y:"20.0"},{op:"bezier",cp1x:"159.8",cp1y:"14.6",cp2x:"155.4",cp2y:"10.2",x:"150.0",y:"10.1"}]}]}};(function(d){function b(){this.initialize()}b.prototype.initialize=function(){this.loadLibrary()};b.prototype.loadLibrary=function(){this.library={};if(config.useDefaultLibrary)this.library=LIBRARY.data;this.library.version<config.minimumLibraryVersion&&console.fatal("Library.prototype.loadLibrary : wrong library version number")};b.prototype.getTrackConfig=function(a){for(var c in this.library.tracks)if(this.library.tracks[c].name==a)return this.library.tracks[c];console.error("Library.prototype.getTrackConfig : Track "+
a+" not found");return null};d.Library=b})(window);(function(d){function b(a){this.config=library.getTrackConfig(a);this.initialize()}b.prototype=new Container;b.prototype.Container_initialize=b.prototype.initialize;b.prototype.initialize=function(){this.type="Track";this.Container_initialize();this.connectors=[];this.scaleX=this.scaleY=this.scale=1;this.vertex=null;this.selected=false;this.segments=[];this.switches=[];this.renderingContext=config.defaultTemplate;for(var a in this.config.connectors){var c=new Connector(this,this.config.connectors[a].type,
this.config.connectors[a].p1,this.config.connectors[a].p2);this.connectors[this.config.connectors[a].name]=c}for(var b in this.config.switches){a=[];for(var d in this.config.switches[b].connectorsArray)a.push(this.connectors[this.config.switches[b].connectorsArray[d]]);this.addSwitch(this.config.switches[b].source,a,parseInt(this.config.switches[b].position))}for(var e in this.config.segments)d=b=void 0,this.config.segments[e].cp1&&(b=new Point2D(parseFloat(this.config.segments[e].cp1.x),parseFloat(this.config.segments[e].cp1.y))),
this.config.segments[e].cp2&&(d=new Point2D(parseFloat(this.config.segments[e].cp2.x),parseFloat(this.config.segments[e].cp2.y))),this.addSegment(new Segment(this.config.segments[e].type,this.connectors[this.config.segments[e].connectorA],this.connectors[this.config.segments[e].connectorB],b,d));this.regX=parseFloat(this.config.regX);this.regY=parseFloat(this.config.regY);this.influence=parseFloat(this.config.influence);for(var h in this.connectors)this.connectors[h].setRegistrationPoint(this.regX,
this.regY);for(h in this.segments)this.segments[h].setRegistrationPoint(this.regX,this.regY);this.trackShape=new Shape;this.trackShape.snapToPixel=true;this.trackPivot=new Shape;this.trackPivot.snapToPixel=true;this.addChild(this.trackShape);this.addChild(this.trackPivot);if(debug.showids)this.trackText=new Text,this.trackText.text=this.id,this.trackText.x=this.regX,this.trackText.y=this.regY,this.addChild(this.trackText);this.makeShape()};b.prototype.setRenderingContext=function(a){this.renderingContext=
a;this.makeShape()};b.prototype.getCoord=function(){return new Point2D(this.x,this.y)};b.prototype.onPress=function(a){railroad.save();var c=this.x-a.stageX,b=this.y-a.stageY,d=this;railroad.selection.reset();if(a.nativeEvent.shiftKey)railroad.selection.add(this);else{var e=new DepthFirstSearch(railroad.graph.getVertices(),this.vertex),h;for(h in e.preorder)railroad.selection.add(railroad.tracks[e.preorder[h]])}railroad.showRotationDial(railroad.selection);railroad.startDrag();a.onMouseMove=function(a){railroad.hideRotationDial();
x=a.stageX+c;y=a.stageY+b;d.moveWithSelection(x,y);railroad.startMagnetism();setDirty()};a.onMouseUp=function(){railroad.endDrag()}};b.prototype.onMouseOver=function(){setDirty()};b.prototype.onMouseOut=function(){setDirty()};b.prototype.move=function(a,c){this.x=a;this.y=c;for(var b in this.connectors)this.connectors[b].move(a,c);for(b=0;b<this.segments.length;b++)this.segments[b].move(a,c)};b.prototype.moveBy=function(a,c){this.move(this.x+a,this.y+c)};b.prototype.moveWithSelection=function(a,c){railroad.selection.move(a-
this.x,c-this.y)};b.prototype.rotate=function(a){this.rotation=a;var c=new Point2D(this.x,this.y),b;for(b in this.connectors)this.connectors[b].rotate(a,c);for(b=0;b<this.segments.length;b++)this.segments[b].rotate(a,c)};b.prototype.setColor=function(a){this.color=a;this.makeShape()};b.prototype.getFillColor=function(){return this.selected?colors.defaultSelectedTrackFill:this.renderingContext==config.smallTemplate?colors.smallTemplateTrackFill:this.color===void 0?colors.defaultTrackFill:this.color};
b.prototype.getStrokeColor=function(){return this.selected?colors.defaultSelectedTrackStroke:colors.defaultTrackStroke};b.prototype.getStrokeWidth=function(){return config.defaultTrackStroke};b.prototype.resetConnections=function(){for(var a in this.connectors)this.connectors[a].resetConnection()};b.prototype.setSelection=function(a){if(a!=this.selected)this.selected=a,this.makeShape()};b.prototype.addSegment=function(a){this.segments.push(a)};b.prototype.getSegmentTo=function(a){for(var c=[],b=0;b<
this.segments.length;b++)(this.segments[b].connectorA==a||this.segments[b].connectorB==a)&&c.push(this.segments[b]);if(c.length==0)console.error("Track.prototype.getSegmentTo : connector without any segment");else{if(c.length==1)return c[0];for(var b=this.switches[a].getCurrentTarget(),d=0;d<c.length;d++)if(c[d].hasConnectors(a,b))return c[d];console.error("Track.prototype.getSegmentTo : segment not found")}};b.prototype.getAllPoints=function(){var a=[],c;for(c in this.segments)a=this.segments[c].getPoints(a);
return a};b.prototype.addSwitch=function(a,c,b){this.switches[a]=new Switch(c,b)};b.prototype.makeShape=function(){var a=this.trackShape.graphics;a.clear();var c,b;for(b in this.config.graphics)switch(c=this.config.graphics[b],c.op){case "line":a.lineTo(c.x,c.y);break;case "bezier":a.bezierCurveTo(c.cp1x,c.cp1y,c.cp2x,c.cp2y,c.x,c.y);break;case "move":a.moveTo(c.x,c.y);break;case "startStroke":a.setStrokeStyle(this.getStrokeWidth());a.beginStroke(this.getStrokeColor());break;case "startFill":a.beginFill(this.getFillColor());
break;default:console.error("Track.prototype.makeShape : unknown operation : "+c.op)}setDirty()};b.prototype.serialize=function(){var a={};a.x=this.x;a.y=this.y;a.name=this.config.name;a.rotation=this.rotation;return a};d.Track=b})(window);(function(d){function b(){this.initialize()}b.prototype=new Container;b.prototype.Container_initialize=b.prototype.initialize;b.prototype.initialize=function(){this.type="TracksDrawer";this.templates=[];this.Container_initialize();this.drawerShape=new Shape;this.drawerShape.snapToPixel=true;this.addChild(this.drawerShape)};b.prototype.resetAllTemplates=function(){this.templates=[];this.makeShape()};b.prototype.addTemplate=function(a){this.templates.indexOf(a)==-1&&(this.templates.push(a),this.makeShape())};
b.prototype.makeShape=function(){var a=60;if(this.templates.length!=0){for(var c in this.templates){var b=new Track(this.templates[c]);b.setRenderingContext(config.smallTemplate);b.onPress=function(a){var c=new Track(this.config.name);railroad.addTrack(c);c.x=a.stageX;c.y=a.stageY;c.onPress(a)};b.scaleX=0.5;b.scaleY=0.5;this.addChild(b);b.x=a;b.y=45;a+=100}c=this.drawerShape.graphics;c.clear();c.beginFill(colors.tracksDrawerFill);c.rect(0,0,a-100+80,90);this.x=20;this.y=backgroundGrid.visibleHeight-
120}};d.TracksDrawer=b})(window);function Segment(d,b,a,c,g){if(arguments.length>0)d!="LINE"&&d!="BEZIER"?console.error("Segment.js : unknown type "+d):(this.type=d,c===void 0&&(c=new Point2D),g===void 0&&(g=new Point2D),this.connectorA=b,this.connectorB=a,this.cp1=c,this.cp2=g,this.previousPoint=new Point2D,this.angle=0)}Segment.prototype.getStartPoint=function(){return this.connectorA.getCenter()};Segment.prototype.getEndPoint=function(){return this.connectorB.getCenter()};
Segment.prototype.setRegistrationPoint=function(d,b){if(this.type!="LINE")this.cp1.rmoveto(-d,-b),this.cp2.rmoveto(-d,-b),this.previousPoint.x=0,this.previousPoint.y=0};Segment.prototype.moveBy=function(d,b){this.type!="LINE"&&(this.cp1.rmoveto(d,b),this.cp2.rmoveto(d,b))};Segment.prototype.move=function(d,b){if(this.type!="LINE")this.moveBy(d-this.previousPoint.x,b-this.previousPoint.y),this.previousPoint.x=d,this.previousPoint.y=b};
Segment.prototype.rotate=function(d,b){if(this.type!="LINE"){var a=d-this.angle;this.angle=d;this.cp1.rotate(a,b);this.cp2.rotate(a,b)}};Segment.prototype.hasConnectors=function(d,b){return d==this.connectorA&&b==this.connectorB?true:b==this.connectorA&&d==this.connectorB?true:false};
Segment.prototype.getPoints=function(d,b){d===void 0&&(d=[]);b===void 0&&(b=false);var a=new Point2D,c=new Point2D,g=new Point2D,f=new Point2D;b?(a=this.connectorB.getCenter(),c=this.connectorA.getCenter(),g=this.cp2,f=this.cp1):(a=this.connectorA.getCenter(),c=this.connectorB.getCenter(),g=this.cp1,f=this.cp2);var e=new Path;this.type=="BEZIER"&&e.addBezier([a,g,f,c]);this.type=="LINE"&&e.addLine(a,c);for(a=0;a<100;a+=100/config.pathPrecision)c=e.atT(a/100),c.segment=this,c.position=config.pathPrecision*
a/100,d.push(c);return d};var Connector=Class.extend({init:function(d,b,a,c){this.track=d;this.type=b;this.p1=new Point2D(parseFloat(a.x),parseFloat(a.y));this.p2=new Point2D(parseFloat(c.x),parseFloat(c.y));this.previous=new Point2D(0,0);this.angle=0;this.edge=null;this.shape=new Shape;this.shapeDraw();stage.addChild(this.shape)},evalType:function(){return this.type=="MALE"?1:0},shapeDraw:function(){debug.connector&&(this.shape.graphics.clear(),this.shape.graphics.endFill(),this.shape.graphics.setStrokeStyle(4),this.edge?
color="#B92233":color="#434238",this.shape.graphics.beginStroke(color),this.shape.graphics.moveTo(this.p1.x,this.p1.y).lineTo(this.p2.x,this.p2.y),this.edge?stroke=4:stroke=1,this.shape.graphics.setStrokeStyle(stroke).beginStroke("#fff"),this.shape.graphics.beginFill("#961B2E"),this.shape.graphics.drawEllipse(this.p1.x-5,this.p1.y-5,10,10),this.shape.graphics.beginFill("#24734B"),this.shape.graphics.drawEllipse(this.p2.x-5,this.p2.y-5,10,10),setDirty())},setRegistrationPoint:function(d,b){this.p1.rmoveto(-d,
-b);this.p2.rmoveto(-d,-b);this.shapeDraw()},getDistance:function(d){var b=[];b.push(this.p1.distanceFrom(d.p1));b.push(this.p1.distanceFrom(d.p2));b.push(this.p2.distanceFrom(d.p1));b.push(this.p2.distanceFrom(d.p2));return Math.min.apply(null,b)},move:function(d,b){dx=d-this.previous.x;dy=b-this.previous.y;this.p1.rmoveto(dx,dy);this.p2.rmoveto(dx,dy);this.previous.x=d;this.previous.y=b;this.shapeDraw()},rotate:function(d,b){var a=d-this.angle;this.angle=d;b===void 0?console.error("Connector.rotate : pivotPoint undefined"):
(this.p1.rotate(a,b),this.p2.rotate(a,b),this.shapeDraw())},match:function(d){return this.edge||d.edge?false:this.type!=d.type?true:false},connectTo:function(d){this.edge=d;d.edge=this},getCenter:function(){return new Point2D((this.p1.x+this.p2.x)/2,(this.p1.y+this.p2.y)/2)},resetConnection:function(){if(this.edge){if(this.edge.edge)this.edge.edge=null;this.edge=null}}});(function(d){function b(a,c){this.type="Grid";this.visibleWidth=a;this.visibleHeight=c;this.width=this.visibleWidth+2*config.gridMain;this.height=this.visibleHeight+2*config.gridMain;this.absoluteY=this.absoluteX=0;this.initialize()}b.prototype=new Shape;b.prototype.Shape_initialize=b.prototype.initialize;b.prototype.initialize=function(){this.Shape_initialize();this.snapToPixel=true;this.regX=this.width/2;this.regY=this.height/2;this.x=-config.gridMain;this.y=-config.gridMain;this.makeShape();this.clickWasADrag=
false};b.prototype.onPress=function(a){railroad.hideRotationDial();this.dx=this.x;this.dy=this.y;var c=this.x-a.stageX,b=this.y-a.stageY,d=this;this.clickWasADrag=false;a.onMouseMove=function(a){d.move(a.stageX+c,a.stageY+b);d.clickWasADrag=true;setDirty()};a.onMouseUp=function(){d.clickWasADrag||railroad.selection.reset()}};b.prototype.move=function(a,c){var b=a-this.dx,d=c-this.dy;this.dx=a;this.dy=c;this.absoluteX+=b;this.absoluteY+=d;railroad.moveAllTracks(b,d);this.x=this.absoluteX%config.gridMain+
this.regX-config.gridMain;this.y=this.absoluteY%config.gridMain+this.regY-config.gridMain};b.prototype.makeShape=function(){var a=this.graphics;a.clear();a.beginFill(colors.gridBackground);a.rect(0,0,this.width,this.height);for(var c=0;c<this.width;c+=config.gridMain/config.gridSecondary)a.setStrokeStyle(1),c%config.gridMain?color=colors.gridMainLine:color=colors.gridSecondaryLine,a.beginStroke(color),a.moveTo(c,0).lineTo(c,this.height);for(c=0;c<this.height;c+=config.gridMain/config.gridSecondary)a.setStrokeStyle(1),
c%config.gridMain?color=colors.gridMainLine:color=colors.gridSecondaryLine,a.beginStroke(color),a.moveTo(0,c).lineTo(this.width,c);this.cache(0,0,this.width,this.height)};b.prototype.resetView=function(){this.dx=this.visibleWidth/2;this.dy=this.visibleHeight/2;this.move(this.dx-this.absoluteX,this.dy-this.absoluteY);setDirty()};b.prototype.onDoubleClick=function(){this.resetView()};b.prototype.absolutizePoint=function(a){var c=new Point2D;c.x=a.x-this.absoluteX;c.y=a.y-this.absoluteY;return c};d.Grid=
b})(window);(function(d){function b(a,c,b,d){this.type="MapView";this.zoomFactor=c;this.gridWidth=a.visibleWidth;this.gridHeight=a.visibleHeight;this.originalGrid=a;this.width=b;this.height=d;this.x=this.gridWidth-this.width/2-20;this.y=this.gridHeight-this.height/2-20;this.rectangleMask={};this.rectangleMask.x=-this.width/2;this.rectangleMask.y=-this.height/2;this.rectangleMask.width=this.width;this.rectangleMask.height=this.height;this.initialize()}b.prototype=new SimpleMaskContainer;b.prototype.SimpleMaskContainer_initialize=
b.prototype.initialize;b.prototype.initialize=function(){this.SimpleMaskContainer_initialize();this.background=new Shape;this.background.snapToPixel=true;this.background.width=this.width;this.background.height=this.height;this.background.regX=this.width/2;this.background.regY=this.height/2;this.map=new Shape;this.map.snapToPixel=true;this.map.scaleX=this.zoomFactor;this.map.scaleY=this.zoomFactor;this.map.width=this.gridWidth;this.map.height=this.gridHeight;this.map.regX=this.map.width/2;this.map.regY=
this.map.height/2;this.addChild(this.background);this.addChild(this.map)};b.prototype.makeShape=function(){var a=this.background.graphics;a.clear();a.beginFill(colors.mapViewBackground);a.rect(0,0,this.width,this.height).endFill();a=this.map.graphics;a.clear();for(var c in railroad.tracks)this.drawPath(railroad.tracks[c],a);a.beginFill(colors.mapViewViewport).setStrokeStyle(1/this.zoomFactor).beginStroke("#000");a.rect(-this.originalGrid.absoluteX,-this.originalGrid.absoluteY,this.gridWidth,this.gridHeight);
a.endFill()};b.prototype.refresh=function(){this.makeShape()};b.prototype.drawPath=function(a,c){for(var b in a.segments){var d=backgroundGrid.absolutizePoint(a.segments[b].connectorA.getCenter()),e=backgroundGrid.absolutizePoint(a.segments[b].connectorB.getCenter());c.endFill().setStrokeStyle(5/this.zoomFactor).beginStroke("#000");a.segments[b].type=="LINE"?c.moveTo(d.x,d.y).lineTo(e.x,e.y).closePath():(cp1=backgroundGrid.absolutizePoint(a.segments[b].cp1),cp2=backgroundGrid.absolutizePoint(a.segments[b].cp2),
c.moveTo(d.x,d.y).bezierCurveTo(cp1.x,cp1.y,cp2.x,cp2.y,e.x,e.y))}for(var h in a.connectors)c.endFill().setStrokeStyle(1/this.zoomFactor).beginStroke("#000"),b=backgroundGrid.absolutizePoint(a.connectors[h].p1),d=backgroundGrid.absolutizePoint(a.connectors[h].p2),c.moveTo(b.x,b.y).lineTo(d.x,d.y).closePath()};b.prototype.onPress=function(a){a.onMouseMove=function(){};a.onMouseUp=function(){}};d.MapView=b})(window);(function(d){function b(){this.initialize()}b.prototype=new Shape;b.prototype.Shape_initialize=b.prototype.initialize;b.prototype.initialize=function(){this.Shape_initialize();this.snapToPixel=true};b.prototype.clear=function(){this.graphics.clear();this.target=this.source=null;setDirty()};b.prototype.glue=function(a,c){if(a&&c){this.source=a;this.target=c;var b=this.graphics;b.clear();var d=new Point2D,e=false,d=this.getLineIntersection(this.source,this.target,e);d.status!="Intersection"&&(e=true,
d=this.getLineIntersection(this.source,this.target,e));if(d.status=="Intersection")d=d.intersection,e?b.beginFill("#1F3333").setStrokeStyle(1).beginStroke("#434238").moveTo(this.source.p1.x,this.source.p1.y).quadraticCurveTo(d.x,d.y,this.target.p1.x,this.target.p1.y).lineTo(this.target.p2.x,this.target.p2.y).quadraticCurveTo(d.x,d.y,this.source.p2.x,this.source.p2.y).lineTo(this.source.p1.x,this.source.p1.y).closePath():b.setStrokeStyle(1).beginStroke("#434238").beginFill("#403835").moveTo(this.source.p1.x,
this.source.p1.y).quadraticCurveTo(d.x,d.y,this.target.p2.x,this.target.p2.y).lineTo(this.target.p1.x,this.target.p1.y).quadraticCurveTo(d.x,d.y,this.source.p2.x,this.source.p2.y).lineTo(this.source.p1.x,this.source.p1.y).closePath()}};b.prototype.getLineIntersection=function(a,c,b){var d={},e=new Point2D,h=new Point2D,j=new Point2D,k=new Point2D;b===void 0&&(b=false);b?(e=a.p1,h=c.p2,j=a.p2,k=c.p1):(e=a.p1,h=c.p1,j=a.p2,k=c.p2);c=(k.x-j.x)*(e.y-j.y)-(k.y-j.y)*(e.x-j.x);a=(h.x-e.x)*(e.y-j.y)-(h.y-
e.y)*(e.x-j.x);j=(k.y-j.y)*(h.x-e.x)-(k.x-j.x)*(h.y-e.y);j!=0?(k=c/j,j=a/j,0<=k&&k<=1&&0<=j&&j<=1?(d.status="Intersection",d.intersection=new Point2D(e.x+k*(h.x-e.x),e.y+k*(h.y-e.y))):d.status="No Intersection"):d.status=c==0||a==0?"Coincident":"Parallel";return d};d.Gizmo=b})(window);(function(d){function b(){var a=[];a.push.apply(a,arguments);a.__proto__=b.prototype;return a}b.prototype=[];b.prototype.add=function(a){typeof a=="array"?this.addArray(a):this.addOne(a)};b.prototype.addOne=function(a){a!==void 0&&this.indexOf(a)===-1&&(this.push(a),a.setSelection(true))};b.prototype.addArray=function(a){a instanceof Array||(n_tracksArray=[],n_tracksArray.push(a),a=n_tracksArray);for(var c in a)this.add(a[c])};b.prototype.set=function(a){for(var c in a)this.selection.indexOf(a[c])==
-1?this.add(a[c]):this.remove(a[c])};b.prototype.remove=function(a){a.setSelection(false);a=this.indexOf(a);a!=-1&&this.splice(a,1)};b.prototype.reset=function(){for(var a=this.length-1;a>=0;a--)this.remove(this[a])};b.prototype.clear=function(){this.reset();railroad.rotationDial.hide()};b.prototype.rebuildConnections=function(){};b.prototype.removeConnections=function(){};b.prototype.getCenter=function(){for(var a=new Point2D,c=0,b=0,d=0;d<this.length;d++)c+=this[d].x,b+=this[d].y;a.x=c/this.length;
a.y=b/this.length;return a};b.prototype.move=function(a,c){for(var b=0;b<this.length;b++)this[b].moveBy(a,c)};b.prototype.rotate=function(){};d.Selection=b})(window);(function(d){function b(){this.type="RotationDial";this.initialize()}b.prototype=new Shape;b.prototype.Shape_initialize=b.prototype.initialize;b.prototype.initialize=function(){this.Shape_initialize();this.visible=this.selected=false;this.size=200;this.selection=null;this.makeShape()};b.prototype.show=function(){if(!(this.selection.length<2)){var a=this.selection.getCenter();this.x=a.x;this.y=a.y;this.visible=true;setDirty()}};b.prototype.hide=function(){this.visible=false;this.rotation=0;setDirty()};
b.prototype.onPress=function(a){railroad.save();redirectTickerToStage(true);var c=a.stageX,b=a.stageY,d=this,e=0,h;a.onMouseMove=function(a){h=d.getAngle(new Point2D(c,b),new Point2D(a.stageX,a.stageY));h-=180;delta=h-e;a.nativeEvent.shiftKey&&(delta>0?(h=d.rotation+20,delta=20):(h=d.rotation-20,delta=-20));d.rotation=h;for(a=0;a<d.selection.length;a++){var k=new Point2D(d.selection[a].x,d.selection[a].y);k.rotate(delta,new Point2D(d.x,d.y));d.selection[a].move(k.x,k.y);d.selection[a].rotate(d.selection[a].rotation+
delta)}e=h};a.onMouseUp=function(){redirectTickerToStage(false);setDirty()}};b.prototype.onMouseOver=function(){};b.prototype.onMouseOut=function(){};b.prototype.makeShape=function(){this.graphics.clear();this.graphics.beginFill("rgba(0,0,0,0.2)").drawCircle(0,0,this.size*0.3).endFill();this.createTicks(10,0.8,1,2);this.createTicks(5,0.8,0.9);this.createTicks(10,0.3,0.4);this.graphics.beginStroke("#000000");this.graphics.setStrokeStyle(3);this.graphics.moveTo(0,-this.size/2*0.1).lineTo(0,+this.size/
2*0.1).moveTo(-this.size/2*0.1,0).lineTo(+this.size/2*0.1,0).closePath();setDirty()};b.prototype.createTicks=function(a,c,b,d,e){e===void 0&&(e=this.getDialTickColor());d===void 0&&(d=1);for(var c=new Point2D(0,-this.size/2*c),b=new Point2D(0,-this.size/2*b),h=new Point2D(0,0),j=360/a,k=0;k<j;k++)this.graphics.beginStroke(e),this.graphics.setStrokeStyle(d),this.graphics.moveTo(c.x,c.y).lineTo(b.x,b.y).closePath(),c.rotate(a,h),b.rotate(a,h)};b.prototype.getDialTickColor=function(){return colors.defaultDialTickStoke};
b.prototype.getAngle=function(a,c){var b,d;b=new Point2D(this.x,this.y);d=new Point2D(a.x,a.y);var e,h;e=new Point2D(this.x,this.y);h=new Point2D(c.x,c.y);var j=d.x-b.x;b=d.y-b.y;d=e.x-h.x;e=e.y-h.y;h=Math.sqrt(j*j+b*b);var k=Math.sqrt(d*d+e*e);j/=h;b/=h;d/=k;e/=k;return(Math.atan2(e,d)-Math.atan2(b,j))/(Math.PI*2/360)};d.RotationDial=b})(window);var Railroad=Class.extend({init:function(){this.tracks=[];this.graph=new Graph;this.gizmo=new Gizmo;this.dragGestureConnection={};this.debugView=new Shape;this.selection=new Selection;this.rotationDial=new RotationDial;stage.addChild(this.rotationDial);this.forwardArrow=new Arrow;this.backwardArrow=new Arrow;stage.addChild(this.forwardArrow);stage.addChild(this.backwardArrow)},addTrack:function(d){this.tracks[d.id]=d;d.vertex=new Vertex(d.id,{track:d});this.graph.addVertex(d.vertex);stage.addChild(d)},
removeTrack:function(d){for(var b in d.connectors)stage.removeChild(d.connectors[b].shape),delete d.connectors[b];stage.removeChild(d);d=this.tracks.indexOf(d);d!=-1&&this.tracks.splice(d,1)},moveAllTracks:function(d,b){for(var a in this.tracks)this.tracks[a].moveBy(d,b)},startDrag:function(){this.dragGestureConnection.status=false;stage.addChildAt(this.gizmo,stage.getChildIndex(backgroundGrid)+1);this.disconnectAllConnector(this.selection);this.selection.length>1&&this.reconnectConnectors(this.selection)},
startMagnetism:function(){this.dragGestureConnection.status=false;if(debug.magnetism||debug.snapTo)this.debugView.graphics.clear(),stage.addChild(this.debugView);var d=this.getNeighboursTracks(this.selection);if(d.length==0)this.gizmo.clear();else{for(var b=Number.MAX_VALUE,a=0;a<d.length;a++)for(var c=0;c<this.selection.length;c++)if(target=d[a],source=this.selection[c],connectorMatchResult=this.getMatchingConnectors(source,target),connectorMatchResult.distance<b)this.dragGestureConnection.status=
true,this.dragGestureConnection.sourceTrack=source,this.dragGestureConnection.targetTrack=target,this.dragGestureConnection.sourceConnector=connectorMatchResult.source,this.dragGestureConnection.targetConnector=connectorMatchResult.target,b=connectorMatchResult.distance;this.dragGestureConnection.status?this.gizmo.glue(this.dragGestureConnection.sourceConnector,this.dragGestureConnection.targetConnector):this.gizmo.clear()}},getNeighboursTracks:function(d){d instanceof Array||(n_selection=new Selection,
n_selection.add(d),d=n_selection);var b=[],a;for(a in this.tracks){var c=this.tracks[a];if(d.indexOf(c)==-1)for(var g=0;g<d.length;g++){var f=d[g];debug.magnetism&&this.debugView.graphics.beginFill("rgba(255,237,0,0.1)").drawCircle(f.getCoord().x,f.getCoord().y,f.influence*config.influenceRadiusMultiplier);c.getCoord().distanceFrom(f.getCoord())<(c.influence+f.influence)*config.influenceRadiusMultiplier&&(debug.magnetism&&this.debugView.graphics.beginFill("rgba(0,0,0,0.1)").drawCircle(c.getCoord().x,
c.getCoord().y,c.influence*config.influenceRadiusMultiplier),b.push(c))}}return b},getMatchingConnectors:function(d,b){var a={};a.distance=Number.MAX_VALUE;for(var c in d.connectors)for(var g in b.connectors)if(d.connectors[c].match(b.connectors[g])){var f=d.connectors[c].getDistance(b.connectors[g]);if(f<a.distance)a.distance=f,a.source=d.connectors[c],a.target=b.connectors[g]}return a},endDrag:function(){this.gizmo.clear();(debug.magnetism||debug.snapTo)&&this.debugView.graphics.clear();if(this.dragGestureConnection.status!=
false){var d,b;new Point2D;new Point2D;this.dragGestureConnection.sourceConnector.p1.distanceFrom(this.dragGestureConnection.targetConnector.p2)<this.dragGestureConnection.sourceConnector.p2.distanceFrom(this.dragGestureConnection.targetConnector.p1)?(b=this.dragGestureConnection.sourceConnector.p1,d=this.dragGestureConnection.targetConnector.p2):(b=this.dragGestureConnection.sourceConnector.p2,d=this.dragGestureConnection.targetConnector.p1);var a=new Point2D(this.dragGestureConnection.sourceTrack.x,
this.dragGestureConnection.sourceTrack.y);debug.snapTo&&(this.debugView.graphics.beginFill("rgba(255,255,255,0.5)").drawCircle(b.x,b.y,10),this.debugView.graphics.beginFill("rgba(255,255,255,0.5)").drawCircle(d.x,d.y,10));dx=d.x-b.x;dy=d.y-b.y;debug.snapTo&&this.debugView.graphics.beginFill("rgba(255,0,255,0.5)").drawCircle(a.x,a.y,20);a.rmoveto(dx,dy);debug.snapTo&&this.debugView.graphics.beginFill("rgba(255,255,0,0.5)").drawCircle(a.x,a.y,20);var c=this.dragGestureConnection.sourceTrack.rotation;
b=Math.round(this.getAngle(this.dragGestureConnection.sourceConnector,this.dragGestureConnection.targetConnector));c+=b;a.rotate(b,d);debug.snapTo&&this.debugView.graphics.beginFill("rgba(255,127,127,0.5)").drawCircle(a.x,a.y,10);redirectTickerToStage(true);Tween.get(this.dragGestureConnection.sourceTrack).to({x:a.x,y:a.y,rotation:c},400).call(this.dragGestureConnection.sourceTrack.move,[a.x,a.y]).call(this.dragGestureConnection.sourceTrack.rotate,[c]).call(this.snapSelectionAlong,[this.dragGestureConnection.sourceTrack,
dx,dy,b,d],this).call(this.reconnectConnectorsWithinNeighbourhood,this.selection,this).call(this.extendSelection,[this.dragGestureConnection.sourceTrack],this).call(this.showRotationDial,[this.selection],this).call(redirectTickerToStage,[false])}},snapSelectionAlong:function(d,b,a,c,g){for(var f=0;f<this.selection.length;f++)if(this.selection[f]!=d){var e=new Point2D(this.selection[f].x,this.selection[f].y);e.rmoveto(b,a);e.rotate(c,g);this.selection[f].rotate(this.selection[f].rotation+c);this.selection[f].move(e.x,
e.y)}},connect:function(d,b,a,c){d.connectTo(b);this.graph.addEdge(new Edge(a.id,c.id,{}))},disconnectAllConnector:function(d){for(var b=0;b<d.length;b++){var a=d[b];a.resetConnections();neighbours=a.vertex.getNeighbours();for(var c in neighbours){for(b=0;b<d.length;b++);this.graph.deleteEdge(new Edge(a.vertex.label,c,{}))}}},reconnectConnectorsWithinNeighbourhood:function(d){var b=railroad.getNeighboursTracks(d,railroad.tracks),a=new Selection;a.addArray(d);a.addArray(b);railroad.reconnectConnectors(a);
a.clear()},reconnectConnectors:function(d){for(var b=0;b<d.length;b++)for(var a=0;a<d.length;a++){var c=d[b],g=d[a];if(c.id!=g.id)for(var f in c.connectors)for(var e in g.connectors)c.connectors[f].match(g.connectors[e])&&(c.connectors[f].p1.closeTo(g.connectors[e].p2,config.influenceRadiusForConnectors)||c.connectors[f].p1.closeTo(g.connectors[e].p1,config.influenceRadiusForConnectors))&&railroad.connect(c.connectors[f],g.connectors[e],c,g)}},extendSelection:function(d){this.selection.clear();var d=
new DepthFirstSearch(this.graph.getVertices(),d.vertex),b;for(b in d.preorder)this.selection.add(this.tracks[d.preorder[b]]);setDirty()},getAngle:function(d,b){var a=d.p2.x-d.p1.x,c=d.p2.y-d.p1.y,g=b.p1.x-b.p2.x,f=b.p1.y-b.p2.y,e=Math.sqrt(a*a+c*c),h=Math.sqrt(g*g+f*f);a/=e;c/=e;g/=h;f/=h;return(Math.atan2(f,g)-Math.atan2(c,a))/(Math.PI*2/360)},showRotationDial:function(d){topmost=stage.getNumChildren();stage.addChildAt(this.rotationDial,topmost);this.rotationDial.selection=d;this.rotationDial.show();
Ticker.removeListener(stage);Ticker.addListener(window)},hideRotationDial:function(){this.rotationDial.hide()},hideArrows:function(){redirectTickerToStage(true);Tween.get(this.forwardArrow).to({alpha:0},300).call(this.forwardArrow.hide,[true],this);Tween.get(this.backwardArrow).to({alpha:0},300).call(this.backwardArrow.hide,[true],this).call(redirectTickerToStage,[false])},save:function(){var d=[],b;for(b in this.tracks)d.push(this.tracks[b].serialize());localStorage.setObject("railroad",d)},restore:function(){var d=
[],b;for(b in this.tracks)d.push(this.tracks[b]);for(var a=d.length;a>0;a--)this.removeTrack(d[a-1]);railroad.selection.clear();d=localStorage.getObject("railroad");for(b in d)a=new Track(d[b].name),a.move(d[b].x,d[b].y),a.rotate(d[b].rotation),railroad.addTrack(a)}});(function(d){function b(){this.type="Bogie";this.initialize()}b.prototype=new Container;b.prototype.Container_initialize=b.prototype.initialize;b.prototype.initialize=function(){this.Container_initialize();this.bogie=new Shape;this.bogie.snapToPixel=true;this.makeShape();this.addChild(this.bogie);this.snappedPoint=new Point2D;this.snappedSegment={};this.snapped=false;this.targetConnector=null;this.pointsInPath=[];this.indexInPath=0};b.prototype.makeShape=function(){var a=this.bogie.graphics;a.clear();
a.beginFill(colors.bogieMagnetPoint);a.drawCircle(0,0,10);a.endFill();setDirty()};b.prototype.onPress=function(a){railroad.hideRotationDial();railroad.forwardArrow.hide();railroad.backwardArrow.hide();var c=this.x-a.stageX,b=this.y-a.stageY,d=this;a.onMouseMove=function(a){x=a.stageX+c;y=a.stageY+b;d.moveWithMagnetism(x,y)};a.onMouseUp=function(){}};b.prototype.move=function(a,c){this.x=a;this.y=c;setDirty()};b.prototype.moveBy=function(a,c){this.move(this.x+a,this.y+c)};b.prototype.moveWithMagnetism=
function(a,c){this.snapped=false;var b=stage.getObjectsUnderPoint(a,c),d=this.createNewTargetPoint(a,c),e;for(e in b){var h=b[e].type,j=b[e];if(h===void 0)h=b[e].parent.type,j=b[e].parent;h=="Track"&&(d=this.snapToSegment(new Point2D(a,c),j))}this.makeShape();return d};b.prototype.createNewTargetPoint=function(a,c){var b={};b.distance=Number.MAX_VALUE;b.point=new Point2D(a,c);b.snapped=false;return b};b.prototype.snapToSegment=function(a,b,d){b=b.getAllPoints();d===void 0&&(d=this.createNewTargetPoint(a.x,
a.y));for(var f in b){var e=new Point2D(b[f].x,b[f].y),h=e.distanceFrom(a);if(d.distance>h)d.distance=h,d.point=e,d.segment=b[f].segment,this.snapped=d.snapped=true,this.snappedPoint=e,this.snappedSegment=b[f].segment,this.snappedPosition=b[f].position}return d};b.prototype.start=function(a){console.log("STARTING @ SNAPPED POSITION :"+this.snappedPosition);this.pointsInPath=[];this.indexInPath=this.snappedPosition;this.targetConnector=a;if(a==this.snappedSegment.connectorB)this.pointsInPath=this.snappedSegment.getPoints(this.pointsInPath);
if(a==this.snappedSegment.connectorA)this.pointsInPath=this.snappedSegment.getPoints(this.pointsInPath,true),this.indexInPath=config.pathPrecision-this.indexInPath;console.log("------- "+this.indexInPath+" --------")};b.prototype.step=function(){var a={status:"MOVING"};a.point=new Point2D;this.indexInPath>=config.pathPrecision-1?(console.log("END OF TRACK"),this.snappedPoint=new Point2D(this.x,this.y),this.targetConnector.edge!=null?(console.log("MOVING ON TO TRACK "+this.targetConnector.edge.track.id),
this.requestNextTrack(),a.status="NEXTTRACK"):(console.log("NOWHERE ELSE TO GO : STOP"),console.log("-------------------------"),this.snappedPosition=this.targetConnector==this.snappedSegment.connectorA?0:config.pathPrecision,a.status="STOPPED")):(this.indexInPath++,a.point.x=this.pointsInPath[this.indexInPath].x,a.point.y=this.pointsInPath[this.indexInPath].y);return a};b.prototype.requestNextTrack=function(){this.snappedSegment=this.targetConnector.edge.track.getSegmentTo(this.targetConnector.edge);
if(this.targetConnector.edge==this.snappedSegment.connectorA)this.snappedPosition=0,this.start(this.snappedSegment.connectorB);if(this.targetConnector.edge==this.snappedSegment.connectorB)this.snappedPosition=config.pathPrecision,this.start(this.snappedSegment.connectorA)};d.Bogie=b})(window);(function(d){function b(){this.type="Carriage";this.initialize()}b.prototype=new Container;b.prototype.Container_initialize=b.prototype.initialize;b.prototype.initialize=function(){this.Container_initialize();this.carriage=new Shape;this.carriage.snapToPixel=true;this.bogieFront=new Bogie;this.bogieBack=new Bogie;this.addChild(this.bogieFront);this.addChild(this.bogieBack);this.bogieFrontdx=20;this.bogieFrontdy=15;this.regX=this.bogieFrontdx;this.regY=this.bogieFrontdy;this.bogieFront.x=this.bogieFrontdx;
this.bogieFront.y=this.bogieFrontdy;this.bogieBackdx=80;this.bogieBackdy=15;this.bogieBack.x=this.bogieBackdx;this.bogieBack.y=this.bogieBackdy;this.bogieFrontMagnetism={};this.makeShape();this.addChild(this.carriage);this.moving=this.snapped=false};b.prototype.makeShape=function(){var a=this.carriage.graphics;a.clear();a.beginFill(colors.carriageFill);a.drawRect(0,0,100,30);a.drawCircle(0,15,15);setDirty()};b.prototype.onPress=function(a){railroad.hideRotationDial();railroad.forwardArrow.hide();
railroad.backwardArrow.hide();var b=this.x-a.stageX,d=this.y-a.stageY,f=this;a.onMouseMove=function(a){x=a.stageX+b;y=a.stageY+d;f.moveWithMagnetism(x,y)};a.onMouseUp=function(){f.snapped=false;if(f.bogieFrontMagnetism.snapped){var a=f.snapBackBogie();if(a)f.snapped=true,a=f.getRotationToBackBogie(a),f.makeShape(),f.showArrows(),setDirty(),redirectTickerToStage(true),Tween.get(f).to({rotation:a},600,Ease.bounceOut).call(redirectTickerToStage,[false])}}};b.prototype.snapBackBogie=function(){var a=
new Point2D(this.x+this.regX,this.y+this.regY),b=a.distanceFrom(new Point2D(this.x+this.bogieBackdx,this.y+this.bogieBackdy));if(this.bogieFrontMagnetism.segment.type=="LINE"){var d=this.bogieFrontMagnetism.segment.getStartPoint(),f=this.bogieFrontMagnetism.segment.getEndPoint();d.rmoveto(this.regX,this.regY);f.rmoveto(this.regX,this.regY);d=Intersection.intersectCircleLine(a,b,d,f)}if(this.bogieFrontMagnetism.segment.type=="BEZIER"){var d=this.bogieFrontMagnetism.segment.getStartPoint(),f=this.bogieFrontMagnetism.segment.cp1.clone(),
e=this.bogieFrontMagnetism.segment.cp2.clone(),h=this.bogieFrontMagnetism.segment.getEndPoint();d.rmoveto(this.regX,this.regY);f.rmoveto(this.regX,this.regY);e.rmoveto(this.regX,this.regY);h.rmoveto(this.regX,this.regY);d=Intersection.intersectBezier3Circle(d,f,e,h,a,b)}if((d.status="Intersection")&&d.points.length>0){var a=new Point2D,b=null,j;for(j in d.points)a.x=d.points[j].x,a.y=d.points[j].y,b=a.clone();this.bogieBack.snapToSegment(b,this.bogieFrontMagnetism.segment.connectorA.track);return b}else return null};
b.prototype.getRotationToBackBogie=function(a){if(a===void 0)return console.error("Carriage.prototype.getRotationToBackBogie : cannot rotate to undefined point"),0;var b=new Point2D(this.x+this.bogieBackdx,this.y+this.bogieBackdy);return(new Point2D(this.x+this.bogieFrontdx,this.y+this.bogieFrontdy)).getAngle(b,a)+180};b.prototype.showArrows=function(){railroad.forwardArrow.targetConnector=this.bogieFront.snappedSegment.connectorA;railroad.backwardArrow.targetConnector=this.bogieFront.snappedSegment.connectorB;
railroad.forwardArrow.carriage=this;railroad.backwardArrow.carriage=this;railroad.forwardArrow.x=this.x;railroad.backwardArrow.x=this.x;railroad.forwardArrow.y=this.y-20;railroad.backwardArrow.y=this.y-20;var a=railroad.forwardArrow.targetConnector.getCenter(),b=railroad.backwardArrow.targetConnector.getCenter(),d=new Point2D(this.x,this.y),a=d.getAngle(new Point2D(railroad.forwardArrow.x,railroad.forwardArrow.y),new Point2D(a.x,a.y));railroad.forwardArrow.rotation=a-180;a=new Point2D(railroad.forwardArrow.x,
railroad.forwardArrow.y);a.rotate(railroad.forwardArrow.rotation,new Point2D(this.x,this.y));railroad.forwardArrow.x=a.x;railroad.forwardArrow.y=a.y;b=d.getAngle(new Point2D(railroad.backwardArrow.x,railroad.backwardArrow.y),new Point2D(b.x,b.y));railroad.backwardArrow.rotation=b-180;b=new Point2D(railroad.backwardArrow.x,railroad.backwardArrow.y);b.rotate(railroad.backwardArrow.rotation,new Point2D(this.x,this.y));railroad.backwardArrow.x=b.x;railroad.backwardArrow.y=b.y;railroad.forwardArrow.show();
railroad.backwardArrow.show()};b.prototype.move=function(a,b){this.x=a;this.y=b;setDirty()};b.prototype.moveBy=function(a,b){this.move(this.x+a,this.y+b)};b.prototype.moveWithMagnetism=function(a,b){this.bogieFrontMagnetism=null;this.bogieFrontMagnetism=this.bogieFront.moveWithMagnetism(a,b);this.move(this.bogieFrontMagnetism.point.x,this.bogieFrontMagnetism.point.y);this.makeShape()};b.prototype.start=function(a){this.snapped?(this.bogieFront.start(a),this.bogieBack.start(a),this.moving=true):console.error("Carriage.prototype.start : cannot start an non snapped carriage")};
b.prototype.tick=function(){if(this.moving){var a=this.bogieFront.step(),b=this.bogieBack.step();if(a.status=="STOPPED"||b.status=="STOPPED")this.moving=false;else if(!(a.status=="NEXTTRACK"||b.status=="NEXTTRACK"))b.point.rmoveto(this.regX,this.regY),this.rotation=this.getRotationToBackBogie(b.point),this.move(a.point.x,a.point.y),setDirty()}};b.prototype.stop=function(){this.moving=false};d.Carriage=b})(window);(function(d){function b(){this.type="Arrow";this.initialize()}b.prototype=new Shape;b.prototype.Shape_initialize=b.prototype.initialize;b.prototype.initialize=function(){this.Shape_initialize();this.visible=false;this.currentColor=colors.arrow;this.makeShape();this.targetConnector=this.carriage=null};b.prototype.show=function(){topmost=stage.getNumChildren();stage.addChildAt(this,topmost);this.alpha=0.8;this.visible=true;setDirty()};b.prototype.hide=function(){this.visible=false;this.targetConnector=
this.carriage=null;setDirty()};b.prototype.onClick=function(){railroad.hideArrows();this.carriage.start(this.targetConnector);setDirty()};b.prototype.onMouseOver=function(){this.currentColor=colors.arrowHover;this.makeShape()};b.prototype.onMouseOut=function(){this.currentColor=colors.arrow;this.makeShape()};b.prototype.makeShape=function(){this.graphics.clear();this.regY=this.regX=6;this.graphics.clear();this.graphics.setStrokeStyle(1,"round").beginStroke(this.currentColor).beginFill(this.currentColor);
this.graphics.moveTo(6,0).lineTo(12,12).lineTo(0,12).lineTo(6,0);this.graphics.endFill();setDirty()};b.prototype.getAngle=function(a,b,d){var f;f=new Point2D(a.x,a.y);var b=new Point2D(b.x,b.y),e,a=new Point2D(a.x,a.y);e=new Point2D(d.x,d.y);d=b.x-f.x;f=b.y-f.y;b=a.x-e.x;a=a.y-e.y;e=Math.sqrt(d*d+f*f);var h=Math.sqrt(b*b+a*a);d/=e;f/=e;b/=h;a/=h;return(Math.atan2(a,b)-Math.atan2(f,d))/(Math.PI*2/360)};d.Arrow=b})(window);function Switch(d){this.targetConnectors=d;this.position=0}Switch.prototype.setPosition=function(d){this.position=d};Switch.prototype.getCurrentTarget=function(){return this.targetConnectors[this.position]};Switch.prototype.change=function(){this.position++;if(this.position>this.targetConnectors.length-1)this.position=0;console.log("Switched to position "+this.position);return this.targetConnectors[this.position]};var Keys=function(){return{deleteSelection:function(){if(railroad.selection.length!=0){for(var d=0;d<railroad.selection.length;d++)railroad.removeTrack(railroad.selection[d]);railroad.selection.clear()}},stopTrain:function(){carriage.stop()},undo:function(){railroad.restore()}}}();var stage,canvas,backgroundGrid,mapView,update=true,railroad,carriage=new Carriage,library=new Library,tracksDrawer=new TracksDrawer;
function init(){canvas=document.getElementById("trackCanvas");stage=new Stage(canvas);var d=window.innerWidth,b=window.innerHeight;canvas.width=d;canvas.height=b;stage.enableMouseOver();stage.snapToPixelEnabled=true;backgroundGrid=new Grid(d,b);backgroundGrid.x=d/2;backgroundGrid.y=b/2;mapView=new MapView(backgroundGrid,config.mapViewZoomLevel,300,250);stage.addChild(backgroundGrid);stage.addChild(mapView);stage.addChild(tracksDrawer);tracksDrawer.addTemplate("ShortStraightTrack");tracksDrawer.addTemplate("LargeCurvedTrack");
tracksDrawer.addTemplate("CurvedSwitchingTrack");railroad=new Railroad}
function createSampleObjects(){for(var d=[],b=0,a=0;a<10;a++){b=Math.floor(Math.random()*3);switch(b){case 0:d[a]=new Track("ShortStraightTrack");break;case 1:d[a]=new Track("ShortStraightTrack");break;case 2:d[a]=new Track("ShortStraightTrack")}railroad.addTrack(d[a]);d[a].move(Math.floor(Math.random()*400),Math.floor(Math.random()*400));d[a].rotate(Math.floor(Math.random()*361))}carriage.move(100,100);stage.addChild(carriage)}
function tick(){carriage&&carriage.moving&&carriage.tick();update&&(update=false,stage.addChild(mapView),mapView.refresh(),stage.update())}function setDirty(){update=true}function redirectTickerToStage(d){d?(Ticker.removeListener(window),Ticker.addListener(stage)):(Ticker.removeListener(stage),Ticker.addListener(window))}
$(function(){init();Ticker.addListener(window);Ticker.setFPS(config.maxFPS);$(window).jkey("backspace",Keys.deleteSelection);$(window).jkey("space",Keys.stopTrain);$(window).jkey("ctrl+z",Keys.undo)});
